<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html">
  <title>Kwartz Reference Manual</title>
  <meta name="author" content="Makoto Kuwata &lt;kwa(at)kuwata-lab.com&gt;">
  <meta name="generator" content="kwaser">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <link rel="stylesheet" href="docstyle.css" type="text/css">
 </head>
 <body>

  <blockquote>
   <div class="mainbody">

    <div align="left"><h1>Kwartz Reference Manual</h1></div>
    <div align="left">
      Makoto Kuwata &lt;kwa(at)kuwata-lab.com&gt;<br>
      last update: $Date$<br>
    </div>

<a name="preface"></a>
<h2 class="section1">Preface</h2>
<p>This document is the Kwartz Reference Manual.
Presentation language (PL), directives, command-line options, and configuration option are described
in this document.
</p>
<a name="toc"></a>
<h3 class="section2">Table of Contents</h3>
<ul>
  <li><a href="#preface">Preface</a>
  <ul>
    <li><a href="#toc">Table of Contents</a>
    </li>
  </ul>
  </li>
  <li><a href="#pl">PL - Presentation Language</a>
  <ul>
    <li><a href="#pl-comment">Comments</a>
    </li>
    <li><a href="#pl-string">Strings</a>
    </li>
    <li><a href="#pl-boolean">Booleans and Null</a>
    </li>
    <li><a href="#pl-variable">Variables</a>
    </li>
    <li><a href="#pl-op">Operators</a>
    </li>
    <li><a href="#pl-print">Printing</a>
    </li>
    <li><a href="#pl-assign">Assignment</a>
    </li>
    <li><a href="#pl-array">Arrays and Hashes</a>
    </li>
    <li><a href="#pl-property">Properties &amp; Methods</a>
    </li>
    <li><a href="#pl-foreach">Iteration</a>
    </li>
    <li><a href="#pl-if">Conditional Branching</a>
    </li>
    <li><a href="#pl-func">Functions</a>
    </li>
    <li><a href="#pl-empty">Empty</a>
    </li>
    <li><a href="#pl-decl">Element declaration</a>
    </li>
    <li><a href="#pl-doc">Document declaration</a>
    </li>
    <li><a href="#pl-rawcode">Rawcode</a>
    </li>
    <li><a href="#pl-scope">Global and Local Variables</a>
    </li>
    <li><a href="#pl-infuture">Features Under Consideration</a>
    </li>
  </ul>
  </li>
  <li><a href="#kd">Directives</a>
  <ul>
    <li><a href="#kd-whatis">What is a Directive?</a>
    </li>
    <li><a href="#kd-mark">Marking</a>
    </li>
    <li><a href="#kd-output">Printing Values of Expressions</a>
    </li>
    <li><a href="#kd-value">Printing value of expression 2</a>
    </li>
    <li><a href="#kd-attr">Attribute Values</a>
    </li>
    <li><a href="#kd-apend">Appending Attribute Expression</a>
    </li>
    <li><a href="#kd-set">Assignment</a>
    </li>
    <li><a href="#kd-if">Conditional Branching</a>
    </li>
    <li><a href="#kd-foreach">Iteration (foreach)</a>
    </li>
    <li><a href="#kd-list">Iteration(list)</a>
    </li>
    <li><a href="#kd-foreach2">Iteration with Count</a>
    </li>
    <li><a href="#kd-foreach3">Iteration with a Toggle Switch</a>
    </li>
    <li><a href="#kd-while">Iteration (while)</a>
    </li>
    <li><a href="#kd-loop">Iteration (loop)</a>
    </li>
    <li><a href="#kd-dummy">Dummy data</a>
    </li>
    <li><a href="#kd-replace">Replacement of Elements</a>
    </li>
    <li><a href="#kd-placeholder">Placeholder</a>
    </li>
    <li><a href="#kd-include">Including Presentation Data Files</a>
    </li>
    <li><a href="#kd-idkd">id and kw:d Attributes</a>
    </li>
    <li><a href="#kd-notes">Notes</a>
    </li>
  </ul>
  </li>
  <li><a href="#plogic">Presentation Logic File Format</a>
  </li>
  <li><a href="#opt">Command-line options</a>
  </li>
  <li><a href="#config">Configuration options</a>
  </li>
</ul>
<br>


<br>


<a name="pl"></a>
<h2 class="section1">PL - Presentation Language</h2>
<p>PL is a language which is used to describe presentation logic in Kwartz.
This section shows how to write in PL.
</p>
<a name="pl-comment"></a>
<h3 class="section2">Comments</h3>
<p>Characters following '<code>//</code>' in a line is a comment.
Also is a comment between '<code>/*</code>' and '<code>*/</code>'.
</p>
<pre class="program">// comment
/*
   comment
 */
</pre>
<br>


<a name="pl-string"></a>
<h3 class="section2">Strings</h3>
<p><code>"..."</code> or <code>'...'</code> represents a string literal.
The former can contain special characters: line feed (\n), carriage return (\r) and tab (\t).
</p>
<pre class="program">'foo bar'         // String
"foo bar\n"       // String which contains a line feed character
</pre>
<br>


<a name="pl-boolean"></a>
<h3 class="section2">Booleans and Null</h3>
<p>The keywords <code>true</code>, <code>false</code>, <code>null</code> are available in expressions.
</p>
<pre class="program">flag = obj == null ? true : false;
</pre>
<p><code>true</code>, <code>false</code> and <code>null</code> are translated to the proper keywords in each language.
</p>
<div align="center">
<table class="table1" border="1" cellspacing="0" summary="	Translation of <code>true</code>, <code>false</code> and <code>null</code>
">
 <caption class="caption1">
	Translation of <code>true</code>, <code>false</code> and <code>null</code>
 </caption>
 <tr class="tr1">
  <th class="th1">Language name</th>
  <th class="th1">true</th>
  <th class="th1">false</th>
  <th class="th1">null</th>
 </tr>
 <tr class="tr1">
  <td class="td1">PHP</td>
  <td class="td1">TRUE</td>
  <td class="td1">FALSE</td>
  <td class="td1">NULL</td>
 </tr>
 <tr class="tr1">
  <td class="td1">eRuby</td>
  <td class="td1">true</td>
  <td class="td1">false</td>
  <td class="td1">nil</td>
 </tr>
 <tr class="tr1">
  <td class="td1">JSP(JSTL)</td>
  <td class="td1">true</td>
  <td class="td1">false</td>
  <td class="td1">null</td>
 </tr>
 <tr class="tr1">
  <td class="td1">Velocity</td>
  <td class="td1">true</td>
  <td class="td1">false</td>
  <td class="td1">-</td>
 </tr>
</table>
</div>
<p>Translating a PL program which contains the keyword <code>null</code> into a Velocity script will cause an error
because Velocity doesn't have a keyword which is equivalent to <code>null</code>.
However, Kwartz will translate '<code>expr==null</code>' and '<code>expr!=null</code>' to '<code>!expr</code>' and '<code>expr</code>'
when translating to Velocity.
</p>
<a name="pl-boolean.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">flag = obj == null? true : false;

if (expr != null) {
  print("expr is not null.\n");
} else {
  print("epxr is null.\n");
}
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for Velocity
#if($obj)
  #set($flag = true)
#else
  #set($flag = false)
#end
#if(! $expr)
expr is not null.
#else
epxr is null.
#end
</pre>
<br>


<a name="pl-variable"></a>
<h3 class="section2">Variables</h3>
<p>A varaible starts with alphabetic character or '<code>_</code>' and is followed by alphanumerics or '<code>_</code>'.
</p>
<p>You need not declare variables nor specify its type<sup>(<a href="#fnref:1" name="fnlink:1">*1</a>)</sup>.
</p>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:1" href="#fnlink:1">*1</a>)</dt>
  <dd>Because of this feature, it is very difficult to translate PL program into "static languages" such as Java.</dd>
 </dl>
</div>
<br>


<a name="pl-op"></a>
<h3 class="section2">Operators</h3>
<p>There are several operators in Kwartz. Comparison operators are available for numbers and strings<sup>(<a href="#fnref:2" name="fnlink:2">*2</a>)</sup>.
</p>
<div align="center">
<table class="table1" border="1" cellspacing="0" summary="	Operators
">
 <caption class="caption1">
	Operators
 </caption>
 <tr class="tr1">
  <td class="td1">Comparison operators</td>
  <td class="td1"><code>==  != &lt; &lt;= &gt; &gt;=</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">Logical operators</td>
  <td class="td1"><code>&amp;&amp; || !</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">Arithmetic operators</td>
  <td class="td1"><code>+ - * / %</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">String Concatenation operators</td>
  <td class="td1"><code> .+ </code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">Conditional operators</td>
  <td class="td1"><code>?:</code></td>
 </tr>
</table>
</div>
<p>String concatenation operator ('<code>.+</code>') is converted into '<code>+</code>' in eRuby, '<code>.</code>' in PHP,
a function '<code>fn:join()</code>' in JSTL1.1.
There is no concatenation operator in JSTL1.0, so Kwartz converts it into a little tricky code.
Concatenation operator will be error in Velocity.
</p>
<a name="pl-concatop.plogic"></a>
<div class="program_caption">
PL Program (PL):</div>
<pre class="program">filename = basename .+ '.plogic';
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% filename = basename + ".plogic" %&gt;

### for PHP
&lt;?php $filename = $basename . ".plogic"; ?&gt;

### for JSTL 1.1
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;c:set var="filename" value="${fn:join(basename,'.plogic')}"/&gt;

### for JSTL 1.0
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;
&lt;c:set var="filename" value="${basename}${'.plogic'}"/&gt;
</pre>
<p>Conditional Operator is available in eRuby, PHP, and JSTL1.1.
However, it is not available in JSTL1.0 and Velocity.
Therefore, conditional operators will be translated to corresponding if statements in JSTL1.0 and velocity.
</p>
<a name="pl-condop.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">color = ctr % 2 == 0 ? '#FFCCCC' : '#CCCCFF';
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% color = ctr % 2 == 0 ? "#FFCCCC" : "#CCCCFF" %&gt;

### for PHP
&lt;?php $color = $ctr % 2 == 0 ? "#FFCCCC" : "#CCCCFF"; ?&gt;

### for JSTL 1.1
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;c:set var="color" value="${ctr % 2 eq 0 ? '#FFCCCC' : '#CCCCFF'}"/&gt;

### for JSTL 1.0
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;
&lt;c:choose&gt;&lt;c:when test="${ctr % 2 eq 0}"&gt;
  &lt;c:set var="color" value="#FFCCCC"/&gt;
&lt;/c:when&gt;&lt;c:otherwise&gt;
  &lt;c:set var="color" value="#CCCCFF"/&gt;
&lt;/c:otherwise&gt;&lt;/c:choose&gt;

### for Velocity
#if($ctr % 2 == 0)
  #set($color = "#FFCCCC")
#else
  #set($color = "#CCCCFF")
#end
</pre>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:2" href="#fnlink:2">*2</a>)</dt>
  <dd>It is very difficult to translate PL program into Perl program, because Perl have different operators for numbers and strings ('==' vs 'eq', '!=' vs 'ne', ...).</dd>
 </dl>
</div>
<br>


<a name="pl-print"></a>
<h3 class="section2">Printing</h3>
<p><code>print(<em>...</em>)</code> is print statement.
Any expression can be in arguments.
</p>
<a name="pl-print.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">print('foo', bar, "baz\n");    // print a string and the value of a variable
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
foo&lt;%= bar %&gt;baz

### for PHP
foo&lt;?php echo $bar; ?&gt;baz

### for JSTL
foo&lt;c:out value="${bar}" escapeXml="false"/&gt;baz

### for Velocity
foo$!{bar}baz
</pre>
<p>When you enable auto-sanitizing, the output scripts will be one of the following:
</p>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
foo&lt;%= CGI::escapeHTML((bar).to_s) %&gt;baz

### for PHP
foo&lt;?php echo htmlspecialchars($bar); ?&gt;baz

### for JSTL
foo&lt;c:out value="${bar}"/&gt;baz

### for Velocity
foo$!esc.html($bar)baz
</pre>
<p>If conditional operator returns constant string or number, sanitizing will be off even when using auto-sanitizing.
</p>
<a name="pl-print2.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">// Sanitized.
print("&lt;option ", condition ? var1 : var2, "&gt;\n");
// Not sanitized.
print("&lt;option ", condition ? 'selected' : '', "&gt;\n");
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;option &lt;%= CGI::escapeHTML((condition ? var1 : var2).to_s) %&gt;&gt;
&lt;option &lt;%= condition ? "selected" : "" %&gt;&gt;

### for PHP
&lt;option &lt;?php echo htmlspecialchars($condition ? $var1 : $var2); ?&gt;&gt;
&lt;option &lt;?php echo $condition ? "selected" : ""; ?&gt;&gt;

### for JSTL
&lt;option &lt;c:out value="${condition ? var1 : var2}"/&gt;&gt;
&lt;option &lt;c:out value="${condition ? 'selected' : ''}" escapeXml="false"/&gt;&gt;
</pre>
<p>'<code>print(a .+ b .+ c);</code>' will be expanded such as '<code>print(a); print(b); print(c);</code>'.
This is for some languages which doesn't support string concatenation operator (<code>.+</code>).
</p>
<br>


<a name="pl-assign"></a>
<h3 class="section2">Assignment</h3>
<p>Assignment statement is such as <code>var = 100;</code>.
Also '<code>+=</code>', '<code>-=</code>', '<code>*=</code>', '<code>/=</code>', '<code>%=</code>' and '<code>+=</code>' are allowed.
</p>
<a name="pl-set.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">name = 'Foo';		// assign a string
count += 1;		// increment the value of the variable
str .+= '.txt';		// append a string
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for PHP
&lt;?php $name = "Foo"; ?&gt;
&lt;?php $count += 1; ?&gt;
&lt;?php $str .= ".txt"; ?&gt;

### for eRuby
&lt;% name = "Foo" %&gt;
&lt;% count += 1 %&gt;
&lt;% str += ".txt" %&gt;

### for JSTL 1.1
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;c:set var="name" value="Foo"/&gt;
&lt;c:set var="count" value="${count + 1}"/&gt;
&lt;c:set var="str" value="${fn:join(str,'.txt')}"/&gt;

### for JSTL 1.0
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;
&lt;c:set var="name" value="Foo"/&gt;
&lt;c:set var="count" value="${count + 1}"/&gt;
&lt;c:set var="str" value="${str}${'.txt'}"/&gt;
</pre>
<br>


<a name="pl-array"></a>
<h3 class="section2">Arrays and Hashes</h3>
<p>You can reference an array element as <code>arr[expr]</code>.
You can reference a hash element in the same way.<sup>(<a href="#fnref:3" name="fnlink:3">*3</a>)</sup>.
</p>
<p>In JSTL, assignment into an array element or a hash element is not available.
</p>
<a name="pl-array.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">list[n] = 10;           // assign into n-th element of the array
print(list[i], "\n");   // print  i-th element of the array
hash['key'] = 'foo';    // assign into a hash element
print(hash['key'], "\n"); // print a hash element
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% list[n] = 10 %&gt;
&lt;%= list[i] %&gt;
&lt;% hash["key"] = "foo" %&gt;
&lt;%= hash["key"] %&gt;

### for PHP
&lt;?php $list[$n] = 10; ?&gt;
&lt;?php echo $list[$i]; ?&gt;
&lt;?php $hash["key"] = "foo"; ?&gt;
&lt;?php echo $hash["key"]; ?&gt;
</pre>
<p>You can reference a hash by '<code>hash[:key]</code>'.
'<code>key</code>' must be a string which contains only alphpanumerics and '<code>_</code>'.
</p>
<p>'<code>hash[:key]</code>' will be translated according to target programming language:
</p>
<div align="center">
<table class="table1" border="1" cellspacing="0" summary="	Translation of '<code>hash[:key]</code>'
">
 <caption class="caption1">
	Translation of '<code>hash[:key]</code>'
 </caption>
 <tr class="tr1">
  <th class="th1">Target language</th>
  <th class="th1">Result of translation</th>
 </tr>
 <tr class="tr1">
  <td class="td1">eRuby</td>
  <td class="td1"><code>hash[:key]</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">PHP</td>
  <td class="td1"><code>$hash['key']</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">JSTL</td>
  <td class="td1"><code>hash['key']</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">Velocity</td>
  <td class="td1"><code>hash.key</code></td>
 </tr>
</table>
</div>
<a name="pl-hash.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">print(hash[:key]);
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;%= hash[:key] %&gt;

### for PHP
&lt;?php echo $hash['key']; ?&gt;

### for JSTL
&lt;c:out value="${hash['key']}" escapeXml="false"/&gt;

### for Velocity
$!{hash.key}</pre>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:3" href="#fnlink:3">*3</a>)</dt>
  <dd>Operators for arrays and hashes are the same, therefore it is difficult to support a language, say Perl, which use different operators for arrays and hashes.</dd>
 </dl>
</div>
<br>


<a name="pl-property"></a>
<h3 class="section2">Properties &amp; Methods</h3>
<p>You can reference a property of an object as '<code><em>object</em>.<em>property</em></code>'.
You can also call a method with arguments such as '<code><em>object</em>.<em>method</em>(<em>arg1</em>, <em>arg2</em>, ..)</code>'.
Translation of method call into JSTL will raise an error because JSTL's Expression Language doesn't support method call.
</p>
<a name="pl-property.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">// property
user.name = 'Foo';
print(user.name, "\n");
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% user.name = "Foo" %&gt;
&lt;%= user.name %&gt;

### for PHP
&lt;?php $user-&gt;name = "Foo"; ?&gt;
&lt;?php echo $user-&gt;name; ?&gt;

### for JSTL
&lt;c:set var="user" property="name" value="Foo"/&gt;
&lt;c:out value="${user.name}" escapeXml="false"/&gt;

### for Velocity
#set($user.name = "Foo")
$!{user.name}
</pre>
<a name="pl-method.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">// method call
print(user.method(10, 20));
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;%= user.method(10, 20) %&gt;

### for PHP
&lt;?php echo $user-&gt;method(10, 20); ?&gt;

### for Velocity
$!{user.method(10, 20)}</pre>
<p>There is no way to create a new object or define a new class in PL.
These tasks must be done in the main program.
</p>
<br>


<a name="pl-foreach"></a>
<h3 class="section2">Iteration</h3>
<p><code>foreach(<em>loopvar</em> in <em>list</em>) { ... }</code> represents a foreach iteration.
Items in the <code><em>list</em></code> is assigned into the variable <code><em>loopvar</em></code> each time through the iteration.
</p>
<a name="pl-foreach.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">foreach(item in list) {
  print(item, "\n");
}
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% for item in list do %&gt;
&lt;%= item %&gt;
&lt;% end %&gt;

### for PHP
&lt;?php foreach ($list as $item) { ?&gt;
&lt;?php echo $item; ?&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:forEach var="item" items="${list}"&gt;
&lt;c:out value="${item}" escapeXml="false"/&gt;
&lt;/c:forEach&gt;

### for Velocity
#foreach($item in $list)
$!{item}
#end
</pre>
<p>You can also use a while statment.
Kwartz will raise an error if you try to translate a while statement into a JSTL or Velocity script,
because there is no JSTL tag or Velocity directive which is equivalent to the while statment.
</p>
<a name="pl-while.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">i = 0;
while(i &lt; length) {
  i += 1;
  print(list[i]);
}
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% i = 0 %&gt;
&lt;% while i &lt; length do %&gt;
&lt;%   i += 1 %&gt;
&lt;%= list[i] %&gt;&lt;% end %&gt;

### for PHP
&lt;?php $i = 0; ?&gt;
&lt;?php while ($i &lt; $length) { ?&gt;
&lt;?php   $i += 1; ?&gt;
&lt;?php echo $list[$i]; ?&gt;&lt;?php } ?&gt;
</pre>
<p>for-statements (like in C or Java) are not available.
</p>
<br>


<a name="pl-if"></a>
<h3 class="section2">Conditional Branching</h3>
<p>'<code>if(<em>condition</em>) { ... } else if(<em>condition</em>) { ... } else { ... }</code>' represents a  conditional branch.
</p>
<a name="pl-if.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">if (val &gt; 0) {
  print ("* value is positive.\n");
} else if (val &lt; 0) {
  print ("* value is negative.\n");
} else {
  print ("* value is zero.\n");
}
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% if val &gt; 0 then %&gt;
* value is positive.
&lt;% elsif val &lt; 0 then %&gt;
* value is negative.
&lt;% else %&gt;
* value is zero.
&lt;% end %&gt;

### for PHP
&lt;?php if ($val &gt; 0) { ?&gt;
* value is positive.
&lt;?php } elseif ($val &lt; 0) { ?&gt;
* value is negative.
&lt;?php } else { ?&gt;
* value is zero.
&lt;?php } ?&gt;

### for JSTL
&lt;c:choose&gt;&lt;c:when test="${val gt 0}"&gt;
* value is positive.
&lt;/c:when&gt;&lt;c:when test="${val lt 0}"&gt;
* value is negative.
&lt;/c:when&gt;&lt;c:otherwise&gt;
* value is zero.
&lt;/c:otherwise&gt;&lt;/c:choose&gt;

### for Velocity
#if($val &gt; 0)
* value is positive.
#elseif($val &lt; 0)
* value is negative.
#else
* value is zero.
#end
</pre>
<br>


<a name="pl-func"></a>
<h3 class="section2">Functions</h3>
<p>The following functions are available in PL.
</p>
<dl class="dl3">
<dt class="dt3"><strong>
E(<em>expr</em>) </strong></dt>
<dd class="dd3">
	Sanitizes(escapes) the expression <em>expr</em>. Using this function sanitizes
	even when the command-line option for sanitizing is not specified.
	E() is pseudo-function and allowed to appear only as argument of print statement.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
X(<em>expr</em>) </strong></dt>
<dd class="dd3">
	Don't sanitize expression <em>expr</em>, even when the command-line option for
	sanitizing is specified.
	X() is pseudo-function and allowed to appear only as argument of print statement.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
C(<em>expression</em>) </strong></dt>
<dd class="dd3">
	Equivarent to <code><em>expression</em> ? ' checked="checked"' : ''</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
S(<em>expression</em>) </strong></dt>
<dd class="dd3">
	Equivarent to <code><em>expression</em> ? ' selected="selected"' : ''</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
D(<em>expression</em>) </strong></dt>
<dd class="dd3">
	Equivarent to <code><em>expression</em> ? ' disabled="disabled"' : ''</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
list_new() </strong></dt>
<dd class="dd3">
	  Create a new list. 
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
list_length(<em>list</em>) </strong></dt>
<dd class="dd3">
	  Return the length of the <em>list</em>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
list_empty(<em>list</em>) </strong></dt>
<dd class="dd3">
	  Return true if <em>list</em> is empty or false if not empty.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
hash_new() </strong></dt>
<dd class="dd3">
	  Create a new hash. 
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
hash_length(<em>hash</em>) </strong></dt>
<dd class="dd3">
	  Return the count of the <em>hash</em>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
hash_empty(<em>hash</em>) </strong></dt>
<dd class="dd3">
	  Return true if <em>hash</em> is empty or false if not empty.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
hash_keys(<em>hash</em>) </strong></dt>
<dd class="dd3">
	  Return a list which contains all keys of the <em>hash</em>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
str_length(<em>string</em>) </strong></dt>
<dd class="dd3">
	  Return the length of the <em>string</em>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
str_empty(<em>string</em>) </strong></dt>
<dd class="dd3">
	  Return true if <em>string</em> is empty, or false if not empty.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
str_tolower(<em>string</em>) </strong></dt>
<dd class="dd3">
	  Make a <em>string</em> to lowercase and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
str_toupper(<em>string</em>) </strong></dt>
<dd class="dd3">
	  Make a <em>string</em> to uppercase an return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
str_trim(<em>string</em>) </strong></dt>
<dd class="dd3">
	  Strip whitespace from the beginning and end of a <em>string</em> and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
str_index(<em>string</em>, <em>char</em>) </strong></dt>
<dd class="dd3">
	  Return the first positin a <em>char</em> occurs in a <em>string</em>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
str_replace(<em>string</em>, <em>before</em>, <em>after</em>) </strong></dt>
<dd class="dd3">
	  Replace <em>before</em> to <em>after</em> in <em>string</em> and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
str_linebreak(<em>string</em>) </strong></dt>
<dd class="dd3">
	  Insert <code>&lt;br /&gt;</code> before newline character in <em>string</em> and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
escape_xml(<em>html_string</em>) </strong></dt>
<dd class="dd3">
	  return the sanitaized <em>html_string</em>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
escape_url(<em>url_string</em>) </strong></dt>
<dd class="dd3">
	  Encode <em>url_string</em> and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
escape_sql(<em>sql_string</em>) </strong></dt>
<dd class="dd3">
	  Escape quotation(<code>'</code>), double quotation(<code>"</code>), backslash(<code>\</code>) in <em>sql_string</em> with backslash and return it.
</dd>
</dl>
<p>The following table shows the translation of functions in each target languages.
</p>
<div align="center">
<table class="table1" border="1" cellspacing="0">
 <tr class="tr1">
  <th class="th1">Functions</th>
  <th class="th1">eRuby, ERB</th>
  <th class="th1">PHP</th>
  <th class="th1">JSTL1.1</th>
  <th class="th1">Velocity</th>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>list_new()</code></td>
  <td class="td1"><code>[]</code></td>
  <td class="td1"><code>array()</code></td>
  <td class="td1">-</td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>list_length(<em>list</em>)</code></td>
  <td class="td1"><code><em>list</em>.length</code></td>
  <td class="td1"><code>array_length(<em>list</em>)</code></td>
  <td class="td1"><code>fn:length(<em>list</em>)</code></td>
  <td class="td1"><code>(<em>list</em>).size()</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>list_empty(<em>list</em>)</code></td>
  <td class="td1"><code><em>list</em>.empty?</code></td>
  <td class="td1"><code>array_length(<em>list</em>)==0</code></td>
  <td class="td1"><code>fn:length(<em>list</em>)==0</code></td>
  <td class="td1"><code>(<em>list</em>).size()==0</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>hash_new()</code></td>
  <td class="td1"><code>{}</code></td>
  <td class="td1"><code>array()</code></td>
  <td class="td1">-</td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>hash_length(<em>hash</em>)</code></td>
  <td class="td1"><code><em>hash</em>.length</code></td>
  <td class="td1"><code>array_length(<em>hash</em>)</code></td>
  <td class="td1"><code>fn:length(<em>hash</em>)</code></td>
  <td class="td1"><code><em>hash</em>.size()</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>hash_empty(<em>hash</em>)</code></td>
  <td class="td1"><code><em>hash</em>.empty?</code></td>
  <td class="td1"><code>array_length(<em>hash</em>)==0</code></td>
  <td class="td1"><code>fn:length(<em>hash</em>)==0</code></td>
  <td class="td1"><code><em>hash</em>.size()==0</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>hash_keys(<em>hash</em>)</code></td>
  <td class="td1"><code><em>hash</em>.keys</code></td>
  <td class="td1"><code>array_keys(<em>hash</em>)</code></td>
  <td class="td1">-</td>
  <td class="td1"><code><em>hash</em>.keySet().toArray()</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_length(<em>str</em>)</code></td>
  <td class="td1"><code><em>str</em>.lenth</code></td>
  <td class="td1"><code>strlen(<em>str</em>)</code></td>
  <td class="td1"><code>fn:length(<em>str</em>)</code></td>
  <td class="td1"><code><em>str</em>.length()</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_tolower(<em>str</em>)</code></td>
  <td class="td1"><code><em>str</em>.downcase</code></td>
  <td class="td1"><code>strtolower(<em>str</em>)</code></td>
  <td class="td1"><code>fn:toLowerCase(<em>str</em>)</code></td>
  <td class="td1"><code><em>str</em>.toLowerCase()</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_toupper(<em>str</em>)</code></td>
  <td class="td1"><code><em>str</em>.upcase</code></td>
  <td class="td1"><code>strtoupper(<em>str</em>)</code></td>
  <td class="td1"><code>fn:toUpperCase(<em>str</em>)</code></td>
  <td class="td1"><code><em>str</em>.toUpperCase()</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_index(<em>str</em>,<em>ch</em>)</code></td>
  <td class="td1"><code><em>str</em>.index(<em>ch</em>)</code></td>
  <td class="td1"><code>strchr(<em>str</em>,<em>ch</em>)</code></td>
  <td class="td1"><code>fn:indexOf(<em>str</em>,<em>ch</em>)</code></td>
  <td class="td1"><code><em>str</em>.indexOf(<em>ch</em>)</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_replace(<em>str</em>,<em>before</em>, <em>after</em>)</code></td>
  <td class="td1"><code><em>str</em>.gsub(<em>before</em>,<em>after</em>)</code></td>
  <td class="td1"><code>str_replace(<em>before</em>,<em>after</em>,<em>str</em>)</code></td>
  <td class="td1"><code>fn:replace(<em>str</em>,<em>before</em>,<em>after</em>)</code></td>
  <td class="td1"><code><em>str</em>.indexOf(<em>ch</em>)</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_linebreak(<em>str</em>)</code></td>
  <td class="td1"><code><em>str</em>.gsub(/\r?\n/,'&lt;br /&gt;\&amp;')</code></td>
  <td class="td1"><code>nl2br(<em>str</em>)</code></td>
  <td class="td1"><code>fn:replace(<em>str</em>,'\n','&lt;br /&gt;\n')</code></td>
  <td class="td1"><code><em>str</em>.replaceAll('$','&lt;br /&gt;')</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>escape_xml(<em>str</em>)</code></td>
  <td class="td1"><code>CGI::escapeHTML(<em>str</em>)</code> (when eRuby) <br> <code>html_escape(<em>str</em>)</code> (when ERB)</td>
  <td class="td1"><code>htmlspecialchars(<em>str</em>)</code></td>
  <td class="td1"><code>fn:escapeXml(<em>str</em>)</code></td>
  <td class="td1"><code>$esc.xml(<em>str</em>)</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>escape_url(<em>str</em>)</code></td>
  <td class="td1"><code>CGI::escape(<em>str</em>)</code> (when eRuby) <br> <code>url_encode(<em>str</em>)</code> (when ERB)</td>
  <td class="td1"><code>urlencode(<em>str</em>)</code></td>
  <td class="td1">-</td>
  <td class="td1"><code>$link.setURI(<em>str</em>).toString()</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>escape_sql(<em>str</em>)</code></td>
  <td class="td1"><code><em>str</em>.gsub(/['"\\\0]/,'\\\&amp;')</code></td>
  <td class="td1"><code>addslashes(<em>str</em>)</code></td>
  <td class="td1">-</td>
  <td class="td1"><code>$esc.sql(<em>str</em>)</code></td>
 </tr>
</table>
</div>
<p>All functions except above are printed "as is" when translating into eRuby or PHP script.
Translating into JSTL or Velocity script will be error.
</p>
<p>Functions E() and X() are intended to be used as arguments of print statement.
You shouldn't use them in other place.
</p>
<p>If you want to use the following functions in Velocity, you need to install <a href="http://jakarta.apache.org/velocity/tools/">VelocityTools</a>.
</p>
<ul type="disc">
<li><code>escape_xml()</code> and <code>escape_sql()</code> requires <a href="http://wiki.apache.org/jakarta-velocity/EscapeTool">EscapeTools</a>.
</li>
<li><code>escape_url()</code> requries <a href="http://jakarta.apache.org/velocity/tools/view/LinkTool.html">LinkTools</a>.
</li>
</ul>
<p>See each documentation for details.
</p>
<br>


<a name="pl-empty"></a>
<h3 class="section2">Empty</h3>
<p>'<code>empty</code>' is a keyword used to check whether a value is either null or an empty string.
It can be placed only at the right-side of the operators '<code>==</code>' and '<code>!=</code>'.
</p>
<a name="pl-empty.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">if (str1 == empty) {
  print("str1 is empty.\n");
} else if (str2 != empty) {
  print("str2 is not empty.\n");
}
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% if !str1 || str1.empty? then %&gt;
str1 is empty.
&lt;% elsif str2 &amp;&amp; !str2.empty? then %&gt;
str2 is not empty.
&lt;% end %&gt;

### for PHP
&lt;?php if (!$str1) { ?&gt;
str1 is empty.
&lt;?php } elseif ($str2) { ?&gt;
str2 is not empty.
&lt;?php } ?&gt;

### for JSTL
&lt;c:choose&gt;&lt;c:when test="${empty str1}"&gt;
str1 is empty.
&lt;/c:when&gt;&lt;c:when test="${not empty str2}"&gt;
str2 is not empty.
&lt;/c:when&gt;&lt;/c:choose&gt;

### for Velocity
#if(! $str1 || $str1 == "")
str1 is empty.
#elseif($str2 &amp;&amp; $str2 != "")
str2 is not empty.
#end
</pre>
<br>


<a name="pl-decl"></a>
<h3 class="section2">Element declaration</h3>
<p>Element declaration is description to manipulate elements
marked by '<code>id="<em>name</em>"</code>' or '<code>id="mark:<em>name</em>"</code>',
for example, delete attributes or change presentation logic.
In Kwartz, presentation logic file is described as a set of element declarations.
</p>
<p>Element declaration starts with '<code>#<em>name</em></code>' and is followed by some declaration parts.
</p>
<dl class="dl3">
<dt class="dt3"><strong>
<code>value: <em>expression</em>;</code> </strong></dt>
<dd class="dd3">
	Replace content of the element by value of <code><em>expression</em></code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>attrs: "<em>attr1</em>" <em>expr1</em> , "<em>attr2</em>" <em>expr2</em> , ... ;</code> </strong></dt>
<dd class="dd3">
	Replace value of attribute <code><em>attr</em></code> by value of <code><em>expr</em></code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>remove: "<em>attr1</em>" , "<em>attr2</em>" , ... ;</code> </strong></dt>
<dd class="dd3">
	Remove attribute <code><em>attr</em></code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>append: <em>expr1</em> , <em>expr2</em> , ... ;</code> </strong></dt>
<dd class="dd3">
	Append expression <code><em>expr</em></code> at the end of start tag.
	This is useful for appending <code>checked</code> or <code>selected</code> in &lt;input&gt; tag or &lt;option&gt; tag.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>tagname: <em>expression</em>;</code> </strong></dt>
<dd class="dd3">
	Replace tag name by value of <code><em>expression</em></code>.
	This may be useful for Struts or JSF.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>plogic: { <em>...</em> }</code> </strong></dt>
<dd class="dd3">
	Change the presentation logic of the element.
	<code>@stag</code>, <code>@cont</code>, and <code>@etag</code> are available in <code>{ ... }</code>.
	These represents start tag, content, end tag of the element respectively.
	<code>@element(<em>other</em>)</code> is also available which represents other element
	and <code>@content(<em>other</em>)</code> represents content of other element.
</dd>
</dl>
<a name="pl-decl.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;ul&gt;
  &lt;li id="foo" class="foo"&gt;dummy&lt;/li&gt;
&lt;/ul&gt;

&lt;form action="foo.cgi"&gt;
  &lt;input type="checkbox" name="user" value="Y" checked="checked" id="mark:chkbox"/&gt;
&lt;/form&gt;
</pre>
<a name="pl-decl.plogic"></a>
<div class="program_caption">
Presentation Logic:</div>
<pre class="program">#foo {
  value:  item;
  attrs:  "class" klass;
  plogic: {
    foreach (item in list) {
      @stag;
      @cont;
      @etag;
    }
  }
}
#chkbox {
  remove:  "checked";
  append:  flag ? " checked" : "";
  tagname: "html:text";
}
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;ul&gt;
&lt;% for item in list do %&gt;
  &lt;li id="foo" class="&lt;%= klass %&gt;"&gt;&lt;%= item %&gt;&lt;/li&gt;
&lt;% end %&gt;
&lt;/ul&gt;

&lt;form action="foo.cgi"&gt;
  &lt;html:text type="checkbox" name="user" value="Y"&lt;%= flag ? " checked" : "" %&gt; /&gt;
&lt;/form&gt;

### for PHP
&lt;ul&gt;
&lt;?php foreach ($list as $item) { ?&gt;
  &lt;li id="foo" class="&lt;?php echo $klass; ?&gt;"&gt;&lt;?php echo $item; ?&gt;&lt;/li&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;

&lt;form action="foo.cgi"&gt;
  &lt;html:text type="checkbox" name="user" value="Y"&lt;?php echo $flag ? " checked" : ""; ?&gt; /&gt;
&lt;/form&gt;

### for JSTL 1.1
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;ul&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;li id="foo" class="&lt;c:out value="${klass}" escapeXml="false"/&gt;"&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;/li&gt;
&lt;/c:forEach&gt;
&lt;/ul&gt;

&lt;form action="foo.cgi"&gt;
  &lt;html:text type="checkbox" name="user" value="Y"&lt;c:out value="${flag ? ' checked' : ''}" escapeXml="false"/&gt; /&gt;
&lt;/form&gt;

### for Velocity
&lt;ul&gt;
#foreach($item in $list)
  &lt;li id="foo" class="$!{klass}"&gt;$!{item}&lt;/li&gt;
#end
&lt;/ul&gt;

&lt;form action="foo.cgi"&gt;
#if($flag)
  &lt;html:text type="checkbox" name="user" value="Y" checked /&gt;
#else
  &lt;html:text type="checkbox" name="user" value="Y" /&gt;
#end
&lt;/form&gt;
</pre>
<br>


<a name="pl-doc"></a>
<h3 class="section2">Document declaration</h3>
<p><code>#DOCUMENT { <em>...</em> }</code> is a special element declaration for document.
It represents document information and takes the following declaration parts.
</p>
<dl class="dl3">
<dt class="dt3"><strong>
<code>begin: { <em>...</em> }</code> </strong></dt>
<dd class="dd3">
	Represents PL code which is added at the beginning of the output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>end: { <em>...</em> }</code> </strong></dt>
<dd class="dd3">
	Represents PL code which is added at the end of the output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>require: "<em>filename1</em>" , "<em>filename2</em>", <em>...</em> ;</code> </strong></dt>
<dd class="dd3">
	Load presentation logic file.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>global: <em>varname1</em> , <em>varname2</em> , <em>...</em> ;</code> </strong></dt>
<dd class="dd3">
	List of global variables. Currently this part have no means but will be used in future release.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
<code>local: <em>varname1</em> , <em>varname2</em> , <em>...</em> ;</code> </strong></dt>
<dd class="dd3">
	List of local variables. Currently this part have no means but will be used in future release.
</dd>
</dl>
<a name="pl-doc.html"></a>
<div class="program_caption">
Presentation data:</div>
<pre class="program">&lt;ul id="mark:list"&gt;
  &lt;li id="value:item"&gt;foo&lt;/li&gt;
&lt;/ul&gt;
</pre>
<a name="pl-doc.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">#DOCUMENT {
  begin: {
    list = context[:list];
  }
  end:   {
    print("&lt;!-- copyright(c) 2005 kuwata-lab.com ALL RIGHTS RESERVERD. --&gt;\n");
  }
  global:  context;
}

#list {
  plogic: {
    @stag;
    foreach (item in list)
      @cont;
    @etag;
  }
}
</pre>
<div class="output_caption">
Output script:</div>
<pre class="output">### for eRuby
&lt;% list = context[:list] %&gt;
&lt;ul&gt;
&lt;% for item in list do %&gt;
  &lt;li&gt;&lt;%= item %&gt;&lt;/li&gt;
&lt;% end %&gt;
&lt;/ul&gt;
&lt;!-- copyright(c) 2005 kuwata-lab.com ALL RIGHTS RESERVERD. --&gt;

### for PHP
&lt;?php $list = $context['list']; ?&gt;
&lt;ul&gt;
&lt;?php foreach ($list as $item) { ?&gt;
  &lt;li&gt;&lt;?php echo $item; ?&gt;&lt;/li&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;
&lt;!-- copyright(c) 2005 kuwata-lab.com ALL RIGHTS RESERVERD. --&gt;

### for JSTL
&lt;c:set var="list" value="${context['list']}"/&gt;
&lt;ul&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;li&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;/li&gt;
&lt;/c:forEach&gt;
&lt;/ul&gt;
&lt;!-- copyright(c) 2005 kuwata-lab.com ALL RIGHTS RESERVERD. --&gt;

### for Velocity
#set($list = $context.list)
&lt;ul&gt;
#foreach($item in $list)
  &lt;li&gt;$!{item}&lt;/li&gt;
#end
&lt;/ul&gt;
&lt;!-- copyright(c) 2005 kuwata-lab.com ALL RIGHTS RESERVERD. --&gt;
</pre>
<br>


<a name="pl-rawcode"></a>
<h3 class="section2">Rawcode</h3>
<p>Kwartz allow you to write code of target language (Ruby, PHP, Java, etc) directly in presentation logic.
These are called `Raw Code'.  There are two type of raw code: expression and statement.
</p>
<ul type="disc">
<li><code>&lt;%=<em>expression</em>%&gt;</code> and <code>&lt;?=<em>expression</em>?&gt;</code> represents raw code expression.
   They are treated as literal like string and number.
</li>
<li><code>&lt;%<em>statement</em>%&gt;</code> and <code>&lt;?<em>statement</em>?&gt;</code> represents raw code statement.
   They are treated as a statment. Semicolon ('<code>;</code>') is not needed at the end of the statement.
</li>
</ul>
<p>The following is an example to write Ruby code directly.
</p>
<a name="pl-rawcode1.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">// Rawcode expression
hash = <strong>&lt;%= { :a =&gt; 123, :b =&gt; 456, :c =&gt; 789, } %&gt;</strong>;

// Rawcode statement
<strong>&lt;% hash.each do |key, value| %&gt;</strong>
print("key=", key, " value=", value, "\n");
<strong>&lt;% end %&gt;</strong>
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% hash = { :a =&gt; 123, :b =&gt; 456, :c =&gt; 789, } %&gt;
&lt;% hash.each do |key, value| %&gt;
key=&lt;%= key %&gt; value=&lt;%= value %&gt;
&lt;% end %&gt;
</pre>
<p>The following is an example which includes PHP code.
</p>
<a name="pl-rawcode2.plogic"></a>
<div class="program_caption">
PL Program:</div>
<pre class="program">// Rawcode expression
hash = <strong>&lt;?= array("a"=&gt;123, "b"=&gt;456, "c"=&gt;789) ?&gt;</strong>;

// Rawcode statement
<strong>&lt;?php foreach($hash as $key =&gt; $value) { ?&gt;</strong>
print("key=", key, " value=", value, "\n");
<strong>&lt;?php } ?&gt;</strong>
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for PHP
&lt;?php $hash = array("a"=&gt;123, "b"=&gt;456, "c"=&gt;789); ?&gt;
&lt;?php foreach($hash as $key =&gt; $value) { ?&gt;
key=&lt;?php echo $key; ?&gt; value=&lt;?php echo $value; ?&gt;
&lt;?php } ?&gt;
</pre>
<p>Rawocde statement is available at the `plogic:' part of the element declaration.
Rawcode expression is available at the `value:' part, `attrs:' part, or `append:' part.
You can prevent to sanitize rawcode expression if you write <code>X(&lt;%= <em>...</em> %&gt;)</code>.
</p>
<p>There is an example which use Kwartz with Ruby on Rails in examples/rails1 directory of Kwartz archive.
</p>
<p>You should remember that writing a raw-code takes portability away.
</p>
<br>


<a name="pl-scope"></a>
<h3 class="section2">Global and Local Variables</h3>
<p>In Kwartz, variables are called 'Template Global Variables' if they are set in the main program and are  passed to output script.
Variables are called 'Template Local Variables' if they are used only in the template.
</p>
<p>Assume the following presentation data and presentation logic:
</p>
<a name="analyze.html"></a>
<div class="program_caption">
Presentation data (analyze.html) :</div>
<pre class="program">&lt;table&gt;
  &lt;caption id="value:<strong>title</strong>"&gt;Sample&lt;/caption&gt;
  &lt;tr id="mark:items" bgcolor="@{<strong>color</strong>}@"&gt;
    &lt;td id="value:<strong>item</strong>"&gt;Foo&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</pre>
<a name="analyze.plogic"></a>
<div class="program_caption">
Presentation logic (analyze.plogic) :</div>
<pre class="program">#items {
  plogic: {
    <strong>ctr</strong> = 0;
    foreach (<strong>item</strong> in <strong>list</strong>) {
      <strong>ctr</strong> += 1;
      <strong>color</strong> = <strong>ctr</strong>%2 == 0 ? '#FFCCCC' : '#CCCCFF';
      @stag;
      @cont;
      @etag;
    }
  }
}
</pre>
<p>There are several variables. They are classified as follows:
</p>
<dl class="dl3">
<dt class="dt3"><strong>
Template global variables </strong></dt>
<dd class="dd3">
	The variables '<code>title</code>' and '<code>list</code>' need to be set in the main program and be passed to template.
	These variables are called 'Template Global Variables' in Kwartz.
</dd>
<dt class="dt3"><strong>
Template local variables </strong></dt>
<dd class="dd3">
	The variables '<code>item</code>', '<code>ctr</code>', and '<code>color</code>' are used only in the template.
	These variables are called 'Template Local Variables' in Kwartz.
</dd>
</dl>
<p>Invoking Kwartz with the command-line option '<code>-a analyze</code>' analyzes the template and reports template global/local variables.
</p>
<pre class="terminal">$ kwartz -p analyze.plogic -a analyze analyze.html
Global: <strong>title</strong> <strong>list</strong>
Local:  <strong>ctr</strong> <strong>item</strong> <strong>color</strong>
</pre>
<p>Kwartz detemines whether variables are global or local according to the following rule:
</p>
<ul type="disc">
<li>When Kwartz finds a new variable ...
    <ul type="circle">
    <li>If it appears in the lefthand-side of an assignment, it is to be recognized as a template local variable.
    </li>
    <li>If it appears as the loop variable of a foreach statement, it is to be recognized as a template local variable.
    </li>
    <li>Otherwize, it is to be recognized as a template global variable.
    </li>
    </ul>
</li>
</ul>
<p>Kwartz reports warnings if template global variables appear in the lefthand-side of assignments or are used as loop variables in foreach statements.
Because the role of template system is to display template global variables, templates should not change or modify template global variables.
</p>
<p>Analyzing templates and reporting global/local variables is very useful, especially when the presentation data/logic is large and complex.
It also helps you to find typos of variable names.
</p>
<br>


<a name="pl-infuture"></a>
<h3 class="section2">Features Under Consideration</h3>
<p>The following features are not implemented.
They may be implemented in the future release (or not).
</p>
<ul type="disc">
<li>break, continue
</li>
<li>user-defined functions/procedures
</li>
<li>creating arrays and hashes in JSTL
</li>
</ul>
<br>


<br>


<a name="kd"></a>
<h2 class="section1">Directives</h2>
<a name="kd-whatis"></a>
<h3 class="section2">What is a Directive?</h3>
<p>Kwartz allows presentation logic to be embedded in presentation data.
Commands for that purpose are called 'directives'.
</p>
<p>'Directives' is a set of commands to embed presentation logic into presentation data.
Kwartz uses the id attribute and the kw:d attribute to embed directives in presentation data.
Kw:d is an original attribute of Kwartz, but the ability of id and kw:d attributes are equivalent for Kwartz.
Marking (<code>id="<em>name</em>"</code> or <code>id="mark:<em>name</em>"</code>) is also a directive.
</p>
<p>You may have a question: 
If it is the most important feature for Kwartz that separates presentation logic from presentation data,
why does Kwartz allow me to embed presentation logic into presentation data? 
</p>
<p>The answer is <strong>choosability</strong> - to make it possible for developers to choose either approach.
In other words, to increase options of development styles.
Kwartz doesn't force you to use one approach.
Separate presentation logic and presentation data if you like to separate them, or mix them if you like.
</p>
<p>You may wonder whether Kwartz becomes an ordinary template system if presentation logic is embedded into presentation data.
But Kwartz has the following merits compared to other template systems;
</p>
<ul type="disc">
<li>Kwartz doesn't break HTML design. Compare to <a href="http://jakarta.apache.org/velocity/">Jakarta Velocity</a> or <a href="http://www.template-toolkit.org/">Template-Toolkit</a>.
</li>
<li>Kwartz doesn't need complex programming. Compare to <a href="http://xmlc.objectweb.org/">Enhydra XMLC</a>, which needs complex DOM programming.
</li>
<li>Kwartz works very quickly and is light-weight. Compared to <a href="http://amrita.sourceforge.jp/">amrita</a>.
</li>
<li>Kwartz can handle any type of text. Compare to <a href="http://xmlc.objectweb.org/">Enhydra XMLC</a> or <a href="http://amrita.sourceforge.jp/">amrita</a>.
</li>
<li>Kwartz can be used in several languages. There is no other template system like this!
</li>
</ul>
<br>


<a name="kd-mark"></a>
<h3 class="section2">Marking</h3>
<p>The directive '<code>id="<em>name</em>"</code>' or '<code>id="mark:<em>name</em>"</code>' marks an element
 with a name <code><em>name</em></code>.  This is called 'marking'.
</p>
<p>The difference between '<code>id="<em>name</em>"</code>' and '<code>id="mark:<em>name</em>"</code>' is
 that the former is left in but the latter is removed when compiling.
kw:d attributes are always removed.
</p>
<a name="directive-mark.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;div <strong>id="foo"</strong>&gt;foo&lt;/div&gt;
&lt;div <strong>id="mark:bar"</strong>&gt;bar&lt;/div&gt;
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;

### for PHP
&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;

### for JSTL
&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;

### for Velocity
&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;
</pre>
<br>


<a name="kd-output"></a>
<h3 class="section2">Printing Values of Expressions</h3>
<p>'<code>@{<em>expression</em>}@</code>' is a directive which prints the value of an expression.
This pattern is changeable with a constant EMBED_PATTERN in configuration file (kwartz/config.rb).
</p>
<a name="directive-output.html"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">Hello <strong>@{user.name}@</strong>!
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
Hello &lt;%= user.name %&gt;!

### for PHP
Hello &lt;?php echo $user-&gt;name; ?&gt;!

### for JSTL
Hello &lt;c:out value="${user.name}" escapeXml="false"/&gt;!

### for Velocity
Hello $!{user.name}!
</pre>
<p>Expressions are sanitized if you specified the command-line option '<code>-e</code>' when compiling templates.
Notice that all expressions except string and numbers constants are sanitized.
</p>
<div class="output_caption">
Output Program (with command-line option <code>-e</code>) :</div>
<pre class="output">### for eRuby
Hello &lt;%= CGI::escapeHTML((user.name).to_s) %&gt;!

### for PHP
Hello &lt;?php echo htmlspecialchars($user-&gt;name); ?&gt;!

### for JSTL
Hello &lt;c:out value="${user.name}"/&gt;!

### for Velocity
Hello $!esc.html($user.name)!
</pre>
<p>Using the functions <code>E()</code> or <code>X()</code>, you can toggle sanitizing on/off for each expression.
<code>E(<em>expr</em>)</code> means that the expression <code><em>expr</em></code> is sanitized
and <code>X(<em>expr</em>)</code> means that <code><em>expr</em></code> is not sanitized.
These are not effected by the command-line option '<code>-e</code>'.
</p>
<a name="directive-output2.html"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">With sanitizing:    <strong>@{E(var)}@</strong>!
Without sanitizing: <strong>@{X(var)}@</strong>!
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
With sanitizing:    &lt;%= CGI::escapeHTML((var).to_s) %&gt;!
Without sanitizing: &lt;%= var %&gt;!

### for PHP
With sanitizing:    &lt;?php echo htmlspecialchars($var); ?&gt;!
Without sanitizing: &lt;?php echo $var; ?&gt;!

### for JSTL
With sanitizing:    &lt;c:out value="${var}"/&gt;!
Without sanitizing: &lt;c:out value="${var}" escapeXml="false"/&gt;!

### for Velocity
With sanitizing:    $!esc.html($var)!
Without sanitizing: $!{var}!
</pre>
<p>.
.
</p>
<br>


<a name="kd-value"></a>
<h3 class="section2">Printing value of expression 2</h3>
<p>'<code>id="value:<em>expression</em>"</code>' is a directive to print the value of expression instead of the content.
It is more suitable for HTML design than '<code>@{<em>expression</em>}@</code>' because it allows for the use of dummy data.
</p>
<a name="directive-value.html"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;li <strong>id="value:hash['name']"</strong>&gt;foo&lt;/li&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;li&gt;&lt;%= hash["name"] %&gt;&lt;/li&gt;

### for PHP
&lt;li&gt;&lt;?php echo $hash["name"]; ?&gt;&lt;/li&gt;

### for JSTL
&lt;li&gt;&lt;c:out value="${hash['name']}" escapeXml="false"/&gt;&lt;/li&gt;

### for Velocity
&lt;li&gt;$!{hash["name"]}&lt;/li&gt;
</pre>
<p>'<code>id="Value:<em>expr</em>"</code>' sanitizes the expression.
'<code>id="VALUE:<em>expr</em>"</code>' un-sanitizes the expression.
These are equal to '<code>id="value:E(<em>expr</em>)"</code>' and '<code>id="value:X(<em>expr</em>)"</code>'.
</p>
<br>


<a name="kd-attr"></a>
<h3 class="section2">Attribute Values</h3>
<p>'<code>id="attr:<em>name</em>=<em>value</em>"</code>' (or '<code>id="attr:<em>name</em>:<em>value</em>"</code>') is a directive to set an attribute value.
It overwrites the existing value if attribute <code><em>name</em></code> is already set.
</p>
<p>In the following example, attribute 'class' has the dummy value '<code>odd</code>', and the actual value is derived from the variable '<code>klass</code>'.
</p>
<a name="directive-attr.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;tr class="odd" <strong>id="attr:class=klass"</strong>&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;tr class="&lt;%= klass %&gt;"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;

### for PHP
&lt;tr class="&lt;?php echo $klass; ?&gt;"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;

### for JSTL
&lt;tr class="&lt;c:out value="${klass}" escapeXml="false"/&gt;"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;

### for Velocity
&lt;tr class="$!{klass}"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>'<code>id="Attr:<em>name</em>=<em>value</em>"</code>' sanitizes the value.
'<code>id="ATTR:<em>name</em>=<em>value</em>"</code>' un-sanitizes the value.
These are equal to '<code>id="attr:<em>name</em>=E(<em>value</em>)"</code>' and '<code>id="attr:<em>name</em>=X(<em>value</em>)"</code>'.
</p>
<p>Separating with '<code>;</code>', you can have several '<code>attr:<em>name</em>=<em>value</em></code>' directives in one id attribute.
You can enumerate other attributes this way as well.
</p>
<a name="directive-attr2.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;font id="if:message!=empty<strong>;attr:class=klass;attr:bgcolor=color</strong>"&gt;
 @{message}@
&lt;/font&gt;
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">### for eRuby
&lt;% if message &amp;&amp; !message.empty? then %&gt;
&lt;font class="&lt;%= klass %&gt;" bgcolor="&lt;%= color %&gt;"&gt;
 &lt;%= message %&gt;
&lt;/font&gt;
&lt;% end %&gt;

### for PHP
&lt;?php if ($message) { ?&gt;
&lt;font class="&lt;?php echo $klass; ?&gt;" bgcolor="&lt;?php echo $color; ?&gt;"&gt;
 &lt;?php echo $message; ?&gt;
&lt;/font&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:if test="${not empty message}"&gt;
&lt;font class="&lt;c:out value="${klass}" escapeXml="false"/&gt;" bgcolor="&lt;c:out value="${color}" escapeXml="false"/&gt;"&gt;
 &lt;c:out value="${message}" escapeXml="false"/&gt;
&lt;/font&gt;
&lt;/c:if&gt;

### for Velocity
#if($message &amp;&amp; $message != "")
&lt;font class="$!{klass}" bgcolor="$!{color}"&gt;
 $!{message}
&lt;/font&gt;
#end
</pre>
<br>


<a name="kd-apend"></a>
<h3 class="section2">Appending Attribute Expression</h3>
<p>'<code>id="append:<em>expression</em>"</code>' is a directive to append expression into a tag.
This is useful to output '&lt;input ... checked /&gt;' or '&lt;option ... selected&gt;&lt;/option&gt;'.
</p>
<a name="directive-append.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;option name="lang" value="ruby"
       <strong>id="append:lang=='ruby'?' selected':''"</strong>&gt;Ruby&lt;/option&gt;
&lt;input type="radio" name="gender" value="M"
       <strong>id="append:gender=='M'?' checked':''"</strong>&gt;
</pre>
<div class="program_caption">
Output Script:</div>
<pre class="program">### for eRuby
&lt;option name="lang" value="ruby"&lt;%= lang == "ruby" ? " selected" : "" %&gt;&gt;Ruby&lt;/option&gt;
&lt;input type="radio" name="gender" value="M"&lt;%= gender == "M" ? " checked" : "" %&gt;&gt;

### for PHP
&lt;option name="lang" value="ruby"&lt;?php echo $lang == "ruby" ? " selected" : ""; ?&gt;&gt;Ruby&lt;/option&gt;
&lt;input type="radio" name="gender" value="M"&lt;?php echo $gender == "M" ? " checked" : ""; ?&gt;&gt;

### for JSTL 1.1
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;option name="lang" value="ruby"&lt;c:out value="${lang eq 'ruby' ? ' selected' : ''}" escapeXml="false"/&gt;&gt;Ruby&lt;/option&gt;
&lt;input type="radio" name="gender" value="M"&lt;c:out value="${gender eq 'M' ? ' checked' : ''}" escapeXml="false"/&gt;&gt;

### for JSTL 1.0
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;
&lt;c:choose&gt;&lt;c:when test="${lang eq 'ruby'}"&gt;
&lt;option name="lang" value="ruby" selected&gt;&lt;/c:when&gt;&lt;c:otherwise&gt;
&lt;option name="lang" value="ruby"&gt;&lt;/c:otherwise&gt;&lt;/c:choose&gt;
Ruby&lt;/option&gt;
&lt;c:choose&gt;&lt;c:when test="${gender eq 'M'}"&gt;
&lt;input type="radio" name="gender" value="M" checked&gt;
&lt;/c:when&gt;&lt;c:otherwise&gt;
&lt;input type="radio" name="gender" value="M"&gt;
&lt;/c:otherwise&gt;&lt;/c:choose&gt;
</pre>
<p>A function to output <code>'checked="checked"'</code>, <code>'selected="selected"'</code> and <code>'disabled="disabled"'</code> easily for HTML/XHTML is available in Kwartz.
<code>C(<em>expr</em>)</code>, <code>S(<em>expr</em>)</code>, and <code>D(<em>expr</em>)</code> print <code>' checked="checked"'</code>, <code>' selected="selected"'</code> and <code>' disabled="disabled"'</code> respectively when expression <code><em>expr</em></code> is true.
</p>
<a name="directive-append2.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;option name="lang" value="ruby"
       id="append:<strong>S(lang=='ruby')</strong>"&gt;Ruby&lt;/option&gt;

&lt;input type="radio" name="gender" value="M"
       id="append:<strong>C(gender=='M')</strong>" /&gt;Male

&lt;input type="radio" name="os" value="win"
       id="append:<strong>D(os=='mac')</strong>" /&gt;Windows
</pre>
<div class="program_caption">
Output Script:</div>
<pre class="program">### for PHP
&lt;option name="lang" value="ruby"&lt;?php echo $lang == "ruby" ? " selected=\"selected\"" : ""; ?&gt;&gt;Ruby&lt;/option&gt;

&lt;input type="radio" name="gender" value="M"&lt;?php echo $gender == "M" ? " checked=\"checked\"" : ""; ?&gt; /&gt;Male

&lt;input type="radio" name="os" value="win"&lt;?php echo $os == "mac" ? " disabled=\"disabled\"" : ""; ?&gt; /&gt;Windows

### for eRuby
&lt;option name="lang" value="ruby"&lt;%= lang == "ruby" ? " selected=\"selected\"" : "" %&gt;&gt;Ruby&lt;/option&gt;

&lt;input type="radio" name="gender" value="M"&lt;%= gender == "M" ? " checked=\"checked\"" : "" %&gt; /&gt;Male

&lt;input type="radio" name="os" value="win"&lt;%= os == "mac" ? " disabled=\"disabled\"" : "" %&gt; /&gt;Windows

### for JSTL 1.1
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;option name="lang" value="ruby"&lt;c:out value="${lang eq 'ruby' ? ' selected="selected"' : ''}" escapeXml="false"/&gt;&gt;Ruby&lt;/option&gt;

&lt;input type="radio" name="gender" value="M"&lt;c:out value="${gender eq 'M' ? ' checked="checked"' : ''}" escapeXml="false"/&gt; /&gt;Male

&lt;input type="radio" name="os" value="win"&lt;c:out value="${os eq 'mac' ? ' disabled="disabled"' : ''}" escapeXml="false"/&gt; /&gt;Windows

### for JSTL 1.0
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;
&lt;c:choose&gt;&lt;c:when test="${lang eq 'ruby'}"&gt;
&lt;option name="lang" value="ruby" selected="selected"&gt;&lt;/c:when&gt;&lt;c:otherwise&gt;
&lt;option name="lang" value="ruby"&gt;&lt;/c:otherwise&gt;&lt;/c:choose&gt;
Ruby&lt;/option&gt;

&lt;c:choose&gt;&lt;c:when test="${gender eq 'M'}"&gt;
&lt;input type="radio" name="gender" value="M" checked="checked" /&gt;&lt;/c:when&gt;&lt;c:otherwise&gt;
&lt;input type="radio" name="gender" value="M" /&gt;&lt;/c:otherwise&gt;&lt;/c:choose&gt;
Male

&lt;c:choose&gt;&lt;c:when test="${os eq 'mac'}"&gt;
&lt;input type="radio" name="os" value="win" disabled="disabled" /&gt;&lt;/c:when&gt;&lt;c:otherwise&gt;
&lt;input type="radio" name="os" value="win" /&gt;&lt;/c:otherwise&gt;&lt;/c:choose&gt;
Windows
</pre>
<br>


<a name="kd-set"></a>
<h3 class="section2">Assignment</h3>
<p>'<code>id="set:<em>var</em>=<em>value</em>"</code>' is a directive for assigning values into variables.
Other than '<code>=</code>', '<code>+=</code>', '<code>-=</code>', '<code>*=</code>', '<code>/=</code>', '<code>.=</code>' are also available.
</p>
<a name="directive-set.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;dt <strong>id="set:var=value"</strong>&gt;foo&lt;/dt&gt;
&lt;dd <strong>id="set:count+=1"</strong>&gt;123&lt;/dd&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;% var = value %&gt;
&lt;dt&gt;foo&lt;/dt&gt;
&lt;% count += 1 %&gt;
&lt;dd&gt;123&lt;/dd&gt;

### for PHP
&lt;?php $var = $value; ?&gt;
&lt;dt&gt;foo&lt;/dt&gt;
&lt;?php $count += 1; ?&gt;
&lt;dd&gt;123&lt;/dd&gt;

### for JSTL
&lt;c:set var="var" value="${value}"/&gt;
&lt;dt&gt;foo&lt;/dt&gt;
&lt;c:set var="count" value="${count + 1}"/&gt;
&lt;dd&gt;123&lt;/dd&gt;

### for Velocity
#set($var = $value)
&lt;dt&gt;foo&lt;/dt&gt;
#set($count = $count + 1)
&lt;dd&gt;123&lt;/dd&gt;
</pre>
<br>


<a name="kd-if"></a>
<h3 class="section2">Conditional Branching</h3>
<p>'<code>id="if:<em>expression</em>"</code>' is a directive for conditional branching.
'<code>else</code>' and '<code>elseif</code>' are also available.
</p>
<a name="directive-if.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;div <strong>id="if:value &gt; 0"</strong>&gt;
  Value is positive.
&lt;/div&gt;
&lt;div <strong>id="elseif:value &lt; 0"</strong>&gt;
  Value is negative.
&lt;/div&gt;
&lt;div <strong>id="else:"</strong>&gt;
  Value is zero.
&lt;/div&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;% if value &gt; 0 then %&gt;
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
&lt;% elsif value &lt; 0 then %&gt;
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
&lt;% else %&gt;
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
&lt;% end %&gt;

### for PHP
&lt;?php if ($value &gt; 0) { ?&gt;
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
&lt;?php } elseif ($value &lt; 0) { ?&gt;
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
&lt;?php } else { ?&gt;
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:choose&gt;&lt;c:when test="${value gt 0}"&gt;
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
&lt;/c:when&gt;&lt;c:when test="${value lt 0}"&gt;
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
&lt;/c:when&gt;&lt;c:otherwise&gt;
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
&lt;/c:otherwise&gt;&lt;/c:choose&gt;

### for Velocity
#if($value &gt; 0)
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
#elseif($value &lt; 0)
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
#else
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
#end
</pre>
<p>If using '<code>elseif</code>' or '<code>else</code>' directives, don't insert empty lines just before.
</p>
<br>


<a name="kd-foreach"></a>
<h3 class="section2">Iteration (foreach)</h3>
<p>'<code>id="foreach:<em>loopvar</em>=<em>list</em>)"</code>' (or '<code>id="foreach:<em>loopvar</em>:<em>list</em>)"</code>') is a directive for iteration, assigning each value in the array into a variable each time through the loop.
</p>
<a name="directive-foreach.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;tr <strong>id="foreach:item=list"</strong>&gt;
  &lt;td&gt;@{item}@&lt;/td&gt;
&lt;/tr&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;% for item in list do %&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;%= item %&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;% end %&gt;

### for PHP
&lt;?php foreach ($list as $item) { ?&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;?php echo $item; ?&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:forEach var="item" items="${list}"&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;

### for Velocity
#foreach($item in $list)
&lt;tr&gt;
  &lt;td&gt;$!{item}&lt;/td&gt;
&lt;/tr&gt;
#end
</pre>
<br>


<a name="kd-list"></a>
<h3 class="section2">Iteration(list)</h3>
<p>'<code>id="list:<em>loopvar</em>=<em>list</em>"</code>' (or '<code>id="list:<em>loopvar</em>:<em>list</em>"</code>') is a directive for iteration.
It iterates only contents. The start tag and the end tag are not iterated.
It is very useful especially for &lt;dl&gt;&lt;/dl&gt; tag.
</p>
<a name="directive-list.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;dl <strong>id="list:item=list"</strong>&gt;
  &lt;dt&gt;@{item.text}@&lt;/dt&gt;
  &lt;dd&gt;@{item.desc}@&lt;/dd&gt;
&lt;/dl&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;dl&gt;
&lt;% for item in list do %&gt;
  &lt;dt&gt;&lt;%= item.text %&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;%= item.desc %&gt;&lt;/dd&gt;
&lt;% end %&gt;
&lt;/dl&gt;

### for PHP
&lt;dl&gt;
&lt;?php foreach ($list as $item) { ?&gt;
  &lt;dt&gt;&lt;?php echo $item-&gt;text; ?&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;?php echo $item-&gt;desc; ?&gt;&lt;/dd&gt;
&lt;?php } ?&gt;
&lt;/dl&gt;

### for JSTL
&lt;dl&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;dt&gt;&lt;c:out value="${item.text}" escapeXml="false"/&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;c:out value="${item.desc}" escapeXml="false"/&gt;&lt;/dd&gt;
&lt;/c:forEach&gt;
&lt;/dl&gt;

### for Velocity
&lt;dl&gt;
#foreach($item in $list)
  &lt;dt&gt;$!{item.text}&lt;/dt&gt;
  &lt;dd&gt;$!{item.desc}&lt;/dd&gt;
#end
&lt;/dl&gt;
</pre>
<p><span style="color:#FF0000">NOTICE: <code>list</code> directive was named <code>loop</code> in previous version of Kwartz-ruby.</span>
<span style="color:#FF0000">However <code>loop</code> directive is planned to mean as inner loop of <code>while</code>,</span>
<span style="color:#FF0000">so you should use <code>list</code> directive from now on.</span>
</p>
<br>


<a name="kd-foreach2"></a>
<h3 class="section2">Iteration with Count</h3>
<p>'<code>id="Foreach:<em>var</em>=<em>list</em>"</code>' and '<code>id="List:<em>var</em>=<em>list</em>"</code>' are directives for iteration with loop counting.
The counter variable is <code><em>var</em>_ctr</code>. It starts at 1.
</p>
<a name="directive-foreach2.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;tr <strong>id="Foreach:item=list"</strong>&gt;
  &lt;td&gt;@{item_ctr}@&lt;/td&gt;
  &lt;td&gt;@{item}@&lt;td&gt;
&lt;/tr&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;% item_ctr = 0 %&gt;
&lt;% for item in list do %&gt;
&lt;%   item_ctr += 1 %&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;%= item_ctr %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;%= item %&gt;&lt;td&gt;
&lt;/tr&gt;
&lt;% end %&gt;

### for PHP
&lt;?php $item_ctr = 0; ?&gt;
&lt;?php foreach ($list as $item) { ?&gt;
&lt;?php   $item_ctr += 1; ?&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;?php echo $item_ctr; ?&gt;&lt;/td&gt;
  &lt;td&gt;&lt;?php echo $item; ?&gt;&lt;td&gt;
&lt;/tr&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:set var="item_ctr" value="0"/&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;c:set var="item_ctr" value="${item_ctr + 1}"/&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;c:out value="${item_ctr}" escapeXml="false"/&gt;&lt;/td&gt;
  &lt;td&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;

### for Velocity
#set($item_ctr = 0)
#foreach($item in $list)
  #set($item_ctr = $item_ctr + 1)
&lt;tr&gt;
  &lt;td&gt;$!{item_ctr}&lt;/td&gt;
  &lt;td&gt;$!{item}&lt;td&gt;
&lt;/tr&gt;
#end
</pre>
<p><span style="color:#FF0000">NOTICE: <code>List</code> directive was named <code>Loop</code> in previous version of Kwartz-ruby.</span>
<span style="color:#FF0000">However <code>Loop</code> directive is planned to mean as inner loop of <code>while</code>,</span>
<span style="color:#FF0000">so you should use <code>List</code> directive from now on.</span>
</p>
<br>


<a name="kd-foreach3"></a>
<h3 class="section2">Iteration with a Toggle Switch</h3>
<p>'<code>id="FOREACH:<em>var</em>=<em>list</em>"</code>' and '<code>id="LIST:<em>var</em>=<em>list</em>"</code>' are directives for iteration with toggle switching.
The toggle switch's value changes depending on whether loop counter is odd or even.
The toggle switch is named <code><em>var</em>_tgl</code>.
The value of the toggle switch is '<code>"odd"</code>' or '<code>"even"</code>' by default.
You can change them with the command-line option '<code>--odd=<em>value</em></code>' and '<code>--even=<em>value</em></code>',
or constant variable ODD and EVEN in configuration file kwartz/config.rb.
</p>
<a name="directive-foreach3.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;table&gt;
  &lt;tbody <strong>id="LIST:item=list"</strong>&gt;
    &lt;tr class="<strong>@{item_tgl}@</strong>"&gt;
      &lt;td&gt;@{item}@&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;table&gt;
  &lt;tbody&gt;
&lt;% item_ctr = 0 %&gt;
&lt;% for item in list do %&gt;
&lt;%   item_ctr += 1 %&gt;
&lt;%   item_tgl = item_ctr % 2 == 0 ? "even" : "odd" %&gt;
    &lt;tr class="&lt;%= item_tgl %&gt;"&gt;
      &lt;td&gt;&lt;%= item %&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;% end %&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

### for PHP
&lt;table&gt;
  &lt;tbody&gt;
&lt;?php $item_ctr = 0; ?&gt;
&lt;?php foreach ($list as $item) { ?&gt;
&lt;?php   $item_ctr += 1; ?&gt;
&lt;?php   $item_tgl = $item_ctr % 2 == 0 ? "even" : "odd"; ?&gt;
    &lt;tr class="&lt;?php echo $item_tgl; ?&gt;"&gt;
      &lt;td&gt;&lt;?php echo $item; ?&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;?php } ?&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

### for JSTL
&lt;table&gt;
  &lt;tbody&gt;
&lt;c:set var="item_ctr" value="0"/&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;c:set var="item_ctr" value="${item_ctr + 1}"/&gt;
  &lt;c:set var="item_tgl" value="${item_ctr % 2 eq 0 ? 'even' : 'odd'}"/&gt;
    &lt;tr class="&lt;c:out value="${item_tgl}" escapeXml="false"/&gt;"&gt;
      &lt;td&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;/c:forEach&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

### for Velocity
&lt;table&gt;
  &lt;tbody&gt;
#set($item_ctr = 0)
#foreach($item in $list)
  #set($item_ctr = $item_ctr + 1)
  #if($item_ctr % 2 == 0)
    #set($item_tgl = "even")
  #else
    #set($item_tgl = "odd")
  #end
    &lt;tr class="$!{item_tgl}"&gt;
      &lt;td&gt;$!{item}&lt;/td&gt;
    &lt;/tr&gt;
#end
  &lt;/tbody&gt;
&lt;/table&gt;
</pre>
<p><span style="color:#FF0000">NOTICE: <code>LIST</code> directive was named <code>LOOP</code> in previous version of Kwartz-ruby.</span>
<span style="color:#FF0000">However <code>LOOP</code> directive is planned to mean as inner loop of <code>while</code>,</span>
<span style="color:#FF0000">so you should use <code>LIST</code> directive from now on.</span>
</p>
<br>


<a name="kd-while"></a>
<h3 class="section2">Iteration (while)</h3>
<p>'<code>id="while:<em>expression</em>"</code>' is a directive to iterate with a while statement. 
</p>
<p>Kwartz will raise an error when compiling a while statement into JSP or Velocity,
because there is no custom tag in JSTL nor Directives in Velocity which is equivalent to while statement.
</p>
<a name="directive-while.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;table <strong>id="while:row=sth.fetch()"</strong>&gt;
  &lt;tr&gt;&lt;td&gt;name:&lt;/td&gt;&lt;td&gt;@{row[0]}@&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;mail:&lt;/td&gt;&lt;td&gt;@{row[1]}@&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;% while row = sth.fetch() do %&gt;
&lt;table&gt;
  &lt;tr&gt;&lt;td&gt;name:&lt;/td&gt;&lt;td&gt;&lt;%= row[0] %&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;mail:&lt;/td&gt;&lt;td&gt;&lt;%= row[1] %&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;% end %&gt;

### for PHP
&lt;?php while ($row = $sth-&gt;fetch()) { ?&gt;
&lt;table&gt;
  &lt;tr&gt;&lt;td&gt;name:&lt;/td&gt;&lt;td&gt;&lt;?php echo $row[0]; ?&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;mail:&lt;/td&gt;&lt;td&gt;&lt;?php echo $row[1]; ?&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;?php } ?&gt;
</pre>
<br>


<a name="kd-loop"></a>
<h3 class="section2">Iteration (loop)</h3>
<p><span style="color:#FF0000">CAUTION: This is a plan and not implemented yet</span>
</p>
<p>'<code>id="loop:<em>expression</em>"</code>' is a directive to iterate with a while statement. 
Difference between <code>while</code> directive is that <code>loop</code> directive iterates only content of the element
and <code>while</code> directive iterates start tag, content, and end tag of the element.
</p>
<p>Kwartz will raise an error when compiling a while statement into JSP or Velocity,
because there is no custom tag in JSTL nor Directives in Velocity which is equivalent to loop(while) statement.
</p>
<a name="directive-loop.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;table <strong>id="loop:row=sth.fetch()"</strong>&gt;
  &lt;tr&gt;&lt;td&gt;name:&lt;/td&gt;&lt;td&gt;@{row[0]}@&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;mail:&lt;/td&gt;&lt;td&gt;@{row[1]}@&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">### for eRuby
&lt;table&gt;
&lt;% while row = sth.fetch() do %&gt;
  &lt;tr&gt;&lt;td&gt;name:&lt;/td&gt;&lt;td&gt;&lt;%= row[0] %&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;mail:&lt;/td&gt;&lt;td&gt;&lt;%= row[1] %&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;% end %&gt;
&lt;/table&gt;

### for PHP
&lt;table&gt;
&lt;?php while ($row = $sth-&gt;fetch()) { ?&gt;
  &lt;tr&gt;&lt;td&gt;name:&lt;/td&gt;&lt;td&gt;&lt;?php echo $row[0]; ?&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;mail:&lt;/td&gt;&lt;td&gt;&lt;?php echo $row[1]; ?&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;?php } ?&gt;
&lt;/table&gt;
</pre>
<br>


<a name="kd-dummy"></a>
<h3 class="section2">Dummy data</h3>
<p>'<code>id="dummy:<em>str</em>"</code>' is a directive for ignoring an element.
</p>
<p>'<code><em>str</em></code>' has no effect. It is to make id attribute value to be unique in the HTML file.
</p>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;tr <strong>id="dummy:d1"</strong>&gt;
  &lt;td&gt;bar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr <strong>id="dummy:d2"</strong>&gt;
  &lt;td&gt;baz&lt;/td&gt;
&lt;/tr&gt;
</pre>
<div class="output_caption">
Intermediate Code:</div>
<pre class="output">                          // Nothing
</pre>
<div class="output_caption">
Output Program:</div>
<pre class="output">                          // Nothing
</pre>
<br>


<a name="kd-replace"></a>
<h3 class="section2">Replacement of Elements</h3>
<p>'<code>id="replace:<em>name</em>"</code>' replaces an element with other element
which is already marked with the name <em>name</em>.
'<code>id="replace:<em>name</em>:content"</code>' replaces an element with content of other element.
</p>
<a name="directive-replace.pdata"></a>
<div class="program_caption">
Presentation Data:</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;
    &lt;!-- breadcrumbs navigation --&gt;
    &lt;div <strong>id="mark:breadcrumbs"</strong>&gt;
      &lt;a href="/"&gt;Home&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz"&gt;Kwartz&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz/ruby"&gt;Kwartz-ruby&lt;/a&gt;
    &lt;/div&gt;

   ....

    &lt;!-- replace an element by other element --&gt;
    &lt;div <strong>id="replace:breadcrumbs"</strong>&gt;
      Home &amp;gt; Kwartz &amp;gt; Kwartz-ruby
    &lt;/div&gt;

    &lt;!-- replace an element by content of other element --&gt;
    &lt;div <strong>id="replace:breadcrumbs:content"</strong>&gt;
      Home &amp;gt; Kwartz &amp;gt; Kwartz-ruby
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/html
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">&lt;html&gt;
  &lt;body&gt;
    &lt;!-- breadcrumbs navigation --&gt;
    &lt;div&gt;
      &lt;a href="/"&gt;Home&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz"&gt;Kwartz&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz/ruby"&gt;Kwartz-ruby&lt;/a&gt;
    &lt;/div&gt;

   ....

    &lt;!-- replace an element by other element --&gt;
    &lt;div&gt;
      &lt;a href="/"&gt;Home&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz"&gt;Kwartz&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz/ruby"&gt;Kwartz-ruby&lt;/a&gt;
    &lt;/div&gt;

    &lt;!-- replace an element by content of other element --&gt;
      &lt;a href="/"&gt;Home&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz"&gt;Kwartz&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz/ruby"&gt;Kwartz-ruby&lt;/a&gt;

  &lt;/body&gt;
&lt;/html
</pre>
<p>The command-line option '<code>-i <em>file1</em>,<em>file2</em>,<em>...</em></code>' enables you to use elements
in other files.
</p>
<br>


<a name="kd-placeholder"></a>
<h3 class="section2">Placeholder</h3>
<p>'<code>id="placeholder:<em>name</em>"</code>' replaces content of the element by other element
which is already marked with the name <em>name</em>.
'<code>id="placeholder:<em>name</em>:content"</code>' replaces content of the element by content of other element.
Usually this directive is used to import elements defined in other files,
with the command-line option <code>-i <em>file1</em>,<em>file2</em>,<em>...</em></code>.
</p>
<a name="directive-placeholder-article.pdata"></a>
<div class="program_caption">
Presentation Data(article.html):</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    &lt;h1 <strong>id="mark:title"</strong>&gt;Kwartz Reference Manual&lt;/h1&gt;

    &lt;div <strong>id="mark:article"</strong>&gt;
      &lt;p&gt;Kwartz is a template system, which realized the
         concept &lt;strong&gt;`Separation of Presentation Logic
         and Presentation Data'(SoPL/PD)&lt;/strong&gt;.
      &lt;/p&gt;
    &lt;/div&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="directive-placeholder-layout.pdata"></a>
<div class="program_caption">
Presentation Data(layout.html):</div>
<pre class="program">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title <strong>id="placeholder:title:content"</strong>&gt;...title...&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
    &lt;link rel="stylesheet" type="text/css" href="design.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;h1 <strong>id="placeholder:title:content"</strong>&gt;...title...&lt;/h1&gt;

    &lt;table border="0"&gt;
      &lt;tr&gt;
        &lt;td width="400" <strong>id="placeholder:article:content"</strong>&gt;
          aaa&lt;br&gt;
          bbb&lt;br&gt;
          ccc&lt;br&gt;
          ddd&lt;br&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<div class="terminal_caption">
Compile:</div>
<pre class="terminal">$ kwartz <strong>-i article.html</strong> layout.html
</pre>
<div class="output_caption">
Output Script:</div>
<pre class="output">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;Kwartz Reference Manual&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
    &lt;link rel="stylesheet" type="text/css" href="design.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;h1&gt;Kwartz Reference Manual&lt;/h1&gt;

    &lt;table border="0"&gt;
      &lt;tr&gt;
        &lt;td width="400"&gt;
      &lt;p&gt;Kwartz is a template system, which realized the
         concept &lt;strong&gt;`Separation of Presentation Logic
         and Presentation Data'(SoPL/PD)&lt;/strong&gt;.
      &lt;/p&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<a name="kd-include"></a>
<h3 class="section2">Including Presentation Data Files</h3>
<p><code>id="include:<em>filename</em>"</code> is a directive to read and to include another presentation data file (HTML file).
Included data file can contain directives.
</p>
<a name="copyright.html"></a>
<div class="program_caption">
Presentation Data (copyright.html) :</div>
<pre class="program">&lt;!-- begin footer --&gt;
&lt;center&gt;
  copyright&amp;copy; &lt;span id="value:year"&gt;2005&lt;/span&gt; kuwata-lab all rights reserverd
&lt;/center&gt;
&lt;!-- end footer --&gt;
</pre>
<a name="mainpage.html"></a>
<div class="program_caption">
Presentation Data (mainpage.html) :</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    ... main contents ...

    &lt;div id="include:copyright.html"&gt;
      ... copyright ...
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<div class="terminal_caption">
Compile:</div>
<pre class="terminal">$ kwartz -l eruby mainpage.html &gt; mainpage.view
</pre>
<div class="program_caption">
Output Script:</div>
<pre class="program">### for eRuby
&lt;html&gt;
  &lt;body&gt;

    ... main contents ...

&lt;!-- begin footer --&gt;
&lt;center&gt;
  copyright&amp;copy; &lt;%= year %&gt; kuwata-lab all rights reserverd
&lt;/center&gt;
&lt;!-- end footer --&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>'<code>Include</code>' and '<code>INCLUDE</code>' directives are also available.
</p>
<ul type="disc">
<li>'<code>include</code>' directive replaces the element by presentation data included.
</li>
<li>'<code>Include</code>' directive inserts the presentation data included before the element.
</li>
<li>'<code>INCLUDE</code>' directive inserts the presentation data included after the element.
</li>
</ul>
<p>When presentation data files to be included are placed in other directories,
you can specify those directories with the command-line option <code>--incdirs=<em>dir1</em>,<em>dir2</em>,...</code>
or the constant <code>INCDIRS</code> in configuration file.
</p>
<br>


<a name="kd-idkd"></a>
<h3 class="section2">id and kw:d Attributes</h3>
<ul type="disc">
<li>The kw:d attribute is equivalent to the id attribute in Kwartz.
   Anything that can go in an id attribute can also be placed in a kw:d attribute.
</li>
</ul>
<ul type="disc">
<li>If a tag has both an id attribute and a kw:d attribte,
   Kwartz overrides the former with the latter.
   For example, if you write '<code>id="name" kw:d="foreach:item=list"</code>',
</li>
</ul>
<ul type="disc">
<li>However, if the kw:d attribute has only <code>attr</code> directives,
   then the id attribute is not overwritten.
   For example, if you write '<code>id="name" kw:d="attr:href=url"</code>,
   the element is marked with the name <code>name</code>.
</li>
</ul>
<ul type="disc">
<li>The HTML Specification defines that the id attribute value can contain only alphanumeric characters, underscores (<code>_</code>), colons(<code>:</code>), hyphens(<code>-</code>) and periods(<code>.</code>).
   Other characters cannot be in the id attribute.
   This means that <code>id="foreach:item=list"</code> or <code>id="attr:name=value"</code> are not valid according to the HTML Specification.
   Therefore, it is recommended to write <code>id="foreach:item:list"</code> or <code>id="attr:name:value"</code> instead.
</li>
</ul>
<ul type="disc">
<li>You can change the kw:d attribte name with the command-line option <code>--dattr=<em>xxx</em></code>.
   For example, <code>--dattr=style</code> make Kwartz to use 'style' attributes instead of 'kw:d' attributes.
   Constant <code>DATTR</code> in configuration file also enables you to change 'kw:d' attribute name.
</li>
</ul>
<br>


<a name="kd-notes"></a>
<h3 class="section2">Notes</h3>
<p>These are some notes on the use of directives.
</p>
<ul type="disc">
<li>One id or kw:d attribute can have only one directive.
   For example, '<code>id="set:var=100;value:var"</code>' causes an error.
<pre class="program">## NG
&lt;span id="set:var=100;value:var"&gt;foo&lt;/span&gt;
</pre>
</li>
</ul>
<ul type="disc">
<li>However, the '<code>attr:<em>name</em>=<em>value</em></code>' directive and the '<code>append=<em>expression</em></code>' directive can be used with other directive in an id attribute,
   as well as with itself.
<pre class="program">## OK
&lt;foo id="foreach:item=list;attr:class=item.class;attr:href=item.url"&gt;
....
&lt;/foo&gt;
</pre>
</li>
</ul>
<ul type="disc">
<li>You cannot omit end-tags when using Kwartz directives.
   But you can use empty-element tags, such as '<code>&lt;foo .../&gt;</code>'.
<pre class="program">## NG
&lt;ul&gt;
  &lt;li id="value:item"&gt;foo
&lt;/ul&gt;
## OK
&lt;a id="attr:name=refname"/&gt;
</pre>
</li>
</ul>
<ul type="disc">
<li>The &lt;span&gt;&lt;/span&gt; tag is deleted if it has only directives.
   For example, the presentation data '<code>Hello &lt;span id="value:name"&gt;World&lt;/span&gt;!</code>' will be converted into the output script '<code>Hello &lt;%= name %&gt;!</code>' (in eRuby), deleting &lt;span&gt;&lt;/span&gt;.
<pre class="program">## presentation data
Hello &lt;span id="value:name"&gt;World&lt;/span&gt;!
## output script for eRuby
Hello &lt;%= name %&gt;!
</pre>
</li>
</ul>
<ul type="disc">
<li>You must describe attributes like <code><em>attr</em>="<em>value</em>"</code> in the start tag which contains directives.
   In other words, you cannot omit attribute names or attribute values when using directives.
   This is not a bug; it's an intended behavior so as to make Kwartz available in any text file.
<pre class="program">## NG
&lt;input type="checkbox" id="foreach:item=list" <strong>checked</strong>/&gt;
## OK
&lt;input type="checkbox" id="foreach:item=list" <strong>checked="checked"</strong>/&gt;

## NG
&lt;option id="attr:value=val" @{flag ? 'selected' : ''}@/&gt;
## OK
&lt;option value="@{val}@" @{flag ? 'selected' : ''}@&gt;
</pre>
</li>
</ul>
<br>


<br>


<a name="plogic"></a>
<h2 class="section1">Presentation Logic File Format</h2>
<p>The following is an example of presentation logic file.
</p>
<div class="program_caption">
Presentation logic:</div>
<pre class="program">// element declaration for 'id="mark:<em>name</em>"'
#<em>name</em> {
  
  // print value of expression instead of content
  value:  <em>expression</em>;
  
  // set attribute values
  attrs: "<em>attr1</em>" <em>expr1</em>, "<em>attr2</em>" <em>expr2</em>, "<em>attr3</em>" <em>expr3</em>;
  
  // remove attributes
  remove:  "<em>attr1</em>", "<em>attr2</em>", "<em>attr3</em>";
  
  // append expression to start tag
  append:  <em>expr1</em>, <em>expr2</em>, <em>expr3</em>;
  
  // change tag name
  tagname: "<em>tagname</em>",

  // set presentation logic
  plogic: {
    @stag;
    @cont;
    @etag;
  }
}

// document declaration
#DOCUMENT {
  // logics to do at the beginning of the document
  begin: {
    ...
  }

  // logics to do at the end of the document
  end: {
    ...
  }
  
  // load presentation logic file required
  require: "file1.plogic", "file2.plogic";
}
</pre>
<br>


<a name="opt"></a>
<h2 class="section1">Command-line options</h2>
<p>The script 'kwartz' is a commad-line script to compile templates (presentation data file and presentation logic file) into output scripts.
</p>
<p>Usage:
<strong><code>kwartz [options...] [-p plogic ] pdata.html &gt; output-script</code></strong>
</p>
<p>Options:
</p>
<dl class="dl3">
<dt class="dt3"><strong>
-h, --help</strong></dt>
<dd class="dd3">
	Print help.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
-v</strong></dt>
<dd class="dd3">
	Version information.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
-a <em>action</em></strong></dt>
<dd class="dd3">
	Action to do. <em>action</em> may be one of the following (default is 'compile').
	<dl class="dl1" compact>
	<dt class="dt1">
compile</dt>
	<dd class="dd1">
		Read presentation data and presentation logic, and generate output script.
	</dd>
	<dt class="dt1">
analyze</dt>
	<dd class="dd1">
		Read presentation data and presentation logic, and report scope of variables.
	</dd>
	<dt class="dt1">
defun</dt>
	<dd class="dd1">
		Read presentation data and presentation logic, and define function of Ruby or PHP.
	</dd>
	<dt class="dt1">
convert</dt>
	<dd class="dd1">
		Read presentation data, and convert to PL program. This is for debugging.
	</dd>
	<dt class="dt1">
translate</dt>
	<dd class="dd1">
		Read PL program, and translate into output script. This is for debugging.
	</dd>
	</dl>
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
-e , -s</strong></dt>
<dd class="dd3">
	Enable auto-sanitizing. This option is equal to <code>--escape=true</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
-i <em>file1,file2,...</em></strong></dt>
<dd class="dd3">
	Import elements defined in outer files.
	Usually this option is used for 'placeholder' directive ('<code>id="placeholder:<em>name</em></code>').
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
-l <em>lang</em></strong></dt>
<dd class="dd3">
	Target language of the output script. <em>lang</em> may be
	eruby, erb, php, jstl11, jstl10, velocity.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
-p <em>plogic-file</em></strong></dt>
<dd class="dd3">
	Filename of the presentation logics. It is possible to specify several filename using '<code>,</code>' as a separator.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
-R <em>arg</em></strong></dt>
<dd class="dd3">
	Special option. Currently, only the following argument is avairable.
	<ul type="disc">
	<li>ails ... Equivarent to <code>-l erb --globalvar-prefix='@'</code>. Make output script for Ruby on Rails.
	</li>
	</ul>
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--charset=<em>charset</em></strong></dt>
<dd class="dd3">
	Character set. Kwartz will print '<code>&lt;%@ page contentType="text/html; charset=<em>charset</em>" %&gt;</code>' in JSTL.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--dname=<em>name</em></strong></dt>
<dd class="dd3">
	Attribute name used as a directive. Default is 'kw:d'.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--escape=<em>true</em>|<em>false</em></strong></dt>
<dd class="dd3">
	Auto-sanitizing. If value is ommited then true is used as value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--even=<em>value</em></strong></dt>
<dd class="dd3">
	Even value. Default is <code>'even'</code>. Directives FOREACH and LIST will use this value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--extract=<em>name</em></strong></dt>
<dd class="dd3">
	Extract an element which is marked with name <em>name</em>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--footer=<em>string</em></strong></dt>
<dd class="dd3">
	Footer string.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--header=<em>string</em></strong></dt>
<dd class="dd3">
	Header string.
	'<code>&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;</code>' is used as default in JSP.
	If you don't want to print any header text, use <code>--header=false</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--indent=' '</strong></dt>
<dd class="dd3">
	Specifies the indent space of output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--incdirs=<em>dir1</em>,<em>dir2</em>,...</strong></dt>
<dd class="dd3">
	Specify directories from which '<code>include</code>' directive includes.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--odd=<em>value</em></strong></dt>
<dd class="dd3">
	Odd value. Default is <code>'odd'</code>. Directives FOREACH and LIST will use this value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--localvar-prefix=<em>string</em></strong></dt>
<dd class="dd3">
	Prefix of template local variables.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
--globalvar-prefix=<em>string</em></strong></dt>
<dd class="dd3">
	Prefix of template global variables.
</dd>
</dl>
<p>Examples:
</p>
<ul type="disc">
<li>Compile presentation data file 'file1.html' and get an output script 'file1.rhtml'.
	The target language is eRuby.
<pre class="terminal">$ kwartz -l eruby file1.html &gt; file1.rhtml
</pre>
</li>
</ul>
<ul type="disc">
<li>Compile presentation data file 'file1.html' and a presentation logic file 'file1.plogic', and get an output script 'file1.php'.
	The target language is PHP.
<pre class="terminal">$ kwartz -l php -p file1.plogic file1.html &gt; file1.php
</pre>
</li>
</ul>
<ul type="disc">
<li>Convert presentation data into PL program.
<pre class="terminal">$ kwartz -a convert file1.html | more
</pre>
</li>
</ul>
<br>


<a name="config"></a>
<h2 class="section1">Configuration options</h2>
<p>You can sepcify Kwartz options in configuration file.
Configuration file for Kwartz is different for each implementation.
It is kwartz/config.rb in Kwartz-ruby.
</p>
<p>The following is the options for Kwartz.
</p>
<dl class="dl3">
<dt class="dt3"><strong>
ESCAPE </strong></dt>
<dd class="dd3">
	Specify auto-sanitizing on/off.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
NEWLINE </strong></dt>
<dd class="dd3">
	Specify a string which represents newline characters ("\n" or "\r\n") of output script.
	You don't have to change this option because Kwartz detects newline characters automatically.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
INDENT </strong></dt>
<dd class="dd3">
	Specify a string which represents indent of output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
LOCALVAR_PREFIX </strong></dt>
<dd class="dd3">
	Specify the prefix of template local variable name.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
GLOBALVAR_PREFIX </strong></dt>
<dd class="dd3">
	Specify the prefix of template global variable name.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
LANG </strong></dt>
<dd class="dd3">
	Specify default language for output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
ODD </strong></dt>
<dd class="dd3">
	Specify odd value of toggle variable.
	This is used by <code>id="FOREACH:<em>var</em>=<em>list</em>"</code> and <code>id="LOOP:<em>var</em>=<em>list</em>"</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
EVEN </strong></dt>
<dd class="dd3">
	Specify even value of toggle variable.
	This is used by <code>id="FOREACH:<em>var</em>=<em>list</em>"</code> and <code>id="LOOP:<em>var</em>=<em>list</em>"</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
DATTR </strong></dt>
<dd class="dd3">
	Specify an attribute name for directives. Default is '<code>kw:d</code>'.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
NOEND </strong></dt>
<dd class="dd3">
	List of tag name which doesn't require end tag. Default is [ "input", "br", "meta", "img", "hr" ].
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
DEFUN_CLASS </strong></dt>
<dd class="dd3">
	Default name of class or module when defining functions with the command-line option '-a defun'.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
DEFUN_FUNCTION </strong></dt>
<dd class="dd3">
	Default name of function or method when defining functions with the command-line option '-a defun'.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
CHARSET </strong></dt>
<dd class="dd3">
	Specify character encoding name for jstl11 and jstl10.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
EMBED_PATTERN </strong></dt>
<dd class="dd3">
	Specify a pattern to embed expression into presentation data.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><strong>
INCDIRS </strong></dt>
<dd class="dd3">
	Specify a list of directories from which '<code>include</code>' directive includes.
	Default is [ "." ].
</dd>
</dl>
<br>



   </div>
  </blockquote>

 </body>
</html>
