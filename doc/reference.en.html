<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html">
  <title>Kwartz Reference Manual</title>
  <meta name="author" content="Makoto Kuwata &lt;kwa(at)kuwata-lab.com&gt;">
  <meta name="generator" content="kwaser">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <link rel="stylesheet" href="docstyle.css" type="text/css">
 </head>
 <body>

  <blockquote>
   <div class="mainbody">

    <div align="left"><h1>Kwartz Reference Manual</h1></div>
    <div align="left">
      Makoto Kuwata &lt;kwa(at)kuwata-lab.com&gt;<br>
      last update: $Date$<br>
    </div>

<a name="preface"></a>
<h2 class="section1">Preface</h2>
<p>This document is the Kwartz Reference Manual.
Presentation language (PL), directives, command-line options, and configuration option are described
in this document.
</p>
<a name="toc"></a>
<h3 class="section2">Table of Contents</h3>
<ul>
  <li><a href="#preface">Preface</a>
  <ul>
    <li><a href="#toc">Table of Contents</a>
    </li>
  </ul>
  </li>
  <li><a href="#pl">PL - Presentation Language</a>
  <ul>
    <li><a href="#pl-comment">Comments</a>
    </li>
    <li><a href="#pl-string">Strings</a>
    </li>
    <li><a href="#pl-boolean">Booleans and Null</a>
    </li>
    <li><a href="#pl-variable">Variables</a>
    </li>
    <li><a href="#pl-op">Operators</a>
    </li>
    <li><a href="#pl-print">Printing</a>
    </li>
    <li><a href="#pl-assign">Assignment</a>
    </li>
    <li><a href="#pl-array">Arrays and Hashes</a>
    </li>
    <li><a href="#pl-property">Properties &amp; Methods</a>
    </li>
    <li><a href="#pl-foreach">Iteration</a>
    </li>
    <li><a href="#pl-if">Conditional Branching</a>
    </li>
    <li><a href="#pl-func">Functions</a>
    </li>
    <li><a href="#pl-empty">Empty</a>
    </li>
    <li><a href="#pl-decl">Element declaration</a>
    </li>
    <li><a href="#pl-doc">Document declaration</a>
    </li>
    <li><a href="#pl-rawcode">Raw-code</a>
    </li>
    <li><a href="#pl-scope">Global and Local Variables</a>
    </li>
    <li><a href="#pl-infuture">Features Under Consideration</a>
    </li>
  </ul>
  </li>
  <li><a href="#kd">Directives</a>
  <ul>
    <li><a href="#kd-whatis">What is a Directive?</a>
    </li>
    <li><a href="#kd-mark">Marking</a>
    </li>
    <li><a href="#kd-output">Printing Values of Expressions</a>
    </li>
    <li><a href="#kd-value">Printing value of expression 2</a>
    </li>
    <li><a href="#kd-attr">Attribute Values</a>
    </li>
    <li><a href="#kd-apend">Appending Attribute Expression</a>
    </li>
    <li><a href="#kd-set">Assignment</a>
    </li>
    <li><a href="#kd-if">Conditional Branching</a>
    </li>
    <li><a href="#kd-foreach">Iteration (foreach)</a>
    </li>
    <li><a href="#kd-loop">Iteration(loop)</a>
    </li>
    <li><a href="#kd-foreach2">Iteration with Count</a>
    </li>
    <li><a href="#kd-foreach3">Iteration with a Toggle Switch</a>
    </li>
    <li><a href="#kd-while">Iteration (while)</a>
    </li>
    <li><a href="#kd-dummy">Dummy data</a>
    </li>
    <li><a href="#kd-replace">Replacement of Elements</a>
    </li>
    <li><a href="#kd-placeholder">Placeholder</a>
    </li>
    <li><a href="#kd-include">Including Presentation Data Files</a>
    </li>
    <li><a href="#kd-idkd">id and kw:d Attributes</a>
    </li>
    <li><a href="#kd-notes">Notes</a>
    </li>
  </ul>
  </li>
  <li><a href="#plogic">Presentation Logic File Format</a>
  </li>
  <li><a href="#opt">Command-line options</a>
  </li>
  <li><a href="#config">Configuration options</a>
  </li>
</ul>
<br>


<br>


<a name="pl"></a>
<h2 class="section1">PL - Presentation Language</h2>
<p>PL is a language which is used to describe presentation logic in Kwartz.
This section shows how to write in PL.
</p>
<a name="pl-comment"></a>
<h3 class="section2">Comments</h3>
<p>Characters following '<code>//</code>' in a line is a comment.
</p>
<pre class="program">// comment
</pre>
<br>


<a name="pl-string"></a>
<h3 class="section2">Strings</h3>
<p><code>"..."</code> or <code>'...'</code> represents a string literal.
The former can contain special characters: line feed (\n), carriage return (\r) and tab (\t).
</p>
<pre class="program">'foo bar'         // String
"foo bar\n"       // String which contains a line feed character
</pre>
<br>


<a name="pl-boolean"></a>
<h3 class="section2">Booleans and Null</h3>
<p>The keywords <code>true</code>, <code>false</code>, <code>null</code> are available in expressions.
</p>
<pre class="program">flag = obj == null ? true : false;
</pre>
<p><code>true</code>, <code>false</code> and <code>null</code> are translated to the proper keywords in each language.
</p>
<div align="center">
<table class="table1" border="1" cellspacing="0" summary="	Translation of <code>true</code>, <code>false</code> and <code>null</code>
">
 <caption class="caption1">
	Translation of <code>true</code>, <code>false</code> and <code>null</code>
 </caption>
 <tr class="tr1">
  <th class="th1">Language name</th>
  <th class="th1">true</th>
  <th class="th1">false</th>
  <th class="th1">null</th>
 </tr>
 <tr class="tr1">
  <td class="td1">PHP</td>
  <td class="td1">TRUE</td>
  <td class="td1">FALSE</td>
  <td class="td1">NULL</td>
 </tr>
 <tr class="tr1">
  <td class="td1">eRuby</td>
  <td class="td1">true</td>
  <td class="td1">false</td>
  <td class="td1">nil</td>
 </tr>
 <tr class="tr1">
  <td class="td1">JSP(JSTL)</td>
  <td class="td1">true</td>
  <td class="td1">false</td>
  <td class="td1">null</td>
 </tr>
 <tr class="tr1">
  <td class="td1">Velocity</td>
  <td class="td1">true</td>
  <td class="td1">false</td>
  <td class="td1">-</td>
 </tr>
</table>
</div>
<p>Translating a PL program which contains the keyword <code>null</code> into a Velocity script will cause an error
because Velocity doesn't have a keyword which is equivalent to <code>null</code>.
However, Kwartz will translate '<code>expr==null</code>' and '<code>expr!=null</code>' to '<code>!expr</code>' and '<code>expr</code>'
when translating to Velocity.
</p>
<p>PL Program:
</p>
<a name="pl-boolean.plogic"></a>
<pre class="program">flag = obj == null? true : false;

if (expr != null) {
  print("expr is not null.\n");
} else {
  print("epxr is null.\n");
}
</pre>
<p>Output Script:
</p>
<pre class="output">#if($obj)
  #set($flag = true)
#else
  #set($flag = false)
#end
#if(! $expr)
expr is not null.
#else
epxr is null.
#end
### for eRuby
flag = obj == null? true : false;

if (expr != null) {
  print("expr is not null.\n");
} else {
  print("epxr is null.\n");
}

### for PHP
flag = obj == null? true : false;

if (expr != null) {
  print("expr is not null.\n");
} else {
  print("epxr is null.\n");
}

### for JSTL
flag = obj == null? true : false;

if (expr != null) {
  print("expr is not null.\n");
} else {
  print("epxr is null.\n");
}

### for Velocity
flag = obj == null? true : false;

if (expr != null) {
  print("expr is not null.\n");
} else {
  print("epxr is null.\n");
}
</pre>
<br>


<a name="pl-variable"></a>
<h3 class="section2">Variables</h3>
<p>A varaible starts with alphabetic character or '<code>_</code>' and is followed by alphanumerics or '<code>_</code>'.
</p>
<p>You need not declare variables nor specify its type<sup>(<a href="#fnref:1" name="fnlink:1">*1</a>)</sup>.
</p>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:1" href="#fnlink:1">*1</a>)</dt>
  <dd>Because of this feature, it is very difficult to translate PL program into "static languages" such as Java.</dd>
 </dl>
</div>
<br>


<a name="pl-op"></a>
<h3 class="section2">Operators</h3>
<p>There are several operators in Kwartz. Comparison operators are available for numbers and strings<sup>(<a href="#fnref:2" name="fnlink:2">*2</a>)</sup>.
</p>
<div align="center">
<table class="table1" border="1" cellspacing="0" summary="	Operators
">
 <caption class="caption1">
	Operators
 </caption>
 <tr class="tr1">
  <td class="td1">Comparison operators</td>
  <td class="td1"><code>==  != &lt; &lt;= &gt; &gt;=</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">Logical operators</td>
  <td class="td1"><code>&amp;&amp; || !</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">Arithmetic operators</td>
  <td class="td1"><code>+ - * / %</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">String Concatenation operators</td>
  <td class="td1"><code> .+ </code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">Conditional operators</td>
  <td class="td1"><code>?:</code></td>
 </tr>
</table>
</div>
<p>String concatenation operator ('<code>.+</code>') is converted into '<code>+</code>' in eRuby, '<code>.</code>' in PHP,
a function '<code>fn:join()</code>' in JSTL1.1.
There is no concatenation operator in JSTL1.0, so Kwartz converts it into a little tricky code.
Concatenation operator will be error in Velocity.
</p>
<p>PL Program (PL):
</p>
<a name="pl-concatop.plogic"></a>
<pre class="program">filename = basename .+ '.plogic';
</pre>
<p>Output Script:
</p>
<pre class="output"></pre>
<p>Conditional Operator is available in eRuby, PHP, and JSTL1.1.
However, it is not available in JSTL1.0 and Velocity.
Therefore, conditional operators will be translated to corresponding if statements in JSTL1.0 and velocity.
</p>
<p>PL Program:
</p>
<a name="pl-condop.plogic"></a>
<pre class="program">color = ctr % 2 == 0 ? '#FFCCCC' : '#CCCCFF';
</pre>
<p>Output Script:
</p>
<pre class="output"></pre>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:2" href="#fnlink:2">*2</a>)</dt>
  <dd>It is very difficult to translate PL program into Perl program, because Perl have different operators for numbers and strings ('==' vs 'eq', '!=' vs 'ne', ...).</dd>
 </dl>
</div>
<br>


<a name="pl-print"></a>
<h3 class="section2">Printing</h3>
<p><code>print(<i>...</i>)</code> is print statement.
Any expression can be in arguments.
</p>
<p>PL Program:
</p>
<a name="pl-print.plogic"></a>
<pre class="program">print('foo', bar, "baz\n");    // print a string and the value of a variable
</pre>
<p>Output Script:
</p>
<pre class="output">foo&lt;%= bar %&gt;baz
### for eRuby
print('foo', bar, "baz\n");    // print a string and the value of a variable

### for PHP
print('foo', bar, "baz\n");    // print a string and the value of a variable

### for JSTL
print('foo', bar, "baz\n");    // print a string and the value of a variable

### for Velocity
print('foo', bar, "baz\n");    // print a string and the value of a variable
</pre>
<p>When you enable auto-sanitizing, the output scripts will be one of the following:
</p>
<pre class="output">foo&lt;%= CGI::escapeHTML((bar).to_s) %&gt;baz
### for eRuby
print('foo', bar, "baz\n");    // print a string and the value of a variable

### for PHP
print('foo', bar, "baz\n");    // print a string and the value of a variable

### for JSTL
print('foo', bar, "baz\n");    // print a string and the value of a variable

### for Velocity
print('foo', bar, "baz\n");    // print a string and the value of a variable
</pre>
<p>If conditional operator returns constant string or number, sanitizing will be off even when using auto-sanitizing.
</p>
<p>PL Program:
</p>
<a name="pl-print2.plogic"></a>
<pre class="program">// Sanitized.
print("&lt;option ", condition ? var1 : var2, "&gt;\n");
// Not sanitized.
print("&lt;option ", condition ? 'selected' : '', "&gt;\n");
</pre>
<p>Output Script:
</p>
<pre class="output"></pre>
<p>'<code>print(a .+ b .+ c);</code>' will be expanded such as '<code>print(a); print(b); print(c);</code>'.
This is for some languages which doesn't support string concatenation operator (<code>.+</code>).
</p>
<br>


<a name="pl-assign"></a>
<h3 class="section2">Assignment</h3>
<p>Assignment statement is such as <code>var = 100;</code>.
Also '<code>+=</code>', '<code>-=</code>', '<code>*=</code>', '<code>/=</code>', '<code>%=</code>' and '<code>+=</code>' are allowed.
</p>
<p>PL Program:
</p>
<a name="pl-set.plogic"></a>
<pre class="program">name = 'Foo';		// assign a string
count += 1;		// increment the value of the variable
str .+= '.txt';		// append a string
</pre>
<p>Output Script:
</p>
<pre class="output"></pre>
<br>


<a name="pl-array"></a>
<h3 class="section2">Arrays and Hashes</h3>
<p>You can reference an array element as <code>arr[expr]</code>.
You can reference a hash element in the same way.<sup>(<a href="#fnref:3" name="fnlink:3">*3</a>)</sup>.
</p>
<p>In JSTL, assignment into an array element or a hash element is not available.
</p>
<p>PL Program:
</p>
<a name="pl-array.plogic"></a>
<pre class="program">list[n] = 10;           // assign into n-th element of the array
print(list[i], "\n");   // print  i-th element of the array
hash['key'] = 'foo';    // assign into a hash element
print(hash['key'], "\n"); // print a hash element
</pre>
<p>Output Script:
</p>
<pre class="output"></pre>
<p>You can reference a hash by '<code>hash[:key]</code>'.
'<code>key</code>' must be a string which contains only alphpanumerics and '<code>_</code>'.
</p>
<p>'<code>hash[:key]</code>' will be translated according to target programming language:
</p>
<div align="center">
<table class="table1" border="1" cellspacing="0" summary="	Translation of '<code>hash[:key]</code>'
">
 <caption class="caption1">
	Translation of '<code>hash[:key]</code>'
 </caption>
 <tr class="tr1">
  <th class="th1">Target language</th>
  <th class="th1">Result of translation</th>
 </tr>
 <tr class="tr1">
  <td class="td1">eRuby</td>
  <td class="td1"><code>hash[:key]</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">PHP</td>
  <td class="td1"><code>$hash['key']</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">JSTL</td>
  <td class="td1"><code>hash['key']</code></td>
 </tr>
 <tr class="tr1">
  <td class="td1">Velocity</td>
  <td class="td1"><code>hash.key</code></td>
 </tr>
</table>
</div>
<p>PL Program:
</p>
<a name="pl-hash.plogic"></a>
<pre class="program">print(hash[:key]);
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;%= hash[:key] %&gt;### for eRuby
print(hash[:key]);

### for PHP
print(hash[:key]);

### for JSTL
print(hash[:key]);

### for Velocity
print(hash[:key]);
</pre>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:3" href="#fnlink:3">*3</a>)</dt>
  <dd>Operators for arrays and hashes are the same, therefore it is difficult to support a language, say Perl, which use different operators for arrays and hashes.</dd>
 </dl>
</div>
<br>


<a name="pl-property"></a>
<h3 class="section2">Properties &amp; Methods</h3>
<p>You can reference a property of an object as '<code><i>object</i>.<i>property</i></code>'.
You can also call a method with arguments such as '<code><i>object</i>.<i>method</i>(<i>arg1</i>, <i>arg2</i>, ..)</code>'.
Translation of method call into JSTL will raise an error because JSTL's Expression Language doesn't support method call.
</p>
<p>PL Program:
</p>
<a name="pl-property.plogic"></a>
<pre class="program">// property
user.name = 'Foo';
print(user.name, "\n");
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;% user.name = "Foo" %&gt;
&lt;%= user.name %&gt;
### for eRuby
// property
user.name = 'Foo';
print(user.name, "\n");

### for PHP
// property
user.name = 'Foo';
print(user.name, "\n");

### for JSTL
// property
user.name = 'Foo';
print(user.name, "\n");

### for Velocity
// property
user.name = 'Foo';
print(user.name, "\n");
</pre>
<p>PL Program:
</p>
<a name="pl-method.plogic"></a>
<pre class="program">// method call
print(user.method(10, 20));
</pre>
<p>Output Script:
</p>
<pre class="output"></pre>
<p>There is no way to create a new object or define a new class in PL.
These tasks must be done in the main program.
</p>
<br>


<a name="pl-foreach"></a>
<h3 class="section2">Iteration</h3>
<p><code>foreach(<i>loopvar</i> in <i>list</i>) { ... }</code> represents a foreach iteration.
Items in the <code><i>list</i></code> is assigned into the variable <code><i>loopvar</i></code> each time through the iteration.
</p>
<p>PL Program:
</p>
<a name="pl-foreach.plogic"></a>
<pre class="program">foreach(item in list) {
  print(item, "\n");
}
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;% for item in list do %&gt;
&lt;%= item %&gt;
&lt;% end %&gt;
### for eRuby
foreach(item in list) {
  print(item, "\n");
}

### for PHP
foreach(item in list) {
  print(item, "\n");
}

### for JSTL
foreach(item in list) {
  print(item, "\n");
}

### for Velocity
foreach(item in list) {
  print(item, "\n");
}
</pre>
<p>You can also use a while statment.
Kwartz will raise an error if you try to translate a while statement into a JSTL or Velocity script,
because there is no JSTL tag or Velocity directive which is equivalent to the while statment.
</p>
<p>PL Program:
</p>
<a name="pl-while.plogic"></a>
<pre class="program">i = 0;
while(i &lt; length) {
  i += 1;
  print(list[i]);
}
</pre>
<p>Output Script:
</p>
<pre class="output"></pre>
<p>for-statements (like in C or Java) are not available.
</p>
<br>


<a name="pl-if"></a>
<h3 class="section2">Conditional Branching</h3>
<p>'<code>if(<i>condition</i>) { ... } else if(<i>condition</i>) { ... } else { ... }</code>' represents a  conditional branch.
</p>
<p>PL Program:
</p>
<a name="pl-if.plogic"></a>
<pre class="program">if (val &gt; 0) {
  print ("* value is positive.\n");
} else if (val &lt; 0) {
  print ("* value is negative.\n");
} else {
  print ("* value is zero.\n");
}
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;% if val &gt; 0 then %&gt;
* value is positive.
&lt;% elsif val &lt; 0 then %&gt;
* value is negative.
&lt;% else %&gt;
* value is zero.
&lt;% end %&gt;
### for eRuby
if (val &gt; 0) {
  print ("* value is positive.\n");
} else if (val &lt; 0) {
  print ("* value is negative.\n");
} else {
  print ("* value is zero.\n");
}

### for PHP
if (val &gt; 0) {
  print ("* value is positive.\n");
} else if (val &lt; 0) {
  print ("* value is negative.\n");
} else {
  print ("* value is zero.\n");
}

### for JSTL
if (val &gt; 0) {
  print ("* value is positive.\n");
} else if (val &lt; 0) {
  print ("* value is negative.\n");
} else {
  print ("* value is zero.\n");
}

### for Velocity
if (val &gt; 0) {
  print ("* value is positive.\n");
} else if (val &lt; 0) {
  print ("* value is negative.\n");
} else {
  print ("* value is zero.\n");
}
</pre>
<br>


<a name="pl-func"></a>
<h3 class="section2">Functions</h3>
<p>The following functions are available in PL.
</p>
<dl class="dl3">
<dt class="dt3"><b>
E(<i>expr</i>) </b></dt>
<dd class="dd3">
	Sanitizes(escapes) the expression <i>expr</i>. Using this function sanitizes
	even when the command-line option for sanitizing is not specified.
	E() is pseudo-function and allowed to appear only as argument of print statement.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
X(<i>expr</i>) </b></dt>
<dd class="dd3">
	Don't sanitize expression <i>expr</i>, even when the command-line option for
	sanitizing is specified.
	X() is pseudo-function and allowed to appear only as argument of print statement.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
C(<i>expression</i>) </b></dt>
<dd class="dd3">
	Equivarent to <code><i>expression</i> ? ' checked="checked"' : ''</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
S(<i>expression</i>) </b></dt>
<dd class="dd3">
	Equivarent to <code><i>expression</i> ? ' selected="selected"' : ''</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
D(<i>expression</i>) </b></dt>
<dd class="dd3">
	Equivarent to <code><i>expression</i> ? ' disabled="disabled"' : ''</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
list_new() </b></dt>
<dd class="dd3">
	  Create a new list. 
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
list_length(<i>list</i>) </b></dt>
<dd class="dd3">
	  Return the length of the <i>list</i>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
hash_new() </b></dt>
<dd class="dd3">
	  Create a new hash. 
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
hash_keys(<i>hash</i>) </b></dt>
<dd class="dd3">
	  Return a list which contains all keys of the <i>hash</i>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
str_length(<i>string</i>) </b></dt>
<dd class="dd3">
	  Return the length of the <i>string</i>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
str_tolower(<i>string</i>) </b></dt>
<dd class="dd3">
	  Make a <i>string</i> to lowercase and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
str_toupper(<i>string</i>) </b></dt>
<dd class="dd3">
	  Make a <i>string</i> to uppercase an return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
str_trim(<i>string</i>) </b></dt>
<dd class="dd3">
	  Strip whitespace from the beginning and end of a <i>string</i> and return it.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
str_index(<i>string</i>, <i>char</i>) </b></dt>
<dd class="dd3">
	  Return the first positin a <i>char</i> occurs in a <i>string</i>.
</dd>
</dl>
<p>JSTL1.0 and Velocity don't support any function, so you cannot use these function in JSTL1.0 (except E() and X()).
JSTL1.1 supports some functions but it is limited.
In fact, list_new(), hash_new(), and hash_keys() are not supported.
</p>
<div align="center">
<table class="table1" border="1" cellspacing="0">
 <tr class="tr1">
  <th class="th1">Functions</th>
  <th class="th1">eRuby</th>
  <th class="th1">PHP</th>
  <th class="th1">JSTL1.1</th>
  <th class="th1">JSTL1.0 &amp; Velocity</th>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>list_new()</code></td>
  <td class="td1"><code>[]</code></td>
  <td class="td1"><code>array()</code></td>
  <td class="td1">-</td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>list_length(<i>list</i>)</code></td>
  <td class="td1"><code><i>list</i>.length</code></td>
  <td class="td1"><code>array_length(<i>list</i>)</code></td>
  <td class="td1"><code>fn:length(<i>list</i>)</code></td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>hash_new()</code></td>
  <td class="td1"><code>{}</code></td>
  <td class="td1"><code>array()</code></td>
  <td class="td1">-</td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>hash_keys(<i>hash</i>)</code></td>
  <td class="td1"><code><i>hash</i>.keys</code></td>
  <td class="td1"><code>array_keys(<i>hash</i>)</code></td>
  <td class="td1">-</td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_length(<i>str</i>)</code></td>
  <td class="td1"><code><i>str</i>.lenth</code></td>
  <td class="td1"><code>strlen(<i>str</i>)</code></td>
  <td class="td1"><code>fn:length(<i>str</i>)</code></td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_tolower(<i>str</i>)</code></td>
  <td class="td1"><code><i>str</i>.downcase</code></td>
  <td class="td1"><code>strtolower(<i>str</i>)</code></td>
  <td class="td1"><code>fn:toLowerCase(<i>str</i>)</code></td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_toupper(<i>str</i>)</code></td>
  <td class="td1"><code><i>str</i>.upcase</code></td>
  <td class="td1"><code>strtoupper(<i>str</i>)</code></td>
  <td class="td1"><code>fn:toUpperCase(<i>str</i>)</code></td>
  <td class="td1">-</td>
 </tr>
 <tr class="tr1">
  <td class="td1"><code>str_index(<i>str</i>,<i>ch</i>)</code></td>
  <td class="td1"><code><i>str</i>.index(<i>ch</i>)</code></td>
  <td class="td1"><code>strchr(<i>str</i>,<i>ch</i>)</code></td>
  <td class="td1"><code>fn:indexOf(<i>str</i>,<i>ch</i>)</code></td>
  <td class="td1">-</td>
 </tr>
</table>
</div>
<p>All functions except above are printed "as is" when translating into PHP or eRuby script.
Translating into JSTL script will be error because Exrepssion Language of JSTL doesn't support
user-defined functions.
</p>
<p>Functions E() and X() are intended to be used as arguments of print statement.
You shouldn't use them in other place.
</p>
<br>


<a name="pl-empty"></a>
<h3 class="section2">Empty</h3>
<p>'<code>empty</code>' is a keyword used to check whether a value is either null or an empty string.
It can be placed only at the right-side of the operators '<code>==</code>' and '<code>!=</code>'.
</p>
<p>PL Program:
</p>
<a name="pl-empty.plogic"></a>
<pre class="program">if (str1 == empty) {
  print("str1 is empty.\n");
} else if (str2 != empty) {
  print("str2 is not empty.\n");
}
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;% if !str1 || str1.empty? then %&gt;
str1 is empty.
&lt;% elsif str2 &amp;&amp; !str2.empty? then %&gt;
str2 is not empty.
&lt;% end %&gt;
### for eRuby
if (str1 == empty) {
  print("str1 is empty.\n");
} else if (str2 != empty) {
  print("str2 is not empty.\n");
}

### for PHP
if (str1 == empty) {
  print("str1 is empty.\n");
} else if (str2 != empty) {
  print("str2 is not empty.\n");
}

### for JSTL
if (str1 == empty) {
  print("str1 is empty.\n");
} else if (str2 != empty) {
  print("str2 is not empty.\n");
}

### for Velocity
if (str1 == empty) {
  print("str1 is empty.\n");
} else if (str2 != empty) {
  print("str2 is not empty.\n");
}
</pre>
<br>


<a name="pl-decl"></a>
<h3 class="section2">Element declaration</h3>
<p>Element declaration is description to manipulate elements
marked by '<code>id="<i>name</i>"</code>' or '<code>id="mark:<i>name</i>"</code>',
for example, delete attributes or change presentation logic.
In Kwartz, presentation logic file is described as a set of element declarations.
</p>
<p>Element declaration starts with '<code>#<i>name</i></code>' and is followed by some declaration parts.
</p>
<dl class="dl3">
<dt class="dt3"><b>
<code>value: <i>expression</i>;</code> </b></dt>
<dd class="dd3">
	Replace content of the element by value of <code><i>expression</i></code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>attr: "<i>attr1</i>" <i>expr1</i> , "<i>attr2</i>" <i>expr2</i> , ... ;</code> </b></dt>
<dd class="dd3">
	Replace value of attribute <code><i>attr</i></code> by value of <code><i>expr</i></code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>remove: "<i>attr1</i>" , "<i>attr2</i>" , ... ;</code> </b></dt>
<dd class="dd3">
	Remove attribute <code><i>attr</i></code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>append: <i>expr1</i> , <i>expr2</i> , ... ;</code> </b></dt>
<dd class="dd3">
	Append expression <code><i>expr</i></code> at the end of start tag.
	This is useful for appending <code>checked</code> or <code>selected</code> in &lt;input&gt; tag or &lt;option&gt; tag.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>tagname: <i>expression</i>;</code> </b></dt>
<dd class="dd3">
	Replace tag name by value of <code><i>expression</i></code>.
	This may be useful for Struts or JSF.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>plogic: { <i>...</i> }</code> </b></dt>
<dd class="dd3">
	Change the presentation logic of the element.
	<code>@stag</code>, <code>@cont</code>, and <code>@etag</code> are available in <code>{ ... }</code>.
	These represents start tag, content, end tag of the element respectively.
	And <code>@element(<i>other</i>)</code> is also available which represents other element and expand it.
</dd>
</dl>
<p>Presentation Data:
</p>
<a name="pl-decl.pdata"></a>
<pre class="program">&lt;ul&gt;
  &lt;li id="foo" class="foo"&gt;dummy&lt;/li&gt;
&lt;/ul&gt;

&lt;form action="foo.cgi"&gt;
  &lt;input type="checkbox" name="user" value="Y" checked="checked" id="mark:chkbox"/&gt;
&lt;/form&gt;
</pre>
<p>Presentation Logic:
</p>
<a name="pl-decl.plogic"></a>
<pre class="program">#foo {
  value:  item;
  attr:   "class" klass;
  plogic: {
    foreach (item in list) {
      @stag;
      @cont;
      @etag;
    }
  }
}
#chkbox {
  remove:  "checked";
  append:  flag ? " checked" : "";
  tagname: "html:text";
}
</pre>
<p>Output Script:
</p>
<pre class="output"></pre>
<br>


<a name="pl-doc"></a>
<h3 class="section2">Document declaration</h3>
<p><code>#DOCUMENT { <i>...</i> }</code> is a special element declaration for document.
It represents document information and takes the following declaration parts.
</p>
<dl class="dl3">
<dt class="dt3"><b>
<code>begin: { <i>...</i> }</code> </b></dt>
<dd class="dd3">
	Represents PL code which is added at the beginning of the output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>end: { <i>...</i> }</code> </b></dt>
<dd class="dd3">
	Represents PL code which is added at the end of the output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>require: "<i>filename1</i>" , "<i>filename2</i>", <i>...</i> ;</code> </b></dt>
<dd class="dd3">
	Load presentation logic file.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>global: <i>varname1</i> , <i>varname2</i> , <i>...</i> ;</code> </b></dt>
<dd class="dd3">
	List of global variables. Currently this part have no means but will be used in future release.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
<code>local: <i>varname1</i> , <i>varname2</i> , <i>...</i> ;</code> </b></dt>
<dd class="dd3">
	List of local variables. Currently this part have no means but will be used in future release.
</dd>
</dl>
<p>Presentation data:
</p>
<a name="pl-doc.html"></a>
<pre class="program">&lt;ul id="mark:list"&gt;
  &lt;li id="value:item"&gt;foo&lt;/li&gt;
&lt;/ul&gt;
</pre>
<p>PL Program:
</p>
<a name="pl-doc.plogic"></a>
<pre class="program">#DOCUMENT {
  begin: {
    list = context[:list];
  }
  end:   {
    print("&lt;!-- copyright(c) 2005 kuwata-lab.com ALL RIGHTS RESERVERD. --&gt;\n");
  }
  global:  context;
}

#list {
  plogic: {
    @stag;
    foreach (item in list)
      @cont;
    @etag;
  }
}
</pre>
<p>Output script:
</p>
<pre class="output">&lt;% list = context[:list] %&gt;
&lt;ul&gt;
&lt;% for item in list do %&gt;
  &lt;li&gt;&lt;%= item %&gt;&lt;/li&gt;
&lt;% end %&gt;
&lt;/ul&gt;
&lt;!-- copyright(c) 2005 kuwata-lab.com ALL RIGHTS RESERVERD. --&gt;
### for eRuby
&lt;ul&gt;
  &lt;li&gt;&lt;%= item %&gt;&lt;/li&gt;
&lt;/ul&gt;

### for PHP
&lt;ul&gt;
  &lt;li&gt;&lt;?php echo $item; ?&gt;&lt;/li&gt;
&lt;/ul&gt;

### for JSTL
&lt;ul&gt;
  &lt;li&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;/li&gt;
&lt;/ul&gt;

### for Velocity
&lt;ul&gt;
  &lt;li&gt;$!{item}&lt;/li&gt;
&lt;/ul&gt;
</pre>
<br>


<a name="pl-rawcode"></a>
<h3 class="section2">Raw-code</h3>
<p>Code in the target program language can be in the PL program.
If Kwartz find a line starting with '<code>&lt;%</code>' or '<code>&lt;?</code>',
Kwartz prints the string from '<code>&lt;%</code>' or '<code>&lt;?</code>' to the end of line directly.
</p>
<p>The following is an example which includes PHP code.
</p>
<p>PL Program:
</p>
<a name="pl-rawcode.plogic"></a>
<pre class="program">&lt;?php foreach($hash as $key =&gt; $value) { ?&gt;
print("key=", key, " value=", value, "\n");
&lt;?php } ?&gt;
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;?php foreach($hash as $key =&gt; $value) { ?&gt;
key=&lt;?php echo $key; ?&gt; value=&lt;?php echo $value; ?&gt;
&lt;?php } ?&gt;
### for eRuby
&lt;?php foreach($hash as $key =&gt; $value) { ?&gt;
print("key=", key, " value=", value, "\n");
&lt;?php } ?&gt;

### for PHP
&lt;?php foreach($hash as $key =&gt; $value) { ?&gt;
print("key=", key, " value=", value, "\n");
&lt;?php } ?&gt;

### for JSTL
&lt;?php foreach($hash as $key =&gt; $value) { ?&gt;
print("key=", key, " value=", value, "\n");
&lt;?php } ?&gt;

### for Velocity
&lt;?php foreach($hash as $key =&gt; $value) { ?&gt;
print("key=", key, " value=", value, "\n");
&lt;?php } ?&gt;
</pre>
<p>Raw-code can be in 'plogic:' part of element declaration, or 'begin:'/'end:' part of document declaration.
This means that you can write presentation logics in target language.
</p>
<p>Presentation Logic:
</p>
<pre class="program">#foo {
  plogic: {
    @stag;
    &lt;% hash.each do |key, value| %&gt;
      @cont;
    &lt;% end %&gt;
    @etag;
  }
}
</pre>
<p>Raw-cde cannot be in 'value:' or 'attr:' part of element declaration,
because raw-code is statement and not expression.
</p>
<p>You should remember that writing a raw-code takes portability away.
</p>
<br>


<a name="pl-scope"></a>
<h3 class="section2">Global and Local Variables</h3>
<p>In Kwartz, variables are called 'Template Global Variables' if they are set in the main program and are  passed to output script.
Variables are called 'Template Local Variables' if they are used only in the template.
</p>
<p>Assume the following presentation data and presentation logic:
</p>
<p>Presentation data (analyze.html) :
</p>
<a name="analyze.html"></a>
<pre class="program">&lt;table&gt;
  &lt;caption id="value:<b>title</b>"&gt;Sample&lt;/caption&gt;
  &lt;tr id="mark:items" bgcolor="@{<b>color</b>}@"&gt;
    &lt;td id="value:<b>item</b>"&gt;Foo&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</pre>
<p>Presentation logic (analyze.plogic) :
</p>
<a name="analyze.plogic"></a>
<pre class="program">#items {
  plogic: {
    <b>ctr</b> = 0;
    foreach (<b>item</b> in <b>list</b>) {
      <b>ctr</b> += 1;
      <b>color</b> = <b>ctr</b>%2 == 0 ? '#FFCCCC' : '#CCCCFF';
      @stag;
      @cont;
      @etag;
    }
  }
}
</pre>
<p>There are several variables. They are classified as follows:
</p>
<dl class="dl3">
<dt class="dt3"><b>
Template global variables </b></dt>
<dd class="dd3">
	The variables '<code>title</code>' and '<code>list</code>' need to be set in the main program and be passed to template.
	These variables are called 'Template Global Variables' in Kwartz.
</dd>
<dt class="dt3"><b>
Template local variables </b></dt>
<dd class="dd3">
	The variables '<code>item</code>', '<code>ctr</code>', and '<code>color</code>' are used only in the template.
	These variables are called 'Template Local Variables' in Kwartz.
</dd>
</dl>
<p>Invoking Kwartz with the command-line option '<code>-a analyze</code>' analyzes the template and reports template global/local variables.
</p>
<pre class="program">$ kwartz -p analyze.plogic -a analyze analyze.html
Global: <b>title</b> <b>list</b>
Local:  <b>ctr</b> <b>item</b> <b>color</b>
</pre>
<p>Kwartz detemines whether variables are global or local according to the following rule:
</p>
<ul type="disc">
<li>When Kwartz finds a new variable ...
    <ul type="circle">
    <li>If it appears in the lefthand-side of an assignment, it is to be recognized as a template local variable.
    </li>
    <li>If it appears as the loop variable of a foreach statement, it is to be recognized as a template local variable.
    </li>
    <li>Otherwize, it is to be recognized as a template global variable.
    </li>
    </ul>
</li>
</ul>
<p>Kwartz reports warnings if template global variables appear in the lefthand-side of assignments or are used as loop variables in foreach statements.
Because the role of template system is to display template global variables, templates should not change or modify template global variables.
</p>
<p>Analyzing templates and reporting global/local variables is very useful, especially when the presentation data/logic is large and complex.
It also helps you to find typos of variable names.
</p>
<br>


<a name="pl-infuture"></a>
<h3 class="section2">Features Under Consideration</h3>
<p>The following features are not implemented.
They may be implemented in the future release (or not).
</p>
<ul type="disc">
<li>break, continue
</li>
<li>user-defined functions/procedures
</li>
<li>creating arrays and hashes in JSTL
</li>
</ul>
<br>


<br>


<a name="kd"></a>
<h2 class="section1">Directives</h2>
<a name="kd-whatis"></a>
<h3 class="section2">What is a Directive?</h3>
<p>Kwartz allows presentation logic to be embedded in presentation data.
Commands for that purpose are called 'directives'.
</p>
<p>'Directives' is a set of commands to embed presentation logic into presentation data.
Kwartz uses the id attribute and the kw:d attribute to embed directives in presentation data.
Kw:d is an original attribute of Kwartz, but the ability of id and kw:d attributes are equivalent for Kwartz.
Marking (<code>id="<i>name</i>"</code> or <code>id="mark:<i>name</i>"</code>) is also a directive.
</p>
<p>You may have a question: 
If it is the most important feature for Kwartz that separates presentation logic from presentation data,
why does Kwartz allow me to embed presentation logic into presentation data? 
</p>
<p>The answer is <b>choosability</b> - to make it possible for developers to choose either approach.
In other words, to increase options of development styles.
Kwartz doesn't force you to use one approach.
Separate presentation logic and presentation data if you like to separate them, or mix them if you like.
</p>
<p>You may wonder whether Kwartz becomes an ordinary template system if presentation logic is embedded into presentation data.
But Kwartz has the following merits compared to other template systems;
</p>
<ul type="disc">
<li>Kwartz doesn't break HTML design. Compare to <a href="http://jakarta.apache.org/velocity/">Jakarta Velocity</a> or <a href="http://www.template-toolkit.org/">Template-Toolkit</a>.
</li>
<li>Kwartz doesn't need complex programming. Compare to <a href="http://xmlc.objectweb.org/">Enhydra XMLC</a>, which needs complex DOM programming.
</li>
<li>Kwartz works very quickly and is light-weight. Compared to <a href="http://amrita.sourceforge.jp/">amrita</a>.
</li>
<li>Kwartz can handle any type of text. Compare to <a href="http://xmlc.objectweb.org/">Enhydra XMLC</a> or <a href="http://amrita.sourceforge.jp/">amrita</a>.
</li>
<li>Kwartz can be used in several languages. There is no other template system like this!
</li>
</ul>
<br>


<a name="kd-mark"></a>
<h3 class="section2">Marking</h3>
<p>The directive '<code>id="<i>name</i>"</code>' or '<code>id="mark:<i>name</i>"</code>' marks an element
 with a name <code><i>name</i></code>.  This is called 'marking'.
</p>
<p>The difference between '<code>id="<i>name</i>"</code>' and '<code>id="mark:<i>name</i>"</code>' is
 that the former is left in but the latter is removed when compiling.
kw:d attributes are always removed.
</p>
<p>Presentation Data:
</p>
<a name="directive-mark.pdata"></a>
<pre class="program">&lt;div <b>id="foo"</b>&gt;foo&lt;/div&gt;
&lt;div <b>id="mark:bar"</b>&gt;bar&lt;/div&gt;
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;
### for eRuby
&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;

### for PHP
&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;

### for JSTL
&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;

### for Velocity
&lt;div id="foo"&gt;foo&lt;/div&gt;
&lt;div&gt;bar&lt;/div&gt;
</pre>
<br>


<a name="kd-output"></a>
<h3 class="section2">Printing Values of Expressions</h3>
<p>'<code>@{<i>expression</i>}@</code>' is a directive which prints the value of an expression.
This pattern is changeable with a constant EMBED_PATTERN in configuration file (kwartz/config.rb).
</p>
<p>Presentation Data:
</p>
<a name="directive-output.html"></a>
<pre class="program">Hello <b>@{user.name}@</b>!
</pre>
<p>Output Program:
</p>
<pre class="output">Hello &lt;%= user.name %&gt;!
### for eRuby
Hello &lt;%= user.name %&gt;!

### for PHP
Hello &lt;?php echo $user-&gt;name; ?&gt;!

### for JSTL
Hello &lt;c:out value="${user.name}" escapeXml="false"/&gt;!

### for Velocity
Hello $!{user.name}!
</pre>
<p>Expressions are sanitized if you specified the command-line option '<code>-e</code>' when compiling templates.
Notice that all expressions except string and numbers constants are sanitized.
</p>
<p>Output Program (with command-line option <code>-e</code>) :
</p>
<pre class="output">Hello &lt;%= CGI::escapeHTML((user.name).to_s) %&gt;!
### for eRuby
Hello &lt;%= user.name %&gt;!

### for PHP
Hello &lt;?php echo $user-&gt;name; ?&gt;!

### for JSTL
Hello &lt;c:out value="${user.name}" escapeXml="false"/&gt;!

### for Velocity
Hello $!{user.name}!
</pre>
<p>Using the functions <code>E()</code> or <code>X()</code>, you can toggle sanitizing on/off for each expression.
<code>E(<i>expr</i>)</code> means that the expression <code><i>expr</i></code> is sanitized
and <code>X(<i>expr</i>)</code> means that <code><i>expr</i></code> is not sanitized.
These are not effected by the command-line option '<code>-e</code>'.
</p>
<p>Presentation Data:
</p>
<a name="directive-output2.html"></a>
<pre class="program">With sanitizing:    <b>@{E(var)}@</b>!
Without sanitizing: <b>@{X(var)}@</b>!
</pre>
<p>Output Program:
</p>
<pre class="output">With sanitizing:    &lt;%= CGI::escapeHTML((var).to_s) %&gt;!
Without sanitizing: &lt;%= var %&gt;!
### for eRuby
With sanitizing:    &lt;%= CGI::escapeHTML((var).to_s) %&gt;!
Without sanitizing: &lt;%= var %&gt;!

### for PHP
With sanitizing:    &lt;?php echo htmlspecialchars($var); ?&gt;!
Without sanitizing: &lt;?php echo $var; ?&gt;!

### for JSTL
With sanitizing:    &lt;c:out value="${var}"/&gt;!
Without sanitizing: &lt;c:out value="${var}" escapeXml="false"/&gt;!

### for Velocity
With sanitizing:    $!esc.html($var)!
Without sanitizing: $!{var}!
</pre>
<p>.
.
</p>
<br>


<a name="kd-value"></a>
<h3 class="section2">Printing value of expression 2</h3>
<p>'<code>id="value:<i>expression</i>"</code>' is a directive to print the value of expression instead of the content.
It is more suitable for HTML design than '<code>@{<i>expression</i>}@</code>' because it allows for the use of dummy data.
</p>
<p>Presentation Data:
</p>
<a name="directive-value.html"></a>
<pre class="program">&lt;li <b>id="value:hash['name']"</b>&gt;foo&lt;/li&gt;
</pre>
<p>Output Program:
</p>
<pre class="output">&lt;li&gt;&lt;%= hash["name"] %&gt;&lt;/li&gt;
### for eRuby
&lt;li&gt;&lt;%= hash["name"] %&gt;&lt;/li&gt;

### for PHP
&lt;li&gt;&lt;?php echo $hash["name"]; ?&gt;&lt;/li&gt;

### for JSTL
&lt;li&gt;&lt;c:out value="${hash['name']}" escapeXml="false"/&gt;&lt;/li&gt;

### for Velocity
&lt;li&gt;$!{hash["name"]}&lt;/li&gt;
</pre>
<p>'<code>id="Value:<i>expr</i>"</code>' sanitizes the expression.
'<code>id="VALUE:<i>expr</i>"</code>' un-sanitizes the expression.
These are equal to '<code>id="value:E(<i>expr</i>)"</code>' and '<code>id="value:X(<i>expr</i>)"</code>'.
</p>
<br>


<a name="kd-attr"></a>
<h3 class="section2">Attribute Values</h3>
<p>'<code>id="attr:<i>name</i>=<i>value</i>"</code>' (or '<code>id="attr:<i>name</i>:<i>value</i>"</code>') is a directive to set an attribute value.
It overwrites the existing value if attribute <code><i>name</i></code> is already set.
</p>
<p>In the following example, attribute 'class' has the dummy value '<code>odd</code>', and the actual value is derived from the variable '<code>klass</code>'.
</p>
<p>Presentation Data:
</p>
<a name="directive-attr.pdata"></a>
<pre class="program">&lt;tr class="odd" <b>id="attr:class=klass"</b>&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>Output Program:
</p>
<pre class="output">&lt;tr class="&lt;%= klass %&gt;"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;
### for eRuby
&lt;tr class="&lt;%= klass %&gt;"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;

### for PHP
&lt;tr class="&lt;?php echo $klass; ?&gt;"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;

### for JSTL
&lt;tr class="&lt;c:out value="${klass}" escapeXml="false"/&gt;"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;

### for Velocity
&lt;tr class="$!{klass}"&gt;
  &lt;td&gt;foo&lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>'<code>id="Attr:<i>name</i>=<i>value</i>"</code>' sanitizes the value.
'<code>id="ATTR:<i>name</i>=<i>value</i>"</code>' un-sanitizes the value.
These are equal to '<code>id="attr:<i>name</i>=E(<i>value</i>)"</code>' and '<code>id="attr:<i>name</i>=X(<i>value</i>)"</code>'.
</p>
<p>Separating with '<code>;</code>', you can have several '<code>attr:<i>name</i>=<i>value</i></code>' directives in one id attribute.
You can enumerate other attributes this way as well.
</p>
<p>Presentation Data:
</p>
<a name="directive-attr2.pdata"></a>
<pre class="program">&lt;font id="if:message!=empty<b>;attr:class=klass;attr:bgcolor=color</b>"&gt;
 @{message}@
&lt;/font&gt;
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;% if message &amp;&amp; !message.empty? then %&gt;
&lt;font class="&lt;%= klass %&gt;" bgcolor="&lt;%= color %&gt;"&gt;
 &lt;%= message %&gt;
&lt;/font&gt;
&lt;% end %&gt;
### for eRuby
&lt;% if message &amp;&amp; !message.empty? then %&gt;
&lt;font class="&lt;%= klass %&gt;" bgcolor="&lt;%= color %&gt;"&gt;
 &lt;%= message %&gt;
&lt;/font&gt;
&lt;% end %&gt;

### for PHP
&lt;?php if ($message) { ?&gt;
&lt;font class="&lt;?php echo $klass; ?&gt;" bgcolor="&lt;?php echo $color; ?&gt;"&gt;
 &lt;?php echo $message; ?&gt;
&lt;/font&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:if test="${not empty message}"&gt;
&lt;font class="&lt;c:out value="${klass}" escapeXml="false"/&gt;" bgcolor="&lt;c:out value="${color}" escapeXml="false"/&gt;"&gt;
 &lt;c:out value="${message}" escapeXml="false"/&gt;
&lt;/font&gt;
&lt;/c:if&gt;

### for Velocity
#if($message &amp;&amp; $message != "")
&lt;font class="$!{klass}" bgcolor="$!{color}"&gt;
 $!{message}
&lt;/font&gt;
#end
</pre>
<br>


<a name="kd-apend"></a>
<h3 class="section2">Appending Attribute Expression</h3>
<p>'<code>id="append:<i>expression</i>"</code>' is a directive to append expression into a tag.
This is useful to output '&lt;input ... checked /&gt;' or '&lt;option ... selected&gt;&lt;/option&gt;'.
</p>
<p>Presentation Data:
</p>
<a name="directive-append.pdata"></a>
<pre class="program">&lt;option name="lang" value="ruby"
       <b>id="append:lang=='ruby'?' selected':''"</b>&gt;Ruby&lt;/option&gt;
&lt;input type="radio" name="gender" value="M"
       <b>id="append:gender=='M'?' checked':''"</b>&gt;
</pre>
<p>Output Script:
</p>
<pre class="program"></pre>
<p>A function to output <code>'checked="checked"'</code>, <code>'selected="selected"'</code> and <code>'disabled="disabled"'</code> easily for HTML/XHTML is available in Kwartz.
<code>C(<i>expr</i>)</code>, <code>S(<i>expr</i>)</code>, and <code>D(<i>expr</i>)</code> print <code>' checked="checked"'</code>, <code>' selected="selected"'</code> and <code>' disabled="disabled"'</code> respectively when expression <code><i>expr</i></code> is true.
</p>
<p>Presentation Data:
</p>
<a name="directive-append2.pdata"></a>
<pre class="program">&lt;option name="lang" value="ruby"
       id="append:<b>S(lang=='ruby')</b>"&gt;Ruby&lt;/option&gt;

&lt;input type="radio" name="gender" value="M"
       id="append:<b>C(gender=='M')</b>" /&gt;Male

&lt;input type="radio" name="os" value="win"
       id="append:<b>D(os=='mac')</b>" /&gt;Windows
</pre>
<p>Output Script:
</p>
<pre class="program"></pre>
<br>


<a name="kd-set"></a>
<h3 class="section2">Assignment</h3>
<p>'<code>id="set:<i>var</i>=<i>value</i>"</code>' is a directive for assigning values into variables.
Other than '<code>=</code>', '<code>+=</code>', '<code>-=</code>', '<code>*=</code>', '<code>/=</code>', '<code>.=</code>' are also available.
</p>
<p>Presentation Data:
</p>
<a name="directive-set.pdata"></a>
<pre class="program">&lt;dt <b>id="set:var=value"</b>&gt;foo&lt;/dt&gt;
&lt;dd <b>id="set:count+=1"</b>&gt;123&lt;/dd&gt;
</pre>
<p>Output Program:
</p>
<pre class="output">&lt;% var = value %&gt;
&lt;dt&gt;foo&lt;/dt&gt;
&lt;% count += 1 %&gt;
&lt;dd&gt;123&lt;/dd&gt;
### for eRuby
&lt;% var = value %&gt;
&lt;dt&gt;foo&lt;/dt&gt;
&lt;% count += 1 %&gt;
&lt;dd&gt;123&lt;/dd&gt;

### for PHP
&lt;?php $var = $value; ?&gt;
&lt;dt&gt;foo&lt;/dt&gt;
&lt;?php $count += 1; ?&gt;
&lt;dd&gt;123&lt;/dd&gt;

### for JSTL
&lt;c:set var="var" value="${value}"/&gt;
&lt;dt&gt;foo&lt;/dt&gt;
&lt;c:set var="count" value="${count + 1}"/&gt;
&lt;dd&gt;123&lt;/dd&gt;

### for Velocity
#set($var = $value)
&lt;dt&gt;foo&lt;/dt&gt;
#set($count = $count + 1)
&lt;dd&gt;123&lt;/dd&gt;
</pre>
<br>


<a name="kd-if"></a>
<h3 class="section2">Conditional Branching</h3>
<p>'<code>id="if:<i>expression</i>"</code>' is a directive for conditional branching.
'<code>else</code>' and '<code>elseif</code>' are also available.
</p>
<p>Presentation Data:
</p>
<a name="directive-if.pdata"></a>
<pre class="program">&lt;div <b>id="if:value &gt; 0"</b>&gt;
  Value is positive.
&lt;/div&gt;
&lt;div <b>id="elseif:value &lt; 0"</b>&gt;
  Value is negative.
&lt;/div&gt;
&lt;div <b>id="else:"</b>&gt;
  Value is zero.
&lt;/div&gt;
</pre>
<p>Output Program:
</p>
<pre class="output">&lt;% if value &gt; 0 then %&gt;
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
&lt;% elsif value &lt; 0 then %&gt;
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
&lt;% else %&gt;
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
&lt;% end %&gt;
### for eRuby
&lt;% if value &gt; 0 then %&gt;
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
&lt;% elsif value &lt; 0 then %&gt;
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
&lt;% else %&gt;
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
&lt;% end %&gt;

### for PHP
&lt;?php if ($value &gt; 0) { ?&gt;
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
&lt;?php } elseif ($value &lt; 0) { ?&gt;
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
&lt;?php } else { ?&gt;
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:choose&gt;&lt;c:when test="${value gt 0}"&gt;
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
&lt;/c:when&gt;&lt;c:when test="${value lt 0}"&gt;
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
&lt;/c:when&gt;&lt;c:otherwise&gt;
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
&lt;/c:otherwise&gt;&lt;/c:choose&gt;

### for Velocity
#if($value &gt; 0)
&lt;div&gt;
  Value is positive.
&lt;/div&gt;
#elseif($value &lt; 0)
&lt;div&gt;
  Value is negative.
&lt;/div&gt;
#else
&lt;div&gt;
  Value is zero.
&lt;/div&gt;
#end
</pre>
<p>If using '<code>elseif</code>' or '<code>else</code>' directives, don't insert empty lines just before.
</p>
<br>


<a name="kd-foreach"></a>
<h3 class="section2">Iteration (foreach)</h3>
<p>'<code>id="foreach:<i>loopvar</i>=<i>list</i>)"</code>' (or '<code>id="foreach:<i>loopvar</i>:<i>list</i>)"</code>') is a directive for iteration, assigning each value in the array into a variable each time through the loop.
</p>
<p>Presentation Data:
</p>
<a name="directive-foreach.pdata"></a>
<pre class="program">&lt;tr <b>id="foreach:item=list"</b>&gt;
  &lt;td&gt;@{item}@&lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>Output Program:
</p>
<pre class="output">&lt;% for item in list do %&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;%= item %&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;% end %&gt;
### for eRuby
&lt;% for item in list do %&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;%= item %&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;% end %&gt;

### for PHP
&lt;?php foreach ($list as $item) { ?&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;?php echo $item; ?&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:forEach var="item" items="${list}"&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;

### for Velocity
#foreach($item in $list)
&lt;tr&gt;
  &lt;td&gt;$!{item}&lt;/td&gt;
&lt;/tr&gt;
#end
</pre>
<br>


<a name="kd-loop"></a>
<h3 class="section2">Iteration(loop)</h3>
<p>'<code>id="loop:<i>loopvar</i>=<i>list</i>"</code>' (or '<code>id="loop:<i>loopvar</i>:<i>list</i>"</code>') is a directive for iteration.
It iterates only contents. The start tag and the end tag are not iterated.
It is very useful especially for &lt;dl&gt;&lt;/dl&gt; tag.
</p>
<p>Presentation Data:
</p>
<a name="directive-loop.pdata"></a>
<pre class="program">&lt;dl <b>id="loop:item=list"</b>&gt;
  &lt;dt&gt;@{item.text}@&lt;/dt&gt;
  &lt;dd&gt;@{item.desc}@&lt;/dd&gt;
&lt;/dl&gt;
</pre>
<p>Output Program:
</p>
<pre class="output">&lt;dl&gt;
&lt;% for item in list do %&gt;
  &lt;dt&gt;&lt;%= item.text %&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;%= item.desc %&gt;&lt;/dd&gt;
&lt;% end %&gt;
&lt;/dl&gt;
### for eRuby
&lt;dl&gt;
&lt;% for item in list do %&gt;
  &lt;dt&gt;&lt;%= item.text %&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;%= item.desc %&gt;&lt;/dd&gt;
&lt;% end %&gt;
&lt;/dl&gt;

### for PHP
&lt;dl&gt;
&lt;?php foreach ($list as $item) { ?&gt;
  &lt;dt&gt;&lt;?php echo $item-&gt;text; ?&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;?php echo $item-&gt;desc; ?&gt;&lt;/dd&gt;
&lt;?php } ?&gt;
&lt;/dl&gt;

### for JSTL
&lt;dl&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;dt&gt;&lt;c:out value="${item.text}" escapeXml="false"/&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;c:out value="${item.desc}" escapeXml="false"/&gt;&lt;/dd&gt;
&lt;/c:forEach&gt;
&lt;/dl&gt;

### for Velocity
&lt;dl&gt;
#foreach($item in $list)
  &lt;dt&gt;$!{item.text}&lt;/dt&gt;
  &lt;dd&gt;$!{item.desc}&lt;/dd&gt;
#end
&lt;/dl&gt;
</pre>
<br>


<a name="kd-foreach2"></a>
<h3 class="section2">Iteration with Count</h3>
<p>'<code>id="Foreach:<i>var</i>=<i>list</i>"</code>' and '<code>id="Loop:<i>var</i>=<i>list</i>"</code>' are directives for iteration with loop counting.
The counter variable is <code><i>var</i>_ctr</code>. It starts at 1.
</p>
<p>Presentation Data:
</p>
<a name="directive-foreach2.pdata"></a>
<pre class="program">&lt;tr <b>id="Foreach:item=list"</b>&gt;
  &lt;td&gt;@{item_ctr}@&lt;/td&gt;
  &lt;td&gt;@{item}@&lt;td&gt;
&lt;/tr&gt;
</pre>
<p>Output Program:
</p>
<pre class="output">&lt;% item_ctr = 0 %&gt;
&lt;% for item in list do %&gt;
&lt;%   item_ctr += 1 %&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;%= item_ctr %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;%= item %&gt;&lt;td&gt;
&lt;/tr&gt;
&lt;% end %&gt;
### for eRuby
&lt;% item_ctr = 0 %&gt;
&lt;% for item in list do %&gt;
&lt;%   item_ctr += 1 %&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;%= item_ctr %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;%= item %&gt;&lt;td&gt;
&lt;/tr&gt;
&lt;% end %&gt;

### for PHP
&lt;?php $item_ctr = 0; ?&gt;
&lt;?php foreach ($list as $item) { ?&gt;
&lt;?php   $item_ctr += 1; ?&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;?php echo $item_ctr; ?&gt;&lt;/td&gt;
  &lt;td&gt;&lt;?php echo $item; ?&gt;&lt;td&gt;
&lt;/tr&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:set var="item_ctr" value="0"/&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;c:set var="item_ctr" value="${item_ctr + 1}"/&gt;
&lt;tr&gt;
  &lt;td&gt;&lt;c:out value="${item_ctr}" escapeXml="false"/&gt;&lt;/td&gt;
  &lt;td&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;

### for Velocity
#set($item_ctr = 0)
#foreach($item in $list)
  #set($item_ctr = $item_ctr + 1)
&lt;tr&gt;
  &lt;td&gt;$!{item_ctr}&lt;/td&gt;
  &lt;td&gt;$!{item}&lt;td&gt;
&lt;/tr&gt;
#end
</pre>
<br>


<a name="kd-foreach3"></a>
<h3 class="section2">Iteration with a Toggle Switch</h3>
<p>'<code>id="FOREACH:<i>var</i>=<i>list</i>"</code>' and '<code>id="LOOP:<i>var</i>=<i>list</i>"</code>' are directives for iteration with toggle switching.
The toggle switch's value changes depending on whether loop counter is odd or even.
The toggle switch is named <code><i>var</i>_tgl</code>.
The value of the toggle switch is '<code>"odd"</code>' or '<code>"even"</code>' by default.
You can change them with the command-line option '<code>--odd=<i>value</i></code>' and '<code>--even=<i>value</i></code>',
or constant variable ODD and EVEN in configuration file kwartz/config.rb.
</p>
<p>Presentation Data:
</p>
<a name="directive-foreach3.pdata"></a>
<pre class="program">&lt;table&gt;
  &lt;tbody <b>id="LOOP:item=list"</b>&gt;
    &lt;tr class="<b>@{item_tgl}@</b>"&gt;
      &lt;td&gt;@{item}@&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
</pre>
<p>Output Program:
</p>
<pre class="output">&lt;table&gt;
  &lt;tbody&gt;
&lt;% item_ctr = 0 %&gt;
&lt;% for item in list do %&gt;
&lt;%   item_ctr += 1 %&gt;
&lt;%   item_tgl = item_ctr % 2 == 0 ? "even" : "odd" %&gt;
    &lt;tr class="&lt;%= item_tgl %&gt;"&gt;
      &lt;td&gt;&lt;%= item %&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;% end %&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
### for eRuby
&lt;table&gt;
  &lt;tbody&gt;
&lt;% item_ctr = 0 %&gt;
&lt;% for item in list do %&gt;
&lt;%   item_ctr += 1 %&gt;
&lt;%   item_tgl = item_ctr % 2 == 0 ? "even" : "odd" %&gt;
    &lt;tr class="&lt;%= item_tgl %&gt;"&gt;
      &lt;td&gt;&lt;%= item %&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;% end %&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

### for PHP
&lt;table&gt;
  &lt;tbody&gt;
&lt;?php $item_ctr = 0; ?&gt;
&lt;?php foreach ($list as $item) { ?&gt;
&lt;?php   $item_ctr += 1; ?&gt;
&lt;?php   $item_tgl = $item_ctr % 2 == 0 ? "even" : "odd"; ?&gt;
    &lt;tr class="&lt;?php echo $item_tgl; ?&gt;"&gt;
      &lt;td&gt;&lt;?php echo $item; ?&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;?php } ?&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

### for JSTL
&lt;table&gt;
  &lt;tbody&gt;
&lt;c:set var="item_ctr" value="0"/&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;c:set var="item_ctr" value="${item_ctr + 1}"/&gt;
  &lt;c:set var="item_tgl" value="${item_ctr % 2 eq 0 ? 'even' : 'odd'}"/&gt;
    &lt;tr class="&lt;c:out value="${item_tgl}" escapeXml="false"/&gt;"&gt;
      &lt;td&gt;&lt;c:out value="${item}" escapeXml="false"/&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;/c:forEach&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

### for Velocity
&lt;table&gt;
  &lt;tbody&gt;
#set($item_ctr = 0)
#foreach($item in $list)
  #set($item_ctr = $item_ctr + 1)
  #if($item_ctr % 2 == 0)
    #set($item_tgl = "even")
  #else
    #set($item_tgl = "odd")
  #end
    &lt;tr class="$!{item_tgl}"&gt;
      &lt;td&gt;$!{item}&lt;/td&gt;
    &lt;/tr&gt;
#end
  &lt;/tbody&gt;
&lt;/table&gt;
</pre>
<br>


<a name="kd-while"></a>
<h3 class="section2">Iteration (while)</h3>
<p>'<code>id="while:<i>expression</i>"</code>' is a directive to iterate with a while statement. 
</p>
<p>Kwartz will raise an error when compiling a while statement into JSP,
because there is no custom tag in JSTL which is equivalent to a while statement.
</p>
<p>Presentation Data:
</p>
<a name="directive-while.pdata"></a>
<pre class="program">&lt;tr <b>id="while:row=sth.fetch()"</b>&gt;
  &lt;td&gt;@{row[0]}@&lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>Output Program:
</p>
<pre class="output"></pre>
<br>


<a name="kd-dummy"></a>
<h3 class="section2">Dummy data</h3>
<p>'<code>id="dummy:<i>str</i>"</code>' is a directive for ignoring an element.
</p>
<p>'<code><i>str</i></code>' has no effect. It is to make id attribute value to be unique in the HTML file.
</p>
<p>Presentation Data:
</p>
<pre class="program">&lt;tr <b>id="dummy:d1"</b>&gt;
  &lt;td&gt;bar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr <b>id="dummy:d2"</b>&gt;
  &lt;td&gt;baz&lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>Intermediate Code:
</p>
<pre class="output">                          // Nothing
</pre>
<p>Output Program:
</p>
<pre class="output">                          // Nothing
</pre>
<br>


<a name="kd-replace"></a>
<h3 class="section2">Replacement of Elements</h3>
<p>'<code>id="replace:<i>name</i>"</code>' replaces an element with other element
which is already marked with the name <i>name</i>.
</p>
<p>Presentation Data:
</p>
<a name="directive-replace.pdata"></a>
<pre class="program">&lt;html&gt;
  &lt;body&gt;
    &lt;!-- breadcrumbs navigation --&gt;
    &lt;div <b>id="mark:breadcrumbs"</b>&gt;
      &lt;a href="/"&gt;Home&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz"&gt;Kwartz&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz/ruby"&gt;Kwartz-ruby&lt;/a&gt;
    &lt;/div&gt;

   ....

    &lt;div <b>id="replace:breadcrumbs"</b>&gt;
      Home &amp;gt; Kwartz &amp;gt; Kwartz-ruby
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/html
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;html&gt;
  &lt;body&gt;
    &lt;!-- breadcrumbs navigation --&gt;
    &lt;div&gt;
      &lt;a href="/"&gt;Home&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz"&gt;Kwartz&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz/ruby"&gt;Kwartz-ruby&lt;/a&gt;
    &lt;/div&gt;

   ....

    &lt;div&gt;
      &lt;a href="/"&gt;Home&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz"&gt;Kwartz&lt;/a&gt;
      &amp;gt; &lt;a href="/kwartz/ruby"&gt;Kwartz-ruby&lt;/a&gt;
    &lt;/div&gt;
&lt;/html
</pre>
<p>The command-line option '<code>-i <i>file1</i>,<i>file2</i>,<i>...</i></code>' enables you to use elements
in other files.
</p>
<br>


<a name="kd-placeholder"></a>
<h3 class="section2">Placeholder</h3>
<p>'<code>id="placeholder:<i>name</i>"</code>' replaces content of the element by other element
which is already marked with the name <i>name</i>.
Usually this directive is used to import elements defined in other files,
with the command-line option <code>-i <i>file1</i>,<i>file2</i>,<i>...</i></code>.
</p>
<p>Presentation Data(article.html):
</p>
<a name="directive-placeholder-article.pdata"></a>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    &lt;div <b>id="mark:article"</b>&gt;
      &lt;p&gt;Kwartz is a template system, which realized the
         concept &lt;strong&gt;`Separation of Presentation Logic
         and Presentation Data'(SoPL/PD)&lt;/strong&gt;.
      &lt;/p&gt;
    &lt;/div&gt;
    
  &lt;/body&gt;
&lt;/html&gt;

</pre>
<p>Presentation Data(layout.html):
</p>
<a name="directive-placeholder-layout.pdata"></a>
<pre class="program">&lt;!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
    &lt;link rel="stylesheet" type="text/css" href="design.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;table border="0"&gt;
      &lt;tr&gt;
        &lt;td width="400" <b>id="placeholder:article"</b>&gt;
          aaa&lt;br&gt;
          bbb&lt;br&gt;
          ccc&lt;br&gt;
          ddd&lt;br&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>Compile:
</p>
<pre class="terminal">$ kwartz <b>-i article.html</b> layout.html
</pre>
<p>Output Script:
</p>
<pre class="output">&lt;!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
    &lt;link rel="stylesheet" type="text/css" href="design.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;table border="0"&gt;
      &lt;tr&gt;
        &lt;td width="400"&gt;
    &lt;div&gt;
      &lt;p&gt;Kwartz is a template system, which realized the
         concept &lt;strong&gt;`Separation of Presentation Logic
         and Presentation Data'(SoPL/PD)&lt;/strong&gt;.
      &lt;/p&gt;
    &lt;/div&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<a name="kd-include"></a>
<h3 class="section2">Including Presentation Data Files</h3>
<p><code>id="include:<i>filename</i>"</code> is a directive to read and to include another presentation data file (HTML file).
Included data file can contain directives.
</p>
<p>Presentation Data (copyright.html) :
</p>
<a name="copyright.html"></a>
<pre class="program">&lt;!-- begin footer --&gt;
&lt;center&gt;
  copyright&amp;copy; &lt;span id="value:year"&gt;2005&lt;/span&gt; kuwata-lab all rights reserverd
&lt;/center&gt;
&lt;!-- end footer --&gt;
</pre>
<p>Presentation Data (mainpage.html) :
</p>
<a name="mainpage.html"></a>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    ... main contents ...

    &lt;div id="include:copyright.html"&gt;
      ... copyright ...
    &lt;/div&gt;

  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>Compile:
</p>
<pre class="terminal">$ kwartz -l eruby mainpage.html &gt; mainpage.view
</pre>
<p>Output Script:
</p>
<pre class="program">&lt;html&gt;
  &lt;body&gt;

    ... main contents ...

&lt;!-- begin footer --&gt;
&lt;center&gt;
  copyright&amp;copy; &lt;%= year %&gt; kuwata-lab all rights reserverd
&lt;/center&gt;
&lt;!-- end footer --&gt;

  &lt;/body&gt;
&lt;/html&gt;
### for eRuby
</pre>
<p>'<code>Include</code>' and '<code>INCLUDE</code>' directives are also available.
</p>
<ul type="disc">
<li>'<code>include</code>' directive replaces the element by presentation data included.
</li>
<li>'<code>Include</code>' directive inserts the presentation data included before the element.
</li>
<li>'<code>INCLUDE</code>' directive inserts the presentation data included after the element.
</li>
</ul>
<p>When presentation data files to be included are placed in other directories,
you can specify those directories with the command-line option <code>--incdirs=<i>dir1</i>,<i>dir2</i>,...</code>
or the constant <code>INCDIRS</code> in configuration file.
</p>
<br>


<a name="kd-idkd"></a>
<h3 class="section2">id and kw:d Attributes</h3>
<ul type="disc">
<li>The kw:d attribute is equivalent to the id attribute in Kwartz.
   Anything that can go in an id attribute can also be placed in a kw:d attribute.
</li>
</ul>
<ul type="disc">
<li>If a tag has both an id attribute and a kw:d attribte,
   Kwartz overrides the former with the latter.
   For example, if you write '<code>id="name" kw:d="foreach:item=list"</code>',
</li>
</ul>
<ul type="disc">
<li>However, if the kw:d attribute has only <code>attr</code> directives,
   then the id attribute is not overwritten.
   For example, if you write '<code>id="name" kw:d="attr:href=url"</code>,
   the element is marked with the name <code>name</code>.
</li>
</ul>
<ul type="disc">
<li>The HTML Specification defines that the id attribute value can contain only alphanumeric characters, underscores (<code>_</code>), colons(<code>:</code>), hyphens(<code>-</code>) and periods(<code>.</code>).
   Other characters cannot be in the id attribute.
   This means that <code>id="foreach:item=list"</code> or <code>id="attr:name=value"</code> are not valid according to the HTML Specification.
   Therefore, it is recommended to write <code>id="foreach:item:list"</code> or <code>id="attr:name:value"</code> instead.
</li>
</ul>
<ul type="disc">
<li>You can change the kw:d attribte name with the command-line option <code>--dattr=<i>xxx</i></code>.
   For example, <code>--dattr=style</code> make Kwartz to use 'style' attributes instead of 'kw:d' attributes.
   Constant <code>DATTR</code> in configuration file also enables you to change 'kw:d' attribute name.
</li>
</ul>
<br>


<a name="kd-notes"></a>
<h3 class="section2">Notes</h3>
<p>These are some notes on the use of directives.
</p>
<ul type="disc">
<li>One id or kw:d attribute can have only one directive.
   For example, '<code>id="set:var=100;value:var"</code>' causes an error.
<pre class="program">## NG
&lt;span id="set:var=100;value:var"&gt;foo&lt;/span&gt;
</pre>
</li>
</ul>
<ul type="disc">
<li>However, the '<code>attr:<i>name</i>=<i>value</i></code>' directive and the '<code>append=<i>expression</i></code>' directive can be used with other directive in an id attribute,
   as well as with itself.
<pre class="program">## OK
&lt;foo id="foreach:item=list;attr:class=item.class;attr:href=item.url"&gt;
....
&lt;/foo&gt;
</pre>
</li>
</ul>
<ul type="disc">
<li>You cannot omit end-tags when using Kwartz directives.
   But you can use empty-element tags, such as '<code>&lt;foo .../&gt;</code>'.
<pre class="program">## NG
&lt;ul&gt;
  &lt;li id="value:item"&gt;foo
&lt;/ul&gt;
## OK
&lt;a id="attr:name=refname"/&gt;
</pre>
</li>
</ul>
<ul type="disc">
<li>The &lt;span&gt;&lt;/span&gt; tag is deleted if it has only directives.
   For example, the presentation data '<code>Hello &lt;span id="value:name"&gt;World&lt;/span&gt;!</code>' will be converted into the output script '<code>Hello &lt;%= name %&gt;!</code>' (in eRuby), deleting &lt;span&gt;&lt;/span&gt;.
<pre class="program">## presentation data
Hello &lt;span id="value:name"&gt;World&lt;/span&gt;!
## output script for eRuby
Hello &lt;%= name %&gt;!
</pre>
</li>
</ul>
<ul type="disc">
<li>You must describe attributes like <code><i>attr</i>="<i>value</i>"</code> in the start tag which contains directives.
   In other words, you cannot omit attribute names or attribute values when using directives.
   This is not a bug; it's an intended behavior so as to make Kwartz available in any text file.
<pre class="program">## NG
&lt;input type="checkbox" id="foreach:item=list" <b>checked</b>/&gt;
## OK
&lt;input type="checkbox" id="foreach:item=list" <b>checked="checked"</b>/&gt;

## NG
&lt;option id="attr:value=val" @{flag ? 'selected' : ''}@/&gt;
## OK
&lt;option value="@{val}@" @{flag ? 'selected' : ''}@&gt;
</pre>
</li>
</ul>
<br>


<br>


<a name="plogic"></a>
<h2 class="section1">Presentation Logic File Format</h2>
<p>The following is an example of presentation logic file.
</p>
<p>Presentation logic:
</p>
<pre class="program">// element declaration for 'id="mark:name"'
#name {
  
  // print value of expression instead of content
  value:  <i>expression</i>;
  
  // set attribute values
  attr: "<i>attr1</i>" <i>expr1</i>, "<i>attr2</i>" <i>expr2</i>, "<i>attr3</i>" <i>expr3</i>;
  
  // remove attributes
  remove:  "<i>attr1</i>", "<i>attr2</i>", "<i>attr3</i>";
  
  // append expression to start tag
  append:  "<i>expr1</i>", "<i>expr2</i>", "<i>expr3</i>";
  
  // change tag name
  tagname: "<i>tagname</i>",

  // set presentation logic
  plogic: {
    @stag;
    @cont;
    @etag;
  }
}

// document declaration
#DOCUMENT {
  // logics to do at the beginning of the document
  begin: {
    ...
  }

  // logics to do at the end of the document
  end: {
    ...
  }
  
  // load presentation logic file required
  require: file1.plogic, file2.plogic;
}
</pre>
<br>


<a name="opt"></a>
<h2 class="section1">Command-line options</h2>
<p>The script 'kwartz' is a commad-line script to compile templates (presentation data file and presentation logic file) into output scripts.
</p>
<p>Usage:
<b><code>kwartz [options...] [-p plogic ] pdata.html &gt; output-script</code></b>
</p>
<p>Options:
</p>
<dl class="dl3">
<dt class="dt3"><b>
-h, --help</b></dt>
<dd class="dd3">
	Print help.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
-v</b></dt>
<dd class="dd3">
	Version information.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
-a <i>action</i></b></dt>
<dd class="dd3">
	Action to do. <i>action</i> may be one of the following (default is 'compile').
	<dl class="dl1" compact>
	<dt class="dt1">
compile</dt>
	<dd class="dd1">
		Read presentation data and presentation logic, and generate output script.
	</dd>
	<dt class="dt1">
analyze</dt>
	<dd class="dd1">
		Read presentation data and presentation logic, and report scope of variables.
	</dd>
	<dt class="dt1">
defun</dt>
	<dd class="dd1">
		Read presentation data and presentation logic, and define function of Ruby or PHP.
	</dd>
	<dt class="dt1">
convert</dt>
	<dd class="dd1">
		Read presentation data, and convert to PL program. This is for debugging.
	</dd>
	<dt class="dt1">
translate</dt>
	<dd class="dd1">
		Read PL program, and translate into output script. This is for debugging.
	</dd>
	</dl>
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
-e , -s</b></dt>
<dd class="dd3">
	Enable auto-sanitizing. This option is equal to <code>--escape=true</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
-i <i>file1,file2,...</i></b></dt>
<dd class="dd3">
	Import elements defined in outer files.
	Usually this option is used for 'placeholder' directive ('<code>id="placeholder:<i>name</i></code>').
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
-l <i>lang</i></b></dt>
<dd class="dd3">
	Target language of the output script. <i>lang</i> may be
	eruby, erb, php, jstl11, jstl10, velocity.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
-p <i>plogic-file</i></b></dt>
<dd class="dd3">
	Filename of the presentation logics. It is possible to specify several filename using '<code>,</code>' as a separator.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--charset=<i>charset</i></b></dt>
<dd class="dd3">
	Character set. Kwartz will print '<code>&lt;%@ page contentType="text/html; charset=<i>charset</i>" %&gt;</code>' in JSTL.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--dname=<i>name</i></b></dt>
<dd class="dd3">
	Attribute name used as a directive. Default is 'kw:d'.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--escape=<i>true</i>|<i>false</i></b></dt>
<dd class="dd3">
	Auto-sanitizing. If value is ommited then true is used as value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--even=<i>value</i></b></dt>
<dd class="dd3">
	Even value. Default is <code>'even'</code>. Directives FOREACH and LIST will use this value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--extract=<i>name</i></b></dt>
<dd class="dd3">
	Extract an element which is marked with name <i>name</i>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--footer=<i>string</i></b></dt>
<dd class="dd3">
	Footer string.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--header=<i>string</i></b></dt>
<dd class="dd3">
	Header string.
	'<code>&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;</code>' is used as default in JSP.
	If you don't want to print any header text, use <code>--header=false</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--indent=' '</b></dt>
<dd class="dd3">
	Specifies the indent space of output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--incdirs=<i>dir1</i>,<i>dir2</i>,...</b></dt>
<dd class="dd3">
	Specify directories from which '<code>include</code>' directive includes.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--odd=<i>value</i></b></dt>
<dd class="dd3">
	Odd value. Default is <code>'odd'</code>. Directives FOREACH and LIST will use this value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
--rename=<i>true</i>|<i>false</i></b></dt>
<dd class="dd3">
	Specify rename or not local variable names.  Regarded as true when value is omitted.
</dd>
</dl>
<p>Examples:
</p>
<ul type="disc">
<li>Compile presentation data file 'file1.html' and get an output script 'file1.rhtml'.
	The target language is eRuby.
<pre class="terminal">$ kwartz -l eruby file1.html &gt; file1.rhtml
</pre>
</li>
</ul>
<ul type="disc">
<li>Compile presentation data file 'file1.html' and a presentation logic file 'file1.plogic', and get an output script 'file1.php'.
	The target language is PHP.
<pre class="terminal">$ kwartz -l php -p file1.plogic file1.html &gt; file1.php
</pre>
</li>
</ul>
<ul type="disc">
<li>Convert presentation data into PL program.
<pre class="terminal">$ kwartz -a convert file1.html | more
</pre>
</li>
</ul>
<br>


<a name="config"></a>
<h2 class="section1">Configuration options</h2>
<p>You can sepcify Kwartz options in configuration file.
Configuration file for Kwartz is different for each implementation.
It is kwartz/config.rb in Kwartz-ruby.
</p>
<p>The following is the options for Kwartz.
</p>
<dl class="dl3">
<dt class="dt3"><b>
ESCAPE </b></dt>
<dd class="dd3">
	Specify auto-sanitizing on/off.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
NEWLINE </b></dt>
<dd class="dd3">
	Specify a string which represents newline characters ("\n" or "\r\n") of output script.
	You don't have to change this option because Kwartz detects newline characters automatically.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
INDENT </b></dt>
<dd class="dd3">
	Specify a string which represents indent of output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
RENAME </b></dt>
<dd class="dd3">
	Specify whether rename local variable names. 
	If true, '_' is added to beginning of local variable name.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
RENAME_PREFIX </b></dt>
<dd class="dd3">
	Specify the prefix of local variable name when RENAME is true.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
LANG </b></dt>
<dd class="dd3">
	Specify default language for output script.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
ODD </b></dt>
<dd class="dd3">
	Specify odd value of toggle variable.
	This is used by <code>id="FOREACH:<i>var</i>=<i>list</i>"</code> and <code>id="LOOP:<i>var</i>=<i>list</i>"</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
EVEN </b></dt>
<dd class="dd3">
	Specify even value of toggle variable.
	This is used by <code>id="FOREACH:<i>var</i>=<i>list</i>"</code> and <code>id="LOOP:<i>var</i>=<i>list</i>"</code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
DATTR </b></dt>
<dd class="dd3">
	Specify an attribute name for directives. Default is '<code>kw:d</code>'.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
NOEND </b></dt>
<dd class="dd3">
	List of tag name which doesn't require end tag. Default is [ "input", "br", "meta", "img", "hr" ].
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
DEFUN_CLASS </b></dt>
<dd class="dd3">
	Default name of class or module when defining functions with the command-line option '-a defun'.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
DEFUN_FUNCTION </b></dt>
<dd class="dd3">
	Default name of function or method when defining functions with the command-line option '-a defun'.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
CHARSET </b></dt>
<dd class="dd3">
	Specify character encoding name for jstl11 and jstl10.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
EMBED_PATTERN </b></dt>
<dd class="dd3">
	Specify a pattern to embed expression into presentation data.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
INCDIRS </b></dt>
<dd class="dd3">
	Specify a list of directories from which '<code>include</code>' directive includes.
	Default is [ "." ].
</dd>
</dl>
<br>



   </div>
  </blockquote>

 </body>
</html>
