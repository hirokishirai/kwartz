<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html">
  <title>Kwartz 3.0 Users' Guide</title>
  <meta name="author" content="Makoto Kuwata &lt;kwa(at)kuwata-lab.com&gt;">
  <meta name="generator" content="kwaser">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <link rel="stylesheet" href="docstyle.css" type="text/css">
 </head>
 <body>

  <blockquote>
   <div class="mainbody">

    <div align="left"><h1>Kwartz 3.0 Users' Guide</h1></div>
    <div align="left">
      Makoto Kuwata &lt;kwa(at)kuwata-lab.com&gt;<br>
      last update: $Date: 2006-05-22 22:25:43 +0900 (Mon, 22 May 2006) $<br>
    </div>

<a name="preface"></a>
<h2 class="section1">Preface</h2>
<p>This is the users' guide of Kwartz<sup>(<a href="#fnref:1" name="fnlink:1">*1</a>)</sup>,
a template system which realized the concept of 'Independence of Presentation Logic'.
</p>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:1" href="#fnlink:1">*1</a>)</dt>
  <dd>Development of Kwartz had subsidized by Exploratory Software Project of <a href="http://www.ipa.go.jp/about/english/index.html">IPA (Information-Technology Promotion Agency Japan)</a>.</dd>
 </dl>
</div>
<a name="toc"></a>
<h3 class="section2">Table of Contents</h3>
<ul>
  <li><a href="#preface">Preface</a>
  <ul>
    <li><a href="#toc">Table of Contents</a>
    </li>
  </ul>
  </li>
  <li><a href="#intro">Introduction to Kwartz</a>
  <ul>
    <li><a href="#whatis">What's Kwartz?</a>
    </li>
    <li><a href="#features">Features Overview</a>
    </li>
    <li><a href="#example1">Simple Example</a>
    </li>
    <li><a href="#example2">Complex Example</a>
    </li>
    <li><a href="#pattern">Other Examples of Presentation Logic</a>
    </li>
  </ul>
  </li>
  <li><a href="#Features Detail">Features Detail</a>
  <ul>
    <li><a href="#Rules">Rules</a>
    </li>
    <li><a href="#directives">Directives</a>
    </li>
    <li><a href="#escape">Escape</a>
    </li>
    <li><a href="#langs">Multi-language</a>
    </li>
  </ul>
  </li>
  <li><a href="#topics">Other Topics</a>
  <ul>
    <li><a href="#restriction1">Restrictions around presentation logic</a>
    </li>
    <li><a href="#restriction2">Restrictions around presentation data</a>
    </li>
    <li><a href="#span">Span Tag Deletion</a>
    </li>
    <li><a href="#start_link_to"><code>link_to()</code> method in Ruby on Rails</a>
    </li>
    <li><a href="#import-plogic">Import Presentation Logic File</a>
    </li>
    <li><a href="#import-elem">Import Elements in Other Files</a>
    </li>
    <li><a href="#extract">Extract Element</a>
    </li>
    <li><a href="#print-statement">Print Statement</a>
    </li>
    <li><a href="#Add Code Before/After Document">Add Code Before/After Document</a>
    </li>
  </ul>
  </li>
</ul>
<br>


<br>


<a name="intro"></a>
<h2 class="section1">Introduction to Kwartz</h2>
<a name="whatis"></a>
<h3 class="section2">What's Kwartz?</h3>
<p>Kwartz<sup>(<a href="#fnref:2" name="fnlink:2">*2</a>)</sup> is a template system
which realized the concept of <b>'Independence of Presentation Logic'(IoPL)</b>.
</p>
<p>You may know CSS (Cascading Style Sheet). CSS separates design from HTML file.
In the same way, Kwartz separates presentation logics from HTML template.
If you are familiar with CSS, you'll be also familiar with Kwartz.
</p>
<p>Kwartz-ruby is an implemenation of Kwartz in Ruby.
There is a plan to implement Kwartz in PHP or Java.
</p>
<p>In the following, the word 'Kwartz' means the specification of the template system
 and the word 'Kwartz-ruby' means the implementation of it in Ruby language.
</p>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:2" href="#fnlink:2">*2</a>)</dt>
  <dd>'Kwartz' is pronounced like 'Quartz'.</dd>
 </dl>
</div>
<br>


<a name="features"></a>
<h3 class="section2">Features Overview</h3>
<p>Kwartz has the following features:
</p>
<dl class="dl2">
<dt class="dt2">
Separates presentation logic from presentation data.</dt>
<dd class="dd2">
<p>	Using template systems such as Smarty, Velocity, XMLC, amrita, etc,
	you can separate HTML design from business logic as a template.
	With Kwartz, you can separate presentation logic from a template.
	In other words, Kwartz divides a template into 'presentation data' and 'presentation logic'.
	You need not mix presentation logic into HTML files nor main program.
</p>
</dd>
<dt class="dt2">
Very fast</dt>
<dd class="dd2">
<p>	Kwartz creates a script from a template (= presentation data and presentaion logic). 
	All you have to do in main program is to call the output script.
	Because Kwartz doesn't use DOM trees or the like, it is both fast and light-weight.
</p>
</dd>
<dt class="dt2">
Multi-languages support</dt>
<dd class="dd2">
<p>	Kwartz can create output scripts for Ruby(eRuby), PHP, JSP(JSTL 1.2 &amp; 1.1).
	Presentation logics are written in each language<sup>(<a href="#fnref:3" name="fnlink:3">*3</a>)</sup>.
	This approach gives you the power of the target language fully.
	For example, you can write Ruby on Rails helper method (such as <code>link_to</code>, <code>field_tag</code>, and so on) directly in your template file.
</p>
</dd>
<dt class="dt2">
Doesn't break HTML design at all</dt>
<dd class="dd2">
<p>	You must use directives like 
	<code>{foreach ...}{/foreach}</code> in <a href="http://smarty.php.net/">Smarty</a> or
	<code>#foreach(...)</code> in <a href="http://jakarta.apache.org/velocity/">Jakarta Velocity</a>.
	These directives break the HTML design of template.
	Kwartz doesn't break HTML design because Kwartz uses id or title attributes for marking in an HTML template.
</p>
</dd>
<dt class="dt2">
Able to handle any text file</dt>
<dd class="dd2">
<p>	Kwartz uses an original template parser; not using an HTML or XML parser,
	it is able to handle any type of text file (HTML, PostScript, CSV, and so on).
	This also means that Kwartz can handle non-well-formed XML files, as well as well-formed XML files.
	This is an advantage of Kwartz against <a href="http://xmlc.objectweb.org/">Enhydra XMLC</a> or
	<a href="http://amrita.sourceforge.jp/">amrita</a>, which handle only XML/HTML files.
</p>
</dd>
<dt class="dt2">
Auto-escape and Partial-escape</dt>
<dd class="dd2">
<p>	Kwartz can do sanitizing automatically.
	You don't need to write '<code>CGI.escapeHTML(var)</code>' or '<code>htmlspecialchars($var)</code>'.
	You are free to turn sanitizing on/off, as well specifying which parts of the template to sanitize.
</p>
</dd>
</dl>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:3" href="#fnlink:3">*3</a>)</dt>
  <dd>Previous version of Kwartz adopt original language and convert it to each target language(Ruby, PHP, JSTL, and so on). From Current version, it is required to write presentation logic in target language.</dd>
 </dl>
</div>
<br>


<a name="example1"></a>
<h3 class="section2">Simple Example</h3>
<p>In Kwartz, a template is defined as both presentation data and presentation logic.
They may be described in separate files.
</p>
<p>This is an example of a presentation data file.
</p>
<ul type="disc">
<li>'<b><code>id="list1"</code></b>' means "I'll operate this element in presentation logic" (called 'marking' in Kwartz).
</li>
<li>'<b><code>id="mark:item1"</code></b>' is also an marking.
   Difference between <code>id="mark:item1"</code> and <code>id="item1"</code> is that id attribute in the former format is removed automatically and the latter format is leaved.
</li>
</ul>
<p>Presentation data file(example1.html):
</p>
<a name="example1.html"></a>
<pre class="program">&lt;table&gt;
  &lt;tr <b>id="list1"</b>&gt;
    &lt;td <b>id="mark:item1"</b>&gt;foo&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</pre>
<p>And the following is an example of presentation logic.
In presentation logic, you can operate on elements which are marked in presentation data.
</p>
<ul type="disc">
<li>'<b><code>#list1 { ... }</code></b>' represents an element marked with name 'list1' (= '&lt;tr&gt;...&lt;/tr&gt;')
    <ul type="circle">
    <li>'<b><code>logic: { ... }</code></b>' represents presentation logic of the element.
    </li>
    <li>'<b><code>_stag</code></b>' represents a start tag (= '&lt;tr&gt;').
    </li>
    <li>'<b><code>_cont</code></b>' represents content(= '&lt;td id="mark:item1"&gt;foo&lt;/td&gt;').
    </li>
    <li>'<b><code>_etag</code></b>' represents an end tag(= '&lt;/tr&gt;').
    </li>
    <li>'<b><code>for <i>var</i> in <i>list</i> ...</code></b>' is a Ruby code to loop.
       In this case, the element(= start-tag + content + end-tag) is looped.
    </li>
    </ul>
</li>
<li>'<b><code>#item1 { ... }</code></b>' represents an element marked with name 'item1' (= '&lt;td&gt;...&lt;/td&gt;').
    <ul type="circle">
    <li>'<b><code>value: <i>expression</i>;</code></b>' represents that the content of the element is replaced by value of <code><i>expression</i></code>, which is value of a variable <code>member</code> in this case.
    </li>
    </ul>
</li>
</ul>
<a name="example1.plogic"></a>
<div class="program_caption">
Presentation logic file(example1.plogic):</div>
<pre class="program">/* The element which is marked by 'id="list1"' */
<b>#list1</b> {
  logic: {
    for member in @members
      <b>_stag</b>           # start tag
      <b>_cont</b>           # content
      <b>_etag</b>           # end tag
    end
  }
}

/* The element which is marked by 'id="mark:item1"' */
<b>#item1</b> {
  /* replace the content with value of a variable 'member' */
  value: member;
}
</pre>
<p>(Don't forget the semicolon at the end of line especially for Ruby user!)
</p>
<p>Kwartz generates eRuby script from the above files. This action is called 'compiling'.
</p>
<div class="terminal_caption">
how to compile eRuby script</div>
<pre class="terminal">$ kwartz -p example1.plogic example1.html &gt; example1.rhtml
</pre>
<p>The following is the compiled eRuby script.
Notice that <code>id="mark:item1"</code> is removed automatically while <code>id="list1"</code> is leaved.
</p>
<div class="program_caption">
generated eRuby script</div>
<pre class="program">&lt;table&gt;
&lt;%     for member in @members %&gt;
  &lt;tr id="list1"&gt;
    &lt;td&gt;&lt;%= member %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;%     end %&gt;
&lt;/table&gt;
</pre>
<br>


<a name="example2"></a>
<h3 class="section2">Complex Example</h3>
<p>Next is bordered table example which is a little complex than previous.
</p>
<a name="example2.html"></a>
<div class="program_caption">
Presentation Data (example2.html):</div>
<pre class="program">&lt;table&gt;
 &lt;tr bgcolor="#CCCCFF" <b>id="mark:list"</b>&gt;
  &lt;td <b>id="mark:name"</b>&gt;foo&lt;/td&gt;
  &lt;td&gt;
   &lt;a href="mailto:foo@mail.com" <b>id="mark:email"</b>&gt;foo@mail.com&lt;/a&gt;
  &lt;/td&gt;
 &lt;/tr&gt;
&lt;/table&gt;
</pre>
<p>The following is the presentation logic file.
In the presentation logic, you should detect whether odd or even line in the iteration.
</p>
<p>Presentation Logic (example2.plogic):
</p>
<a name="example2.plogic"></a>
<pre class="program">/*
 * an element which is marked by 'id="mark:list"'
 *  - print value of a variable 'color' as bgcolor attribute value.
 */
<b>#list</b> {
  attrs:  "bgcolor" color;
  logic: {
    @members.each_with_index do |member, i|
      color = i % 2 == 0 ? '#FFCCCC' : '#CCCCFF';
      _stag    # start tag
      _cont    # content
      _etag    # end tag
    end
  }
}

/*
 * an element which is marked by 'id="mark:name"':
 *  - print value of member[:name] as content of the element.
 */
<b>#name</b> {
  value: member[:name];
}

/*
 * an element marked by 'id="mark:email"':
 *  - print value of member[:email] as contentn of the element. 
 *  - print "mailto:" and member[:email] as href attribute value.
 */
<b>#email</b> {
  value: member[:email];
  attrs: "href" "mailto:#{member[:email]}";
}
</pre>
<p>(Don't forget the semicolon at the end of line especially for Ruby user!)
</p>
<p>You will find that there is no HTML tag in the presentation logic and no logic in the presentation data.
That is to say, Kwartz can separate presentation logic from presentation data.
</p>
<div class="terminal_caption">
compilation</div>
<pre class="terminal">$ kwartz -p example2.plogic example2.html &gt; example2.rhtml
</pre>
<div class="program_caption">
output script</div>
<pre class="program">&lt;table&gt;
&lt;%     @members.each_with_index do |member, i| %&gt;
&lt;%       color = i % 2 == 0 ? '#FFCCCC' : '#CCCCFF'; %&gt;
 &lt;tr bgcolor="&lt;%= color %&gt;"&gt;
  &lt;td&gt;&lt;%= member[:name] %&gt;&lt;/td&gt;
  &lt;td&gt;
   &lt;a href="&lt;%= "mailto:#{member[:email]}" %&gt;"&gt;&lt;%= member[:email] %&gt;&lt;/a&gt;
  &lt;/td&gt;
 &lt;/tr&gt;
&lt;%     end %&gt;
&lt;/table&gt;
</pre>
<br>


<a name="pattern"></a>
<h3 class="section2">Other Examples of Presentation Logic</h3>
<p>Kwartz enables you to write complex presentation logic natulally.
This section shows some examples.
See <a href="p-pattern.html">Presentation Pattern Catalog</a> for details.
</p>
<ul type="disc">
<li>Iterate an element.
<pre class="program">#list {
  logic: {
    for member in @members
      _stag
      _cont
      _etag
    end
  }
}
</pre>
   Or
<pre class="program">#list {
  logic: {
    for member in @members
      _elem     # equivarent to _stag + _cont + _etag
    end
  }
}
</pre>
</li>
</ul>
<ul type="disc">
<li>Iterate only contents. This is useful for &lt;dl&gt;&lt;/dl&gt;.
<pre class="program">#list {
  logic: {
    _stag
    for member in @members
      _cont
    end
    _etag
  }
}
</pre>
</li>
</ul>
<ul type="disc">
<li>Replace content of element by expression value.
<pre class="program">#list {
  logic: {
    _stag
    print expr
    _etag
  }
}
</pre>
   Or
<pre class="program">#list {
  value: expr;
}
</pre>
</li>
</ul>
<ul type="disc">
<li>Replace element by exression value
<pre class="program">#list {
  logic: {
    print expr
  }
}
</pre>
    Or
<pre class="program">#list {
  elem:  expr;
}
</pre>
</li>
</ul>
<ul type="disc">
<li>Delete start-tag and end-tag, and leaves content only.
<pre class="program">#list {
  logic: {
    _cont
  }
}
</pre>
</li>
</ul>
<ul type="disc">
<li>Delete elemnt. This is useful for delete dummy data.
<pre class="program">#list {
  logic: {
  }
}
</pre>
</li>
</ul>
<ul type="disc">
<li>Replace element with other element.
<pre class="program">#list {
  logic: {
    _element(foo)  # expand other element marked with name 'foo'
  }
}
</pre>
</li>
</ul>
<ul type="disc">
<li>Replace element with other element's content.
<pre class="program">#list {
  logic: {
    _content(foo)  # expand content of other element
  }
}
</pre>
</li>
</ul>
<ul type="disc">
<li>Include complex presentation logics.
<pre class="program">#list {
  logic: {
    i = 0
    for member in @members
      i += 1
      if i % 2 == 0
        color = '#FFCCCC'
      else
        color = '#CCCCFF'
      end
      _elem    # '_elem' is equivarent to _stag + _cont + _etag
    end
  }
}
</pre>
</li>
</ul>
<p>It is very important that tag/attribute names don't appear in presentation logic at all.
This way, you don't need to change presentation logic files even if the tag/attribute names are changed in the presentation data.
</p>
<p>Kwartz separates presentation logic from presentation data and main program.
</p>
<br>


<br>


<a name="Features Detail"></a>
<h2 class="section1">Features Detail</h2>
<a name="Rules"></a>
<h3 class="section2">Rules</h3>
<p>The following rules are available in presesntation logic file.
These are similar to CSS. If you are familiar with CSS, you'll be so with Kwartz.
</p>
<dl class="dl3">
<dt class="dt3"><b>
stag: <i>expr</i>; </b></dt>
<dd class="dd3">
	Replace start-tag by expression value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
etag: <i>expr</i>; </b></dt>
<dd class="dd3">
	Replace end-tag by expression value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
elem: <i>expr</i>; </b></dt>
<dd class="dd3">
	Replace elemnt by expression value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
cont: <i>expr</i>; </b></dt>
<dd class="dd3">
	Replace content of element by expressin value.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
value: <i>expr</i>; </b></dt>
<dd class="dd3">
	Equivarent to <code>cont: <i>expr</i></code>.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
attrs: 'attrname' <i>expr</i>; </b></dt>
<dd class="dd3">
	Replace attribute value by expression.
	The following is an example to specify some attributes.
<pre class="program">#foo {
  attrs:  'href'  item[:url],
	  'id'    item[:id],
          'class' classname;
}
</pre>
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
append: <i>expr</i>; </b></dt>
<dd class="dd3">
	Append expression value to tail of tag.
	This is used especially to add 'checked="checked"', 'selected="selected"'
	into the form control tag.
<pre class="program">#checkbox1 {
  append:  member[:age] &gt; 18 ? ' checked="checked"' : '';
}
#select_options {
  append:  option[:value] == current_val ? ' selected="selected"' : '';
}
</pre>
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
remove:  'attr1', 'attr2', 'attr3'; </b></dt>
<dd class="dd3">
	Remove the attributes from the element.
</dd>
</dl>
<dl class="dl3">
<dt class="dt3"><b>
logic: { ... } </b></dt>
<dd class="dd3">
	Logic of the element.
</dd>
</dl>
<p>'stag:' and 'elem:' are useful especially for Ruby on Rails.
The following is an examle to use Kwartz in Ruby on Rails.
</p>
<a name="form1.html"></a>
<div class="program_caption">
presentation data (form1.html)</div>
<pre class="program">&lt;form <b>id="form"</b>&gt;
  Name: &lt;input type="text" <b>id="member_name"</b>&gt;&lt;br&gt;
  Birthday: &lt;select <b>id="member_birth"</b>&gt;
              &lt;option&gt; - &lt;/option&gt;
            &lt;/select&gt;&lt;br&gt;
 &lt;input type="submit" <b>id="submit"</b>&gt;
&lt;/form&gt;
</pre>
<a name="form1.plogic"></a>
<div class="program_caption">
presentation logic (form1.plogic)</div>
<pre class="program"><b>#form</b> {
  <b>stag:</b>  start_form_tag :action=&gt;'new';
}
<b>#member_name</b> {
  <b>elem:</b>  text_field 'member', 'name';
}
<b>#member_birth</b> {
  <b>elem:</b>  date_select 'member', birth';
}
<b>#submit</b> {
  <b>elem:</b>  submit_to 'Submit';
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz -p form1.plogic form1.html
&lt;%= start_form_tag :action=&gt;'new' %&gt;
  Name: &lt;%= text_field 'member', 'name' %&gt;&lt;br&gt;
  Birthday: &lt;%= date_select 'member', birth' %&gt;&lt;br&gt;
 &lt;%= submit_to 'Submit' %&gt;
&lt;/form&gt;
</pre>
<br>


<a name="directives"></a>
<h3 class="section2">Directives</h3>
<p>Presentation logic may be embedded into presentation data in Kwartz.
You can choose to separate or not to sepearate presentation logic from presentation data.
</p>
<p>The reason to provide both solutions (separate or not) is <b>choosability</b>.
Some preferes to separate presentation logic from presentaion data, and others may
prefere to mix them.
Both approaches have own advantages and disadvantages.
Thus it is the user who determine which solution to adopt.
Kwartz provides both approaches and you can select which to use.
Kwartz doesn't enforce you to adopt a solution.
</p>
<p>To embed presentation logic into presentation data, use directives.
Directive is a command to embed presentation logic into presentation data.
In Kwartz, 'title'(<sup>(<a href="#fnref:4" name="fnlink:4">*4</a>)</sup>) attributes are used to describe directives.
</p>
<p>The following is an example to use directives.
</p>
<ul type="disc">
<li>Directive <code>title="for <i>var</i> in <i>list</i>"</code> means to iterate the element.
</li>
<li>Directive <code>title="value: <i>expression</i>"</code> means to print value of expression as content of the element.
</li>
<li>Directive <code>title="dummy:"</code> means that the element is a dummy and is not printed out.
</li>
</ul>
<a name="directive1.html"></a>
<div class="program_caption">
Presentation Data(directive1.html):</div>
<pre class="program">&lt;table&gt;
  &lt;tr <b>title="for member in @members"</b>&gt;
    &lt;td <b>title="value: member.name"</b>&gt;foo&lt;/td&gt;
    &lt;td&gt;
      &lt;a href="mailto:&lt;%= member.email %&gt;"
         title="<b>value: member.email</b>"&gt;foo@mai.com&lt;/a&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr <b>title="dummy:"</b>&gt;
    &lt;td&gt;bar&lt;/td&gt;
    &lt;td&gt;&lt;a href="mailto:bar@mail.org"&gt;bar@mail.org&lt;/a&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr <b>title="dummy:"</b>&gt;
    &lt;td&gt;baz&lt;/td&gt;
    &lt;td&gt;&lt;a href="mailto:baz@mail.net"&gt;baz@mail.net&lt;/a&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</pre>
<div class="terminal_caption">
Compile:</div>
<pre class="terminal">$ kwartz -l eruby  directive1.html &gt; directive1.rhtml
</pre>
<div class="program_caption">
Output script:</div>
<pre class="program">&lt;table&gt;
&lt;% for member in @members do %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= member.name %&gt;&lt;/td&gt;
    &lt;td&gt;
      &lt;a href="mailto:&lt;%= member.email %&gt;"&gt;&lt;%= member.email %&gt;&lt;/a&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
&lt;/table&gt;
</pre>
<p>If the first character of target attribute is a space, Kwartz recognize it as non-directive<sup>(<a href="#fnref:5" name="fnlink:5">*5</a>)</sup>.
</p>
<a name="directive2.html"></a>
<div class="program_caption">
presentation data (directive2.html)</div>
<pre class="program">&lt;span <b>title="value: expr"</b>&gt;foo&lt;/span&gt;
&lt;span <b>title=" value: expr"</b>&gt;bar&lt;/span&gt;
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz directive2.html
&lt;span&gt;&lt;%= expr %&gt;&lt;/span&gt;
&lt;span title="value: expr"&gt;bar&lt;/span&gt;
</pre>
<p>Directives are different in each target language.
For example, foreach loop is 'for item in list' in eRuby, 'foreach($list as $item)' in PHP, 'forEach(item in list)' in JSTL.
See reference manual for details about directives.
</p>
<div class="footnote">
 <dl compact>
  <dt>(<a name="fnref:4" href="#fnlink:4">*4</a>)</dt>
  <dd>It is able to change attribute name by command-line option '--dattr=name' or configuration option PROPRERTY_DATTR.</dd>
  <dt>(<a name="fnref:5" href="#fnlink:5">*5</a>)</dt>
  <dd>This spec may change in the future if I get have better idea.</dd>
 </dl>
</div>
<br>


<a name="escape"></a>
<h3 class="section2">Escape</h3>
<p>Kwartz supports Automatic-escape and Partial-escape/unescape.
</p>
<ul type="disc">
<li>If command-line option '<code>-e</code>' is specified,  values of '<code>value: <i>expr</i></code>'
   are escaped. (Automatic-escape)
</li>
<li>'<code>Value: <i>expr</i></code>' always escapes value even when '<code>-e</code>' is not specified. (Partial-escape)
</li>
<li>'<code>VALUE: <i>expr</i></code>' always doesn't escapes value even when '<code>-e</code>' is specified. (Partial-unescape)
</li>
</ul>
<a name="escape1.html"></a>
<div class="program_caption">
presentation Data (escape1.html):</div>
<pre class="program">&lt;tr&gt;
  &lt;td id="mark:val1"&gt;foo&lt;/td&gt;
  &lt;td id="mark:val2"&gt;bar&lt;/td&gt;
  &lt;td id="mark:val3"&gt;baz&lt;/td&gt;
&lt;/tr&gt;
</pre>
<a name="escape1.plogic"></a>
<div class="program_caption">
presentation logic (escape1.plogic)</div>
<pre class="program">#val1 {
  <b>value:</b> expr;
}
#val2 {
  <b>Value:</b> expr;
}
#val3 {
  <b>VALUE:</b> expr;
}
</pre>
<div class="terminal_caption">
compile without '<code>-e</code>' option.</div>
<pre class="terminal">$ kwartz -p escape1.plogic escape1.html
&lt;tr&gt;
  &lt;td&gt;&lt;%= expr %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;%=h expr %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;%= expr %&gt;&lt;/td&gt;
&lt;/tr&gt;
</pre>
<div class="terminal_caption">
comple with '<code>-e</code>' option.</div>
<pre class="terminal">$ kwartz <b>-e</b> -p escape1.plogic escape1.html
&lt;tr&gt;
  &lt;td&gt;&lt;%=h expr %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;%=h expr %&gt;&lt;/td&gt;
  &lt;td&gt;&lt;%= expr %&gt;&lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>In the same way, 'Stag:', 'Etag:', 'Elem:', 'Cont:', 'Attrs:', and 'Append:' part are
always escaped, 'STAG:', 'ETAG:', 'ELEM:', 'CONT:', 'ATTRS:', and 'APPEND:' part are never escaped.
</p>
<p>Escape function or method is different for each tareget language.
'h()' is used in eRuby and 'htmlspecialchars()' in PHP.
JSTL prints escaped value in default.
</p>
<p>Directives <code>title="Value: <i>expr</i>"</code>, <code>title="Attr: '<i>name</i>' <i>expr</i>"</code>, and <code>title="Append: <i>expr</i>"</code> always escape expression value even when the command-line option '<code>-e</code>' is not specified.
</p>
<p>Directives <code>title="VALUE: <i>expr</i>:"</code>, <code>title="ATTR: '<i>name</i>' <i>expr</i>"</code>, and <code>title="APPEND: <i>expr</i>"</code> doesn't escape expression value even when the command-line option '<code>-e</code>' is specified.
</p>
<p>Configuration option PROPERTY_ESCAPE in 'kwartz/config.rb' determines whether values are escaped or not in default.
If this is true then Kwartz will escape values in default.
</p>
<br>


<a name="langs"></a>
<h3 class="section2">Multi-language</h3>
<p>Kwartz-ruby now supports the following programming language.
</p>
<ul type="disc">
<li>Ruby (eRuby)
</li>
<li>PHP
</li>
<li>JSP (JSTL 1.1 and 1.2)
</li>
<li>Perl (ePerl) [experimental]
</li>
</ul>
<p>Presentation logics must be described in each target language.
It means that if you have wrote presentation logics in Ruby, they were not reusable
for PHP project (but you can get full-power of Ruby in presentation logic).
</p>
<p>The followings are examples of PHP and JSP.
</p>
<a name="table1.html"></a>
<div class="program_caption">
table1.html</div>
<pre class="program">&lt;html&gt;
  &lt;body&gt;
  
    &lt;table&gt;
      &lt;tr bgcolor="#CCCCFF" <b>id="mark:row"</b>&gt;
        &lt;td <b>id="mark:name"</b>&gt;Foo&lt;/td&gt;
        &lt;td <b>id="mark:mail"</b>&gt;foo@mail.com&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr bgcolor="#FFCCCC" <b>id="mark:dummy1"</b>&gt;
        &lt;td&gt;Bar&lt;/td&gt;
        &lt;td&gt;bar@mail.org&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;

 &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="table1.php.plogic"></a>
<div class="program_caption">
table1.php.plogic</div>
<pre class="program">#row {
  attrs:  "bgcolor" $color;
  logic: {
    $i = 0;
    foreach ($list as $item) {
      $color = ++$i % 2 == 0 ? '#FFCCCC' : '#CCCCFF';
      _elem();
    }
  }
}

#name {
  value:  $item['name'];
}

#mail {
  value:  $item['mail'];
}

#dummy1 {
  logic: { }   /* ignore this element */
}
</pre>
<a name="table1.jstl.plogic"></a>
<div class="program_caption">
table1.jstl.plogic</div>
<pre class="program">#row {
  attrs:  "bgcolor" color;
  logic: {
    &lt;c:forEach var="item" items="${list}" varStatus="loop"&gt;
      &lt;c:set var="color" value="${loop.index % 2 == 0 ? '#FFCCCC' : '#CCCCFF'}"/&gt;
      _elem
    &lt;/c:forEach&gt;
  }
}

#name {
  value:  item.name;
}

#mail {
  value:  item.mail;
}

#dummy1 {
  logic: { }   /* ignore this element */
}
</pre>
<div class="terminal_caption">
compile for PHP</div>
<pre class="terminal">$ kwartz -l php -p table1.php.plogic table1.html
&lt;html&gt;
  &lt;body&gt;
  
    &lt;table&gt;
&lt;?php     $i = 0; ?&gt;
&lt;?php     foreach ($list as $item) { ?&gt;
&lt;?php       $color = ++$i % 2 == 0 ? '#FFCCCC' : '#CCCCFF'; ?&gt;
      &lt;tr bgcolor="&lt;?php echo $color; ?&gt;"&gt;
        &lt;td&gt;&lt;?php echo $item['name']; ?&gt;&lt;/td&gt;
        &lt;td&gt;&lt;?php echo $item['mail']; ?&gt;&lt;/td&gt;
      &lt;/tr&gt;
&lt;?php     } ?&gt;
    &lt;/table&gt;

 &lt;/body&gt;
&lt;/html&gt;
</pre>
<div class="terminal_caption">
compile for JSTL(1.2)</div>
<pre class="terminal">$ kwartz -l jstl -p table1.jstl.plogic table1.html
&lt;%@ taglib prefix="c"  uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;html&gt;
  &lt;body&gt;
  
    &lt;table&gt;
    &lt;c:forEach var="item" items="${list}" varStatus="loop"&gt;
      &lt;c:set var="color" value="${loop.index % 2 == 0 ? '#FFCCCC' : '#CCCCFF'}"/&gt;
      &lt;tr bgcolor="${color}"&gt;
        &lt;td&gt;${item.name}&lt;/td&gt;
        &lt;td&gt;${item.mail}&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/c:forEach&gt;
    &lt;/table&gt;

 &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<br>


<a name="topics"></a>
<h2 class="section1">Other Topics</h2>
<a name="restriction1"></a>
<h3 class="section2">Restrictions around presentation logic</h3>
<p>There are several restrictions in presentation logic file.
</p>
<ul type="disc">
<li>Position in which comment '<code>/* ... */</code>' is available is limited.
   In the following example, 'value:' part will be error because
   string from 'expr;' to the end of comment is regared as argument of 'value:' part.
<pre class="program">   /* this comment is ok */
   #foo {
     /* this comment is ok */
     value:  expr;   /* this comment is NG! */
     logic: {        /* this comment will be Ruby syntax error! */
        for item in list    # ruby comment is OK in 'logic:' part
	  _stag
	  _cont
	  _etag
	end
     }
   }
</pre>
</li>
</ul>
<ul type="disc">
<li>'_stag', '_cont', '_etag', '_elem', '_element()', and '_content()' must be placed
   one in per line, because Kwartz-ruby scans 'logic:' part with regular expression
   pattern such as '/^\s*_(stag|cont|etag|element|content)(\(.*\))\s*$/' or so.
<pre class="program">   #foo {
     logic: {
       # OK
       if x &gt; 0
         _elem
       end

       # NG (parse failed)
       _elem if x &gt; 0
     }
   }
</pre>
</li>
</ul>
<ul type="disc">
<li>The number of '{' and '}' must be equal in 'logic:' part.
<pre class="program">#foo {
  logic: {
    str = "{"         # this will be parse error 
    _elem
  }
}
#bar {
  logic: {
    str = "{"         # add dummy '}' in comment!
    _elem
  }
}
</pre>
</li>
</ul>
<ul type="disc">
<li>'@import "file.plogic"' should be at the beginning of presentation logic file.
<pre class="program">   /* OK */
   @import 'file1.plogic';
   
   #foo {
   }

   /* NG */
   @import 'file2.plogic';
</pre>
</li>
</ul>
<br>


<a name="restriction2"></a>
<h3 class="section2">Restrictions around presentation data</h3>
<p>Kwartz parses presentation data file by regular expression pattern matching.
It means that Kwartz doesn't use HTML parser nor XML parser for parsing presentation data.
This approach enables Kwartz to handle any type of text file, and also brings the following restrictions to Kwartz.
</p>
<ul type="disc">
<li>Cannot omit end tag if id attribute is specified.
<pre class="program">&lt;!-- Kwartz cannot parse the following because &lt;/li&gt; is omitted. --&gt;
&lt;ul&gt;
 &lt;li id="foo"&gt;foo
&lt;/ul&gt;
</pre>
   An Element which doesn't have any content is to be written as an empty tag such as <code>&lt;foo id="..."/&gt;</code>.
</li>
</ul>
<ul type="disc">
<li>However, <code>&lt;input&gt;</code>, <code>&lt;br&gt;</code>, <code>&lt;meta&gt;</code>, <code>&lt;img&gt;</code>, and <code>&lt;hr&gt;</code> are allowed to omit end tag.
   And these doesn't have to be written as an empty tag.
<pre class="program">&lt;!-- &lt;/input/&gt; is omitted but Kwartz can parse correctly. --&gt;
&lt;input type="text" name="user" id="user"&gt;
</pre>
   Configuration option PROPERTY_NOEND lists these tag names in file 'kwartz/config.rb'.
   Upper-case and lower-case are distinguished.
</li>
</ul>
<ul type="disc">
<li>Attribute values should be surrounded with '<code>"</code>'.
<pre class="program">&lt;!-- Kwartz fails parsing because attribute value is not surrounded with '"'. --&gt;
&lt;h1 id="value:title" class=title&gt;title&lt;/h1&gt;
</pre>
</li>
</ul>
<br>


<a name="span"></a>
<h3 class="section2">Span Tag Deletion</h3>
<p>Kwartz regards span tags which contain only directives as dummy tags and delete them automatically when command-line option '--delspan' is specified.
</p>
<a name="delspan1.html"></a>
<div class="program_caption">
presentation data (delspan1.html)</div>
<pre class="program">&lt;h1&gt;&lt;span <b>id="mark:title"</b>&gt;title&lt;/span&gt;&lt;/h1&gt;

Hello &lt;span <b>title="value: user"</b>&gt;World&lt;/span&gt;!
</pre>
<a name="delspan1.plogic"></a>
<div class="program_caption">
presentation logic (delspan1.plogic)</div>
<pre class="program">#title {
  value: title;
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz -p delspan1.plogic <b>--delspan</b> delspan1.html
&lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;

Hello &lt;%= user %&gt;!
</pre>
<p>The span tags are not removed when they have other attributes.
</p>
<a name="delspan2.html"></a>
<div class="program_caption">
presentation data (delspan2.html)</div>
<pre class="program">&lt;h1&gt;&lt;span <b>id="mark:title"</b>&gt;title&lt;/span&gt;&lt;/h1&gt;

Hello &lt;span <b>title="value: user" style="color:black"</b>&gt;World&lt;/span&gt;!
</pre>
<a name="delspan2.plogic"></a>
<div class="program_caption">
presentation logic (delspan2.plogic)</div>
<pre class="program">#title {
  value: title;
  attrs: "class" doctitle;
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz -p delspan2.plogic <b>--delspan</b> delspan2.html
&lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;

Hello &lt;span style="color:black"&gt;&lt;%= user %&gt;&lt;/span&gt;!
</pre>
<br>


<a name="start_link_to"></a>
<h3 class="section2"><code>link_to()</code> method in Ruby on Rails</h3>
<p><code>link_to()</code> method in Ruby on Rails is a little incompatible with Kwartz
because you must specify link label in both presentation data and presentation logic.
This is not DRY.
</p>
<div class="program_caption">
presentation data</div>
<pre class="program">&lt;a href="#" id="mark:link_to_new"&gt;<b>Create new recipe</b>&lt;/a&gt;
</pre>
<div class="program_caption">
presentation logic</div>
<pre class="program">#link_to_new {
  elem:  link_to <b>'Create new recipe'</b>, :action=&gt;'new';
}
</pre>
<p>It is recommended to include the following helper method
in your 'app/helpers/application_helper.rb'.
</p>
<pre class="program">module ApplicationHelper

  def start_link_to(options = {}, html_options = nil, *parameters_for_method_reference)
    s = link_to('', options, html_options, *parameters_for_method_reference)
    s.sub!(/&lt;\/a&gt;\z/, '')
  end
  alias anchor start_link_to

  def start_link_to_remote(options = {}, html_options = {})
    s = link_to_remote(options, html_options)
    s.sub!(/&lt;\/a&gt;\z/, '')
  end
  alias anchor_remote start_link_to_remote

end
</pre>
<p>The above methods prints only start tag. You don't need to write label twice.
</p>
<div class="program_caption">
presentation data</div>
<pre class="program">&lt;a href="#" id="mark:link_to_new"&gt;Create new recipe&lt;/a&gt;
</pre>
<div class="program_caption">
presentation logic</div>
<pre class="program">#link_to_new {
  stag:  <b>start_link_to</b> :action=&gt;'new';
}
</pre>
<br>


<a name="import-plogic"></a>
<h3 class="section2">Import Presentation Logic File</h3>
<p>'@imort "filename.plogic"' imports filename.plogic.
This is useful to share common presentation logic in many files.
</p>
<a name="link_to2.plogic"></a>
<div class="program_caption">
link_to.plogic</div>
<pre class="program"><b>#link_to_new</b> {
  elem:  start_link_to :action=&gt;'new';
}
<b>#link_to_show</b> {
  elem:  start_link_to :action=&gt;'show', :id=&gt;@member;
}
<b>#link_to_edit</b> {
  elem:  start_link_to :action=&gt;'edit', :id=&gt;@member;
}
<b>#link_to_list</b> {
  elem:  start_link_to :action=&gt;'list';
}
<b>#link_to_destroy</b> {
  stag:  start_link_to({:action=&gt;'destroy', :id=&gt;@member}, :confirm=&gt;'Are you sure?');
}
</pre>
<a name="show2.html"></a>
<div class="program_caption">
show.html</div>
<pre class="program">&lt;p&gt;
 Name: &lt;span id="mark:name"&gt;foo&lt;/span&gt; &lt;br&gt;
 Email: &lt;span id="mark:email"&gt;foo@mail.com&lt;/span&gt; &lt;br&gt;
&lt;/p&gt;
&lt;a href="#" <b>id="link_to_edit"</b>&gt;Edit this member&lt;/a&gt; |
&lt;a href="#" <b>id="link_to_new"</b>&gt;Create new member&lt;/a&gt; |
&lt;a href="#" <b>id="link_to_list"</b>&gt;Return to list&lt;/a&gt;
</pre>
<div class="program_caption">
show.plogic</div>
<pre class="program"><b>@import 'link_to.plogic';</b>

#name {
  Value: @member.name;
}
#email {
  Value: @member.email;
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz -p show.plogic show.html
&lt;p&gt;
 Name: &lt;span&gt;&lt;%=h @member.name %&gt;&lt;/span&gt; &lt;br&gt;
 Email: &lt;span&gt;&lt;%=h @member.email %&gt;&lt;/span&gt; &lt;br&gt;
&lt;/p&gt;
&lt;%= start_link_to :action=&gt;'edit', :id=&gt;@member %&gt; |
&lt;%= start_link_to :action=&gt;'new' %&gt; |
&lt;%= start_link_to :action=&gt;'list' %&gt;
</pre>
<br>


<a name="import-elem"></a>
<h3 class="section2">Import Elements in Other Files</h3>
<p>Command-line option '-i <i>filename,...</i>' imports element definitions form other files.
</p>
<a name="form.html"></a>
<div class="program_caption">
form.html</div>
<pre class="program">&lt;form&gt;
 &lt;div <b>id="mark:form_content"</b>&gt;
  Name: &lt;input type="text"&gt;&lt;br&gt;
  Password: &lt;input type="password"&gt;&lt;br&gt;
 &lt;/div&gt;
 &lt;input type="submit"&gt;
&lt;/form&gt;
</pre>
<a name="new.html"></a>
<div class="program_caption">
new.html</div>
<pre class="program">&lt;form action="/new"&gt;
  &lt;div <b>id="mark:replace_element_with"</b>&gt;&lt;/div&gt;
  &lt;input type="submit" value="Create"&gt;
&lt;/form&gt;
</pre>
<a name="new.plogic"></a>
<div class="program_caption">
new.plogic</div>
<pre class="program">/* use element which is defined other file */
<b>#replace_element_with</b> {
  logic: {
    <b>_content(form_content)</b>
  }
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz <b>-i form.html</b> -p new.plogic new.html
&lt;form action="/new"&gt;
  Name: &lt;input type="text"&gt;&lt;br&gt;
  Password: &lt;input type="password"&gt;&lt;br&gt;
  &lt;input type="submit" value="Create"&gt;
&lt;/form&gt;
</pre>
<br>


<a name="extract"></a>
<h3 class="section2">Extract Element</h3>
<p>Command option '-X <i>name</i>' extracts element marked as <i>name</i>
and command option '-x <i>name</i>' extracts content of element.
</p>
<a name="show.html"></a>
<div class="program_caption">
show.html</div>
<pre class="program">&lt;html&gt;
 &lt;body&gt;
  &lt;div <b>id="mark:content"</b>&gt;
   &lt;h1&gt;Show&lt;/h1&gt;
   &lt;p&gt;Name: &lt;span id="mark:name"&gt;foo&lt;/span&gt;&lt;/p&gt;
   &lt;p&gt;Email: &lt;span id="mark:email"&gt;foo@mail.com&lt;/span&gt;&lt;/p&gt;
  &lt;/div&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="show.plogic"></a>
<div class="program_caption">
show.plogic</div>
<pre class="program">#name {
  value: user.name;
}
#email {
  value: user.email;
}
</pre>
<div class="terminal_caption">
compile with '-X' or '-x'</div>
<pre class="terminal">$ kwartz <b>-X content</b> -p show.plogic show.html
  &lt;div&gt;
   &lt;h1&gt;Show&lt;/h1&gt;
   &lt;p&gt;Name: &lt;span&gt;&lt;%= user.name %&gt;&lt;/span&gt;&lt;/p&gt;
   &lt;p&gt;Email: &lt;span&gt;&lt;%= user.email %&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;/div&gt;

$ kwartz <b>-x content</b> -p show.plogic show.html
   &lt;h1&gt;Show&lt;/h1&gt;
   &lt;p&gt;Name: &lt;span&gt;&lt;%= user.name %&gt;&lt;/span&gt;&lt;/p&gt;
   &lt;p&gt;Email: &lt;span&gt;&lt;%= user.email %&gt;&lt;/span&gt;&lt;/p&gt;
</pre>
<br>


<a name="print-statement"></a>
<h3 class="section2">Print Statement</h3>
<p>Print statement is available in 'logic:' part.
</p>
<a name="print-stmt.html"></a>
<div class="program_caption">
print-stmt.html</div>
<pre class="program">&lt;ul&gt;
  &lt;li id="items"&gt;foo&lt;/li&gt;
&lt;/ul&gt;
</pre>
<a name="print-stmt.eruby.plogic"></a>
<div class="program_caption">
print-stmt.eruby.plogic</div>
<pre class="program">#items {
  logic: {
    for item in list
      _stag
      <b>print item</b>
      _etag
    end
  }
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz -l eruby -p print-stmt.eruby.plogic print-stmt.html
&lt;ul&gt;
&lt;%     for item in list %&gt;
  &lt;li id="items"&gt;&lt;%= item %&gt;&lt;/li&gt;
&lt;%     end %&gt;
&lt;/ul&gt;
</pre>
<a name="print-stmt.php.plogic"></a>
<div class="program_caption">
print-stmt.php.plogic</div>
<pre class="program">#items {
  logic: {
    foreach ($list as $item) {
      _stag();
      <b>print($item);</b>
      _etag();
    }
  }
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz -l php -p print-stmt.php.plogic print-stmt.html
&lt;ul&gt;
&lt;?php     foreach ($list as $item) { ?&gt;
  &lt;li id="items"&gt;&lt;?php echo $item; ?&gt;&lt;/li&gt;
&lt;?php     } ?&gt;
&lt;/ul&gt;
</pre>
<a name="print-stmt.jstl.plogic"></a>
<div class="program_caption">
print-stmt.jstl.plogic</div>
<pre class="program">#items {
  logic: {
    &lt;c:forEach var="item" items="${list}"&gt;
      _stag
      <b>print item</b>
      _etag
    &lt;/c:forEach&gt;
  }
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz -l jstl -p print-stmt.jstl.plogic print-stmt.html
&lt;%@ taglib prefix="c"  uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;ul&gt;
    &lt;c:forEach var="item" items="${list}"&gt;
  &lt;li id="items"&gt;${item}&lt;/li&gt;
    &lt;/c:forEach&gt;
&lt;/ul&gt;

$ kwartz -l jstl -p print-stmt.jstl.plogic --jstl=1.1 print-stmt.html
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;
&lt;ul&gt;
    &lt;c:forEach var="item" items="${list}"&gt;
  &lt;li id="items"&gt;&lt;c:out value="${item}"/&gt;&lt;/li&gt;
    &lt;/c:forEach&gt;
&lt;/ul&gt;
</pre>
<p>It is recommended to use 'elem:', 'stag:', 'etag:', 'cont:', or 'value:' instead of
print statement because they can escape or unescape exression value.
</p>
<br>


<a name="Add Code Before/After Document"></a>
<h3 class="section2">Add Code Before/After Document</h3>
<p>There is a special keyword '#DOCUMENT' which means document.
In '#DOCUMENT', 'before:' and 'after:' are available to add codes before/after document.
</p>
<a name="document-test.html"></a>
<div class="program_caption">
document-test.html</div>
<pre class="program">&lt;html&gt;
 &lt;body&gt;hello&lt;/body&gt;
&lt;/html&gt;
</pre>
<a name="document-test.plogic"></a>
<div class="program_caption">
document-test.plogic</div>
<pre class="program"><b>#DOCUMENT</b> {
  <b>before:</b> {
    title = _context[:title]
    user  = _context[:user]
  }
  <b>after:</b> {
    print "&lt;!--end--&gt;\n"
  }
}
</pre>
<div class="terminal_caption">
compile</div>
<pre class="terminal">$ kwartz -p document-test.plogic document-test.html
&lt;%     title = _context[:title] %&gt;
&lt;%     user  = _context[:user] %&gt;
&lt;html&gt;
 &lt;body&gt;hello&lt;/body&gt;
&lt;/html&gt;
&lt;%= "&lt;!--end--&gt;\n" %&gt;</pre>
<br>


<br>



   </div>
  </blockquote>

 </body>
</html>
