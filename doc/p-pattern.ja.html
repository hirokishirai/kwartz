<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
  <title>プレゼンテーションパターン・カタログ</title>
  <meta name="author" content="Makoto Kuwata &lt;kwa(at)kuwata-lab.com&gt;">
  <meta name="generator" content="kwaser">
  <meta http-equiv="Content-Style-Type" content="text/css">

  <style type="text/css">
   <!--

body		{
		background-color:#FFFFFF;
		}
.mainbody	{
		color:#333333;
		line-height:150%;
		}

a:link, a:active, a:hover {
		color:#CC6600;
		}
a:visited	{
		color:#DD9900;
		}

p		{
		color:#333333;
		line-height:150%;
		}

pre		{
		width: 100%;
		line-height:130%;
		white-space:pre;
		}
.program	{
		border-style:solid;
		border-width:2;
		border-color:#6699FF;
		color:#333333;
		background-color:#DDEEFF;
		padding:8 9 8 9;
		margin:0;
		word-break:keep-all;
		}
.terminal	{
		border-style:solid;
		border-width:1;
		border-color:#FFFFFF;
		color:#333333;
		background-color:#E0E0E0;
		padding:9 10 9 10;
		margin:0;
		word-break:keep-all;
		}
.output		{
		border-style:solid;
		border-width:2;
		border-color:#CCCCCC;
		color:#333333;
		background-color:#FFFFFF;
		padding:8 9 8 9;
		margin:0;
		word-break:keep-all;
		}
.program_caption {
		}
.terminal_caption {
		}
.output_caption {
		}


ul,ol,dl	{
	 	Xmargin:0px;
		Xpadding:0px;
		color:#333333;
		line-height:130%;
		}

.dt2, .dt3	{
		font-weight:bold;
		}

.table1		{
		padding:2;
		color:#333333;
		background-color:#DDDDCC;
		line-height:130%;
		Xborder-width:1;
		Xborder-style:solid;
		Xborder-color:#FFFFFF;
		margin:5;
		}
.th1, .th2	{
		padding:1;
		color:#333333;
		Xbackground-color:#DDDDCC;
		background-color:#CCCCBB;
		line-height:130%;
		}
.td1, .th2	{
		padding:1;
		color:#333333;
		background-color:#EEEEDD;
		line-height:130%;
		}
.caption1, .caption2 {
		Xfont-size:x-small;
		color:#333333;
		}
.table2		{
		padding:1;
		color:#333333;
		background-color:#DDDDCC;
		line-height:130%;
		Xborder-width:1;
		Xborder-style:solid;
		Xborder-color:#FFFFFF;
		margin:5;
		}

h1, .chapter, .doctitle {
	  	Xfont-size:20pt;
		color:#333333;
	 	font-weight:bold;
		padding:30 0 10 0;
		}
h2, .section	{
		Xfont-size:16pt;
		color:#333333;
		font-weight:bold;
		border-style:solid;
		border-color:#6699FF;
		border-width:0 0 2 30;
		padding:10 20 0 5;
		}
h3, .subsection	{
		Xfont-size:12pt;
		color:#333333;
		font-weight:bold;
		border-style:solid;
		border-color:#6699FF;
		border-width: 0 0 0 15;
		padding: 10 20 0 5;
		}

.em		{
		font-weight:bold;
		}

.toc		{
		font-size:small;
		line-height:100%;
		}
.footnote	{
		font-size:small;
		}
.note		{
		background-color:#FFFFDD;
		border-style:solid;
		border-width:0 1 0 1;
		border-color:#DDDD66;
		color:#333300;
		Xfont-size:small;
		line-height:120%;
		padding: 5 20 5 20;
		}
.figure		{
		Xborder-width:1;
		Xborder-color:#DDDD66;
		Xwhite-space:pre;
		}

   -->
  </style>

 </head>
 <body>

  <blockquote>
   <div class="mainbody">
    <div align="left"><h1>プレゼンテーションパターン・カタログ</h1></div>

    <div align="left">
      Makoto Kuwata &lt;kwa(at)kuwata-lab.com&gt;<br>
      last update: $Date$<br>
    </div>

<a name="preface"></a>
<h2 class="section1">はじめに</h2>
<p>Kwartzは、<b>「プレゼンテーションロジックとプレゼンテーションデータの分離」</b>という概念を実現したテンプレートシステムです。
プレゼンテーションロジックとプレゼンテーションデータを分離すると、HTMLデザインをまったく崩すことなく、複雑なプレゼンテーションロジックを利用することができます。
</p>
<p>またプレゼンテーションデータとプレゼンテーションロジックとをうまく分離するための、いくつかのパターンが存在します。
これらのパターンを「プレゼンテーションパターン」といいます。
</p>
<p>このドキュメントでは、プレゼンテーションパターンをいくつか紹介します。
</p>
<a name="toc"></a>
<h3 class="section2">目次</h3>
<ul>
  <li><a href="#preface">はじめに</a>
  <ul>
    <li><a href="#toc">目次</a>
    </li>
    <li><a href="#changelog">更新履歴</a>
    </li>
  </ul>
  </li>
  <li><a href="#replacement">置換</a>
  <ul>
    <li><a href="#replace-elem-by-value">Replace Element by Valueパターン</a>
    </li>
    <li><a href="#replace-cont-by-value">Replace Content by Valueパターン</a>
    </li>
    <li><a href="#replace-elem-by-elem">Replace Element by Elementパターン</a>
    </li>
    <li><a href="#replace-cont-by-elem">Replace Content by Elementパターン</a>
    </li>
  </ul>
  </li>
  <li><a href="#dummy">ダミー</a>
  <ul>
    <li><a href="#dummy-elem">Dummy Elementパターン</a>
    </li>
    <li><a href="#dummy-tag">Dummy Tagパターン</a>
    </li>
  </ul>
  </li>
  <li><a href="#iteration">繰り返し</a>
  <ul>
    <li><a href="#iterate-elem">Iterate Elementパターン</a>
    </li>
    <li><a href="#iterate-cont">Iterate Contentパターン</a>
    </li>
  </ul>
  </li>
  <li><a href="#selection">選択</a>
  <ul>
    <li><a href="#select-elem">Select Elementパターン</a>
    </li>
    <li><a href="#pickup-elem">Pick-up Elementパターン</a>
    </li>
    <li><a href="#extract-elem">Extract Elementパターン</a>
    </li>
  </ul>
  </li>
</ul>
<br>


<a name="changelog"></a>
<h3 class="section2">更新履歴</h3>
<dl class="dl1">
<dt class="dt1">
2005-02-14</dt>
<dd class="dd1">
	<ul type="circle">
	<li>beta release
	</li>
	</ul>
</dd>
</dl>
<br>


<br>


<a name="replacement"></a>
<h2 class="section1">置換</h2>
<a name="replace-elem-by-value"></a>
<h3 class="section2">Replace Element by Valueパターン</h3>
<p>エレメントを、変数や式の値で置き換えることができます。
これを「Replace Element by Value」パターンといいます。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="teq-replace2.pdata"></a>
<pre class="program">Hello &lt;span <b>id="mark:user"</b>&gt;World&lt;/span&gt;!
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="teq-replace2.plogic"></a>
<pre class="program">#user {
  plogic: {
    <b>print(username);</b>  // エレメントのかわりに変数usernameを出力する
  }
}
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
Hello&lt;%= username %&gt;!

### for PHP
Hello&lt;?php echo $username; ?&gt;!

### for JSTL
Hello&lt;c:out value="${username}" escapeXml="false"/&gt;!
</pre>
<br>


<a name="replace-cont-by-value"></a>
<h3 class="section2">Replace Content by Valueパターン</h3>
<p>タグは残したままエレメントの内容だけを式の値で置き換えることができます。
これを「Replace Content by Value」パターンといいます。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="teq-replace1.pdata"></a>
<pre class="program">&lt;h1 <b>id="mark:title"</b>&gt;Example&lt;/h1&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="teq-replace1.plogic"></a>
<pre class="program">#title {
  plogic: {
    @stag;
    <b>print(title);</b>  // 内容(@cont)のかわりに変数titleの値を出力する
    @etag;
  }
}
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
&lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;

### for PHP
&lt;h1&gt;&lt;?php echo $title; ?&gt;&lt;/h1&gt;

### for JSTL
&lt;h1&gt;&lt;c:out value="${title}" escapeXml="false"/&gt;&lt;/h1&gt;
</pre>
<p>なお「Replace Content by Value」パターンは、Kwartzでは次のように書くことができます。
</p>
<p>プレゼンテーションロジック：
</p>
<pre class="program">#title {
  <b>value: title;</b>  // 内容のかわりに変数titleの値を出力する
}
</pre>
<br>


<a name="replace-elem-by-elem"></a>
<h3 class="section2">Replace Element by Elementパターン</h3>
<p>エレメントを別のエレメントに交換することができます。
これは「Replace Element by Element」パターンといいます。
</p>
<p>このパターンは、ある場所で定義したエレメントを別の場所で再使用するのに便利です。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="replace-elem-by-elem.pdata"></a>
<pre class="program">&lt;div <b>id="mark:links"</b>&gt;
 &lt;a href="/"&gt;HOME&lt;/a&gt; | &lt;a href="/doc"&gt;Document&lt;/a&gt; | &lt;a href="/faq"&gt;FAQ&lt;/a&gt;
&lt;/div&gt;

&lt;p&gt;Welcome to my Home Page!&lt;/p&gt;

&lt;div <b>id="mark:links2"</b>&gt;
  Home | Document | FAQ
&lt;/div&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="replace-elem-by-elem.plogic"></a>
<pre class="program">#links2 {
  plogic: {
    <b>@element(links);</b>  // エレメントlins2をエレメントlinksで置き換える
  }
}
</pre>
<p>ここで「<code>@element(<i>name</i>)</code>」は、「<code>id="mark:<i>name</i>"</code>」や「<code>id="<i>name</i>"</code>」でマーキングされたエレメントを表しています。
</p>
<p>出力用スクリプト：
</p>
<pre class="program">&lt;div&gt;
 &lt;a href="/"&gt;HOME&lt;/a&gt; | &lt;a href="/doc"&gt;Document&lt;/a&gt; | &lt;a href="/faq"&gt;FAQ&lt;/a&gt;
&lt;/div&gt;

&lt;p&gt;Welcome to my Home Page!&lt;/p&gt;

&lt;div&gt;
 &lt;a href="/"&gt;HOME&lt;/a&gt; | &lt;a href="/doc"&gt;Document&lt;/a&gt; | &lt;a href="/faq"&gt;FAQ&lt;/a&gt;
&lt;/div&gt;
</pre>
<p>Kwartzにおいて、コマンドラインオプション「<code>-o <i>file</i>,<i>file2</i>,...</code>」を指定すると、
他のファイルのエレメントを利用できます。
</p>
<p>プレゼンテーションデータ(links.html)：
</p>
<a name="links.html"></a>
<pre class="program">&lt;div <b>id="mark:links"</b>&gt;
 &lt;a href="/"&gt;HOME&lt;/a&gt; | &lt;a href="/doc"&gt;Document&lt;/a&gt; | &lt;a href="/faq"&gt;FAQ&lt;/a&gt;
&lt;/div&gt;
</pre>
<p>プレゼンテーションデータ(page.html)：
</p>
<a name="page.html"></a>
<pre class="program">&lt;div <b>id="mark:links1"</b>&gt; Home | Document | FAQ &lt;/div&gt;

&lt;p&gt;Welcome to my Home Page!&lt;/p&gt;

&lt;div <b>id="mark:links2"</b>&gt; Home | Document | FAQ &lt;/div&gt;
</pre>
<p>プレゼンテーションロジック(page.plogic)：
</p>
<a name="page.plogic"></a>
<pre class="program">#links1 {
  plogic: {
    <b>@element(links);</b>
  }
}
#links2 {
  plogic: {
    <b>@element(links);</b>
  }
}
</pre>
<p>コンパイル：
</p>
<pre class="terminal">$ kwartz -l eruby <b>-o links.html</b> -p page.plogic page.html
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">&lt;div&gt;
 &lt;a href="/"&gt;HOME&lt;/a&gt; | &lt;a href="/doc"&gt;Document&lt;/a&gt; | &lt;a href="/faq"&gt;FAQ&lt;/a&gt;
&lt;/div&gt;

&lt;p&gt;Welcome to my Home Page!&lt;/p&gt;

&lt;div&gt;
 &lt;a href="/"&gt;HOME&lt;/a&gt; | &lt;a href="/doc"&gt;Document&lt;/a&gt; | &lt;a href="/faq"&gt;FAQ&lt;/a&gt;
&lt;/div&gt;
</pre>
<br>


<a name="replace-cont-by-elem"></a>
<h3 class="section2">Replace Content by Elementパターン</h3>
<p>エレメントの内容を、別のエレメントで置き換えることができます。
これは「Replace Content by Element」パターンといいます。
</p>
<p>このパターンは、他のファイルでマーキングされたエレメントを取り込むときに使用されます。
</p>
<p>プレゼンテーションデータ(contents.html)：
</p>
<a name="contents.html"></a>
<pre class="program">&lt;html&gt;
  &lt;body&gt;
    
    &lt;p&gt;menu:&lt;/p&gt;
    &lt;ul <b>id="mark:menu"</b>&gt;
      &lt;li&gt;&lt;a href="..." <b>id="mark:menu_item"</b>&gt;menu1&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;article:&lt;/p&gt;
    &lt;div <b>id="mark:article"</b>&gt;
      &lt;h2&gt;What is Kwartz?&lt;/h2&gt;
      &lt;p&gt;Kwartz is a template system, which realized the
         concept &lt;strong&gt;`Separation of Presentation Logic
         and Presentation Data'(SoPL/PD)&lt;/strong&gt;.
      &lt;/p&gt;
    &lt;/div&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>プレゼンテーションロジック(contents.plogic)：
</p>
<a name="contents.plogic"></a>
<pre class="program">#menu {
  plogic: {
    @stag;
    foreach (item in menu_list) {
      @cont;
    }
    @etag;
  }
}

#menu_item {
  value: item['name'];
  attr:  "href" item['url'];
}
</pre>
<p>プレゼンテーションデータ(layout.html)：
</p>
<a name="layout.html"></a>
<pre class="program">&lt;!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title id="value:title"&gt;...title...&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
    &lt;link rel="stylesheet" type="text/css" href="design.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;table border="0"&gt;
      &lt;tr&gt;
        
        &lt;!-- menu part --&gt;
        &lt;td width="100" valign="top"&gt;
          &lt;div class="menu" <b>id="mark:placeholder_menu"</b>&gt;
            &lt;ul&gt;
              &lt;li&gt;menu1&lt;/li&gt;
              &lt;li&gt;menu2&lt;/li&gt;
              &lt;li&gt;menu3&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/div&gt;
        &lt;/td&gt;
        
        &lt;!-- article part --&gt;
        &lt;td width="400" valign="top"&gt;
          &lt;div class="article" <b>id="mark:placeholder_article"</b>&gt;
            aaa&lt;br&gt;
            bbb&lt;br&gt;
            ccc&lt;br&gt;
            ddd&lt;br&gt;
          &lt;/div&gt;
        &lt;/td&gt;
        
      &lt;/tr&gt;

      &lt;!-- footer part --&gt;
      &lt;tr&gt;
        &lt;td colspan="2" class="copyright"&gt;
          copyright&amp;copy; 2004-2005 kuwata-lab.com All Rights Reserverd
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>プレゼンテーションロジック(layout.plogic)：
</p>
<a name="layout.plogic"></a>
<pre class="program">#placeholder_menu {
  plogic: {
    @stag;
    <b>@element(menu);</b>   // 内容を別のエレメントで置き換える
    @etag;
 }
}

#placeholder_article {
  plogic: {
    @stag;
    <b>@element(article);</b>   // 内容を別のエレメントで置き換える
    @etag;
  }
}
</pre>
<p>Kwartzではコマンドオプション「<code>-o <i>file1,file2,...</i></code>」を指定することで、
他のファイルのエレメントを読み込むことができます。
</p>
<p>コンパイル：
</p>
<pre class="terminal">$ kwartz -l eruby  <b>-o contents.html</b> -p contens.plogic,layout.plogic layout.html
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">&lt;!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
    &lt;link rel="stylesheet" type="text/css" href="design.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;table border="0"&gt;
      &lt;tr&gt;
        
        &lt;!-- menu part --&gt;
        &lt;td width="100" valign="top"&gt;
          &lt;div class="menu"&gt;
    &lt;ul&gt;
&lt;% for item in menu_list do %&gt;
      &lt;li&gt;&lt;a href="&lt;%= item["url"] %&gt;"&gt;&lt;%= item["name"] %&gt;&lt;/a&gt;&lt;/li&gt;
&lt;% end %&gt;
    &lt;/ul&gt;
          &lt;/div&gt;
        &lt;/td&gt;
        
        &lt;!-- article part --&gt;
        &lt;td width="400" valign="top"&gt;
          &lt;div class="article"&gt;
    &lt;div&gt;
      &lt;h2&gt;What is Kwartz?&lt;/h2&gt;
      &lt;p&gt;Kwartz is a template system, which realized the
         concept &lt;strong&gt;`Separation of Presentation Logic
         and Presentation Data'(SoPL/PD)&lt;/strong&gt;.
      &lt;/p&gt;
    &lt;/div&gt;
          &lt;/div&gt;
        &lt;/td&gt;
        
      &lt;/tr&gt;

      &lt;!-- footer part --&gt;
      &lt;tr&gt;
        &lt;td colspan="2" class="copyright"&gt;
          copyright&amp;copy; 2004-2005 kuwata-lab.com All Rights Reserverd
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<br>


<br>


<a name="dummy"></a>
<h2 class="section1">ダミー</h2>
<a name="dummy-elem"></a>
<h3 class="section2">Dummy Elementパターン</h3>
<p>プレゼンテーションロジックの定義を空欄にすると、エレメント全体を出力しないことになります。
これは「Dummy Element」パターンといいます。
</p>
<p>このパターンは、プレゼンテーションデータにダミーデータを含めるときに使用します。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="dummy-elem.pdata"></a>
<pre class="program">&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
  &lt;li <b>id="dummy"</b>&gt;bar&lt;/li&gt;
&lt;/ul&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="dummy-elem.plogic"></a>
<pre class="program">#dummy {
  plogic: {
    // empty
  }
}
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;

### for PHP
&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;

### for JSTL
&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
&lt;/ul&gt;
</pre>
<br>


<a name="dummy-tag"></a>
<h3 class="section2">Dummy Tagパターン</h3>
<p>プレゼンテーションロジックの定義において、「<code>@cont</code>」だけを使用し、
「<code>@stag</code>」と「<code>@stag</code>」を使わないようにすると、エレメントのタグを削除できます。
これは「Dummy Tag」パターンといいます。
</p>
<p>このパターンは、ある条件のときだけタグを出力したい場合に使います。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="dummy-tag.pdata"></a>
<pre class="program">&lt;a href="@{url}@" <b>id="mark:next"</b>&gt;Next&lt;/a&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="dummy-tag.plogic"></a>
<pre class="program">#next {
  plogic: {
    if (url == null) {
      <b>@cont;</b>   // タグを出力しない
    } else {
      @stag;
      @cont;
      @etag;
    }
  }
}
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
&lt;% if url == nil then %&gt;
Next&lt;% else %&gt;
&lt;a href="&lt;%= url %&gt;"&gt;Next&lt;/a&gt;
&lt;% end %&gt;

### for PHP
&lt;?php if ($url == NULL) { ?&gt;
Next&lt;?php } else { ?&gt;
&lt;a href="&lt;?php echo $url; ?&gt;"&gt;Next&lt;/a&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:choose&gt;&lt;c:when test="${url eq null}"&gt;
Next&lt;/c:when&gt;&lt;c:otherwise&gt;
&lt;a href="&lt;c:out value="${url}" escapeXml="false"/&gt;"&gt;Next&lt;/a&gt;
&lt;/c:otherwise&gt;&lt;/c:choose&gt;
</pre>
<br>


<br>


<a name="iteration"></a>
<h2 class="section1">繰り返し</h2>
<a name="iterate-elem"></a>
<h3 class="section2">Iterate Elementパターン</h3>
<p>繰り返しの中に「<code>@stag</code>」と「<code>@cont</code>」と「<code>@etag</code>」を含めると、エレメント全体を繰り返すことになります。
これを「Iterate Element」パターンといいます。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="iterate-elem.pdata"></a>
<pre class="program">&lt;table&gt;
  &lt;tr <b>id="mark:items"</b>&gt;
   &lt;td&gt;@{item}@&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="iterate-elem.plogic"></a>
<pre class="program">#items {
  plogic: {
    // 開始タグ、内容、終了タグを繰り返す
    <b>foreach (item in list) {</b>
      @stag;
      @cont;
      @etag;
    <b>}</b>
  }
}
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
&lt;ul&gt;
&lt;% for item in list do %&gt;
  &lt;dt&gt;&lt;%= item.text %&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;%= item.desc %&gt;&lt;/dd&gt;
&lt;% end %&gt;
&lt;/ul&gt;

### for PHP
&lt;ul&gt;
&lt;?php foreach ($list as $item) { ?&gt;
  &lt;dt&gt;&lt;?php echo $item-&gt;text; ?&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;?php echo $item-&gt;desc; ?&gt;&lt;/dd&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;

### for JSTL
&lt;ul&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;dt&gt;&lt;c:out value="${item.text}" escapeXml="false"/&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;c:out value="${item.desc}" escapeXml="false"/&gt;&lt;/dd&gt;
&lt;/c:forEach&gt;
&lt;/ul&gt;
</pre>
<br>


<a name="iterate-cont"></a>
<h3 class="section2">Iterate Contentパターン</h3>
<p>繰り返しの中に「<code>@cont</code>」を含めると、内容だけを繰り返すことになります。
これを「Iterate Content」パターンといいます。
</p>
<p>これは&lt;dl&gt;&lt;/dl&gt;の内容だけを繰り返したいときに、特に有効です。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="iterate-elem.pdata"></a>
<pre class="program">&lt;ul <b>id="mark:items"</b>&gt;
  &lt;dt&gt;@{item.text}@&lt;/dt&gt;
  &lt;dd&gt;@{item.desc}@&lt;/dd&gt;
&lt;/ul&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="iterate-elem.plogic"></a>
<pre class="program">#items {
  plogic: {
    // 内容だけを繰り返す
    @stag;
    <b>foreach (item in list) {</b>
      @cont;
    <b>}</b>
    @etag;
  }
}
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
&lt;ul&gt;
&lt;% for item in list do %&gt;
  &lt;dt&gt;&lt;%= item.text %&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;%= item.desc %&gt;&lt;/dd&gt;
&lt;% end %&gt;
&lt;/ul&gt;

### for PHP
&lt;ul&gt;
&lt;?php foreach ($list as $item) { ?&gt;
  &lt;dt&gt;&lt;?php echo $item-&gt;text; ?&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;?php echo $item-&gt;desc; ?&gt;&lt;/dd&gt;
&lt;?php } ?&gt;
&lt;/ul&gt;

### for JSTL
&lt;ul&gt;
&lt;c:forEach var="item" items="${list}"&gt;
  &lt;dt&gt;&lt;c:out value="${item.text}" escapeXml="false"/&gt;&lt;/dt&gt;
  &lt;dd&gt;&lt;c:out value="${item.desc}" escapeXml="false"/&gt;&lt;/dd&gt;
&lt;/c:forEach&gt;
&lt;/ul&gt;
</pre>
<br>


<br>


<a name="selection"></a>
<h2 class="section1">選択</h2>
<a name="select-elem"></a>
<h3 class="section2">Select Elementパターン</h3>
<p>複数のエレメントからひとつだけを選んで出力する場合は、次のようにします。
これは「Select Element」パターンといいます。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="select-elem.pdata"></a>
<pre class="program">&lt;div id="mark:message"&gt;
  &lt;font color="red"   <b>id="mark:error"</b>&gt;ERROR!&lt;/font&gt;
  &lt;font color="blue"  <b>id="mark:warning"</b>&gt;Warning:&lt;/font&gt;
  &lt;font color="black" <b>id="mark:good"</b>&gt;No error.&lt;/font&gt;
&lt;/div&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="select-elem.plogic"></a>
<pre class="program">#message {
  plogic: {
    if (status == 'error') {
      <b>@element(error);</b>      // ERROR!
    } else if (status == 'warning') {
      <b>@element(warning);</b>    // Warning:
    } else {
      <b>@element(good);</b>       // No error.
    }
  }
}
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
&lt;% if status == "error" then %&gt;
  &lt;font color="red"&gt;ERROR!&lt;/font&gt;
&lt;% elsif status == "warning" then %&gt;
  &lt;font color="blue"&gt;Warning:&lt;/font&gt;
&lt;% else %&gt;
  &lt;font color="black"&gt;No error.&lt;/font&gt;
&lt;% end %&gt;

### for PHP
&lt;?php if ($status == "error") { ?&gt;
  &lt;font color="red"&gt;ERROR!&lt;/font&gt;
&lt;?php } elseif ($status == "warning") { ?&gt;
  &lt;font color="blue"&gt;Warning:&lt;/font&gt;
&lt;?php } else { ?&gt;
  &lt;font color="black"&gt;No error.&lt;/font&gt;
&lt;?php } ?&gt;

### for JSTL
&lt;c:choose&gt;&lt;c:when test="${status eq 'error'}"&gt;
  &lt;font color="red"&gt;ERROR!&lt;/font&gt;
&lt;/c:when&gt;&lt;c:when test="${status eq 'warning'}"&gt;
  &lt;font color="blue"&gt;Warning:&lt;/font&gt;
&lt;/c:when&gt;&lt;c:otherwise&gt;
  &lt;font color="black"&gt;No error.&lt;/font&gt;
&lt;/c:otherwise&gt;&lt;/c:choose&gt;
</pre>
<br>


<a name="pickup-elem"></a>
<h3 class="section2">Pick-up Elementパターン</h3>
<p>ある特定のエレメントだけを利用するには、利用したいエレメントだけをマーキングし、
プレゼンテーションロジックでそのエレメントだけを利用します。
利用されないエレメントは無視され、出力されません。
これは「Pick-up Element」パターンといいます。
</p>
<p>これは「Dummy Element」パターンと逆の考え方です。
「Dummy Element」パターンでは不要なエレメントをマーキングして削除することで必要なものだけを残しますが、
「Pick-up Element」パターンでは必要なエレメントだけマーキングして取り出すことで不要なものを削除します。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="pickup-elem.pdata"></a>
<pre class="program">&lt;html&gt;
  &lt;body&gt;
    &lt;div <b>id="breadcrumbs"</b>&gt;
      &lt;a href="@{item['path']}@" <b>id="mark:crumb"</b>&gt;@{item['name']}@&lt;/a&gt;
      &lt;span <b>id="mark:separator"</b>&gt;&amp;gt;&lt;/span&gt;
      &lt;a href="/aaa/"&gt;AAA&lt;/a&gt; &amp;lt;
      &lt;a href="/aaa/bbb/"&gt;BBB&lt;/a&gt; &amp;lgt;
      &lt;a href="/aaa/bbb/ccc"&gt;CCC&lt;/a&gt; &amp;lgt;
      &lt;b <b>id="mark:title"</b>&gt;@{title}@&lt;/b&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="pickup-elem.plogic"></a>
<pre class="program">#breadcrumbs {
  plogic: {
    foreach (item in list) {
      <b>@element(crumb);</b>          // print &lt;a&gt;...&lt;/a&gt;
      <b>@element(separator);</b>      // print '&amp;gt;'
    }
    <b>@element(title);</b>            // print &lt;b&gt;title&lt;/b&gt;
  }
}
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
&lt;html&gt;
  &lt;body&gt;
&lt;% for item in list do %&gt;
      &lt;a href="&lt;%= item["path"] %&gt;"&gt;&lt;%= item["name"] %&gt;&lt;/a&gt;
      &amp;gt;
&lt;% end %&gt;
      &lt;b&gt;&lt;%= title %&gt;&lt;/b&gt;
  &lt;/body&gt;
&lt;/html&gt;

### for PHP
&lt;html&gt;
  &lt;body&gt;
&lt;?php foreach ($list as $item) { ?&gt;
      &lt;a href="&lt;?php echo $item["path"]; ?&gt;"&gt;&lt;?php echo $item["name"]; ?&gt;&lt;/a&gt;
      &amp;gt;
&lt;?php } ?&gt;
      &lt;b&gt;&lt;?php echo $title; ?&gt;&lt;/b&gt;
  &lt;/body&gt;
&lt;/html&gt;

### for JSTL
&lt;html&gt;
  &lt;body&gt;
&lt;c:forEach var="item" items="${list}"&gt;
      &lt;a href="&lt;c:out value="${item['path']}" escapeXml="false"/&gt;"&gt;&lt;c:out value="${item['name']}" escapeXml="false"/&gt;&lt;/a&gt;
      &amp;gt;
&lt;/c:forEach&gt;
      &lt;b&gt;&lt;c:out value="${title}" escapeXml="false"/&gt;&lt;/b&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>上の例は、次のように書くこともできます。
</p>
<p>プレゼンテーションデータ：
</p>
<a name="pickup-elem.pdata"></a>
<pre class="program">&lt;html&gt;
  &lt;body&gt;
    &lt;div <b>id="breadcrumbs"</b>&gt;
      &lt;a href="/" <b>id="mark:crumb"</b>&gt;Home&lt;/a&gt;
      &lt;span <b>id="mark:separator"</b>&gt;&amp;gt;&lt;/span&gt;
      &lt;a href="/aaa/"&gt;AAA&lt;/a&gt; &amp;lt;
      &lt;a href="/aaa/bbb/"&gt;BBB&lt;/a&gt; &amp;lgt;
      &lt;a href="/aaa/bbb/ccc"&gt;CCC&lt;/a&gt; &amp;lgt;
      &lt;b <b>id="mark:title"</b>&gt;Page Title&lt;/b&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>プレゼンテーションロジック：
</p>
<a name="pickup-elem.plogic"></a>
<pre class="program">#breadcrumbs {
  plogic: {
    foreach (item in list) {
      <b>@element(crumb);</b>          // print &lt;a&gt;...&lt;/a&gt;
      <b>@element(separator);</b>      // print '&amp;gt;'
    }
    <b>@element(title);</b>            // print &lt;b&gt;title&lt;/b&gt;
  }
}
#crumb {
  value: item['name'];
  attr:  "href" item['path'];
}
#title {
  value: title;
}
</pre>
<br>


<a name="extract-elem"></a>
<h3 class="section2">Extract Elementパターン</h3>
<p>プレゼンテーションデータ全体から、ある特定のエレメントだけを抽出し、
ほかは一切表示しないようにすることができます。
このパターンは「Extract Element」パターンといいます。
</p>
<p>このパターンを使うと、HTMLデータの一部だけを取り出し、部品化することができます。
例えば次の例では、HTMLファイルからタブとメニューと著作権表示を抜き出しています。
</p>
<p>プレゼンテーションデータ(<a href="design.html">design.html</a>)：
</p>
<a name="design.html"></a>
<pre class="program">&lt;html <b>id="mark:whole"</b>&gt;
  &lt;head&gt;
    &lt;title&gt;Design Examples&lt;/title&gt;
    &lt;link rel="stylesheet" href="design.css" type="text/css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;div <b>id="mark:tablist"</b>&gt;
      &lt;div class="tabs" id="mark:tabs"&gt;
        &lt;a href="/" class="" <b>id="mark:tab"</b>&gt;Home&lt;/a&gt;
        &lt;a href="/product/" class="selected"&gt;Product&lt;/a&gt;
        &lt;a href="/download/" class=""&gt;Download&lt;/a&gt;
        &lt;a href="/support/" class=""&gt;Support&lt;/a&gt;
      &lt;/div&gt;
      &lt;div class="tabsline"&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;br&gt;

    &lt;div <b>id="mark:menulist"</b>&gt;
      &lt;span class="menu_title" id="value:menu_title"&gt;MenuList&lt;/span&gt;
      &lt;div class="menus" <b>id="mark:menus"</b>&gt;
        &lt;a href="/cgi-bin/email.cgi" class="" <b>id="mark:menu"</b>&gt;E-Mail&lt;/a&gt;
        &lt;span <b>id="mark:menu_separator"</b>&gt;&lt;br&gt;&lt;/span&gt;
        &lt;a href="/cgi-bin/board.cgi" class="selected"&gt;MesgBoard&lt;/a&gt;&lt;br&gt;
        &lt;a href="/cgi-bin/photo.cgi" class=""&gt;PhotoAlbum&lt;/a&gt;&lt;br&gt;
        &lt;a href="/cgi-bin/greeting.cgi" class=""&gt;GreetingCard&lt;/a&gt;&lt;br&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;br&gt;
      
    &lt;p&gt; ..... &lt;/p&gt;
    &lt;p&gt; ..... &lt;/p&gt;
    &lt;p&gt; ..... &lt;/p&gt;
    
    &lt;div align="center" class="copyright" <b>id="mark:copyright"</b>&gt;
      Copyright&amp;copy; 2004-2005 kuwata-lab. All Rights Reserved.
    &lt;/div&gt;
    
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>プレゼンテーションロジック(copyright.plogic)：
</p>
<a name="copyright.plogic"></a>
<pre class="program"><b>#whole</b> {
  // 全体を表すエレメントwholeを、抽出したいエレメントで置き換える
  plogic: {
    <b>@element(copyright);</b>
  }
}
</pre>
<p>プレゼンテーションロジック(tablist.plogic)：
</p>
<a name="tablist.plogic"></a>
<pre class="program"><b>#whole</b> {
  // 全体を表すエレメントwholeを、抽出したいエレメントで置き換える
  plogic: {
    <b>@element(tablist);</b>
  }
}

#tabs {
  plogic: {
    @stag;
    foreach (tab in tablist) {
      klass = current_tabname == tab['name'] ? 'selected' : '';
      @element(tab);
    }
    @etag;
  }
}

#tab {
  value: tab['name'];
  attr:  "href" tab['href'], "class" klass;
}
</pre>
<p>プレゼンテーションロジック(menulist.plogic)：
</p>
<a name="menulist.plogic"></a>
<pre class="program"><b>#whole</b> {
  // 全体を表すエレメントwholeを、抽出したいエレメントで置き換える
  plogic: {
    <b>@element(menulist);</b>
  }
}

#menus {
  plogic: {
    @stag;
    foreach (menu in menulist) {
      @element(menu);
      @element(menu_separator);
    }
    @etag;
  }
}

#menu {
  value:  menu['name'];
  attr:   "href" menu['cgipath'], "class" klass;
  plogic: {
    klass = current_menu == menu['name'] ? 'selected' : '';
    @stag;
    @cont;
    @etag;
  }
}
</pre>
<p>コンパイル：
</p>
<pre class="terminal">### copyright
$ kwartz -l eruby -p copyright.plogic design.pdata
$ kwartz -l php   -p copyright.plogic design.pdata

### tablist
$ kwartz -l eruby -p tablist.plogic   design.pdata
$ kwartz -l php   -p tablist.plogic   design.pdata

### menulist
$ kwartz -l eruby -p menulist.plogic  design.pdata
$ kwartz -l php   -p menulist.plogic  design.pdata
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
    &lt;div align="center" class="copyright"&gt;
      Copyright&amp;copy; 2004-2005 kuwata-lab. All Rights Reserved.
    &lt;/div&gt;

### for PHP
    &lt;div align="center" class="copyright"&gt;
      Copyright&amp;copy; 2004-2005 kuwata-lab. All Rights Reserved.
    &lt;/div&gt;
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
    &lt;div&gt;
      &lt;div class="tabs"&gt;
&lt;% for tab in tablist do %&gt;
&lt;%   klass = current_tabname == tab["name"] ? "selected" : "" %&gt;
        &lt;a href="&lt;%= tab["href"] %&gt;" class="&lt;%= klass %&gt;"&gt;&lt;%= tab["name"] %&gt;&lt;/a&gt;
&lt;% end %&gt;
      &lt;/div&gt;
      &lt;div class="tabsline"&gt;
      &lt;/div&gt;
    &lt;/div&gt;

### for PHP
    &lt;div&gt;
      &lt;div class="tabs"&gt;
&lt;?php foreach ($tablist as $tab) { ?&gt;
&lt;?php   $klass = $current_tabname == $tab["name"] ? "selected" : ""; ?&gt;
        &lt;a href="&lt;?php echo $tab["href"]; ?&gt;" class="&lt;?php echo $klass; ?&gt;"&gt;&lt;?php echo $tab["name"]; ?&gt;&lt;/a&gt;
&lt;?php } ?&gt;
      &lt;/div&gt;
      &lt;div class="tabsline"&gt;
      &lt;/div&gt;
    &lt;/div&gt;
</pre>
<p>出力用スクリプト：
</p>
<pre class="program">### for eRuby
    &lt;div&gt;
      &lt;span class="menu_title"&gt;&lt;%= menu_title %&gt;&lt;/span&gt;
      &lt;div class="menus"&gt;
&lt;% for menu in menulist do %&gt;
&lt;%   klass = current_menu == menu["name"] ? "selected" : "" %&gt;
        &lt;a href="&lt;%= menu["cgipath"] %&gt;" class="&lt;%= klass %&gt;"&gt;&lt;%= menu["name"] %&gt;&lt;/a&gt;
        &lt;br&gt;
&lt;% end %&gt;
      &lt;/div&gt;
    &lt;/div&gt;

### for PHP
    &lt;div&gt;
      &lt;span class="menu_title"&gt;&lt;?php echo $menu_title; ?&gt;&lt;/span&gt;
      &lt;div class="menus"&gt;
&lt;?php foreach ($menulist as $menu) { ?&gt;
&lt;?php   $klass = $current_menu == $menu["name"] ? "selected" : ""; ?&gt;
        &lt;a href="&lt;?php echo $menu["cgipath"]; ?&gt;" class="&lt;?php echo $klass; ?&gt;"&gt;&lt;?php echo $menu["name"]; ?&gt;&lt;/a&gt;
        &lt;br&gt;
&lt;?php } ?&gt;
      &lt;/div&gt;
    &lt;/div&gt;
</pre>
<p>なお、コマンドラインオプション「<code>--extract=<i>name</i></code>」でも、<code><i>name</i></code>でマーキングされたエレメントを抽出できます。
</p>
<br>


<br>



   </div>
  </blockquote>

 </body>
</html>
